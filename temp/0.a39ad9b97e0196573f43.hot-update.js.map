{"version":3,"file":"0.a39ad9b97e0196573f43.hot-update.js","sources":["webpack:///./src/lib/toolbar/bookbar.js?bc4f"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Bar = undefined;\n\nvar _bookmark = require('./bookmark');\n\nvar _toolBar = require('./base/toolBar');\n\nvar _index = require('../util/index');\n\nvar _tap = require('../tap');\n\n/**\r\n * 阅读模式工具栏\r\n * @param options object\r\n * @demo {container:页面容器,controlBar:工具栏容器,...}\r\n * @desc 继承自Toolbar.js\r\n */\nvar Bar = _toolBar.ToolBar.extend({\n    init: function init(options) {\n        //左右箭头\n        this.arrows = {};\n        //工具栏父容器\n        this.container = options.container;\n        //工具栏容器\n        this.controlBar = options.controlBar;\n        this.pageMode = options.pageMode;\n        //是否有顶部工具栏\n        this.hasTopBar = true;\n        this.Lock = false;\n        this.delay = 50;\n        //图书工具栏高度\n        this.topBarHeight = this.iconHeight * 1.25;\n\n        //配置属性\n        //config\n        this.config = Xut.config;\n        this.initConfig(this.config);\n\n        this.initTool();\n    }\n});\n\n/**\r\n * 初始化\r\n */\nBar.prototype.initTool = function () {\n    //工具栏的显示状态\n    var display = this.controlBar.css('display');\n    this.barStatus = display == 'none' ? false : true;\n    this.setToolbarStyle();\n    this.createBackIcon();\n    this.createDirIcon();\n    this.createMarkIcon();\n    // this.createStarIcon();\n\n    //翻页按钮\n    if (this.pageMode == 2) {\n        this.createArrows();\n    }\n\n    //监听事件\n    (0, _tap.bindTap)(this.container[0], {\n        end: this\n    });\n};\n\n/**\r\n * 工具条的样式\r\n */\nBar.prototype.setToolbarStyle = function () {\n    var height = this.topBarHeight,\n        TOP = this.barHeight; //系统工具栏占用的高度\n\n    //在顶部\n    this.controlBar.css({\n        top: 0,\n        height: height + 'px',\n        paddingTop: TOP + 'px',\n        backgroundColor: 'rgba(0, 0, 0, 0.2)', //transparent\n        fontSize: '0.625em',\n        color: 'white'\n    });\n};\n\n/**\r\n * 更新页码\r\n */\nBar.prototype.updatePointer = function () {}\n//预留\n\n\n/**\r\n * 创建目录图标\r\n */\n;Bar.prototype.createDirIcon = function (bar) {\n    var icon = document.createElement('div');\n    icon.innerHTML = '目录';\n    icon.style.width = this.iconHeight + 'px';\n    icon.style.lineHeight = 1.5 * this.topBarHeight + 'px';\n    icon.className = 'xut-book-bar-dir';\n    this.controlBar.append(icon);\n};\n\n/**\r\n * 创建书签图标\r\n * @param  {[type]} bar [description]\r\n * @return {[type]}     [description]\r\n */\nBar.prototype.createMarkIcon = function (bar) {\n    var icon = document.createElement('div');\n    icon.innerHTML = '书签';\n    icon.style.width = this.iconHeight + 'px';\n    icon.style.lineHeight = 1.5 * this.topBarHeight + 'px';\n    icon.className = 'xut-book-bar-mark';\n    this.controlBar.append(icon);\n};\n\n/**\r\n * 创建评分图标\r\n */\nBar.prototype.createStarIcon = function (bar) {\n    var icon = document.createElement('div');\n    icon.innerHTML = '评分';\n    icon.style.width = this.iconHeight + 'px';\n    icon.style.lineHeight = 1.5 * this.topBarHeight + 'px';\n    icon.className = 'xut-book-bar-star';\n    this.controlBar.append(icon);\n};\n\n/**\r\n * 后退按钮\r\n * @return {[type]} [description]\r\n */\nBar.prototype.createBackIcon = function () {\n    var icon = document.createElement('div');\n    icon.style.width = this.topBarHeight + 'px';\n    icon.className = 'xut-book-bar-back';\n    this.controlBar.append(icon);\n};\n\n/**\r\n * 显示顶部工具栏\r\n * @return {[type]} [description]\r\n */\nBar.prototype.showTopBar = function () {\n    var that = this;\n\n    if (this.barStatus) {\n        this.Lock = false;\n        return;\n    }\n\n    this.controlBar.css({\n        'display': 'block',\n        'opacity': 0\n    });\n\n    setTimeout(function () {\n        that.controlBar.animate({\n            'opacity': 1\n        }, that.delay, 'linear', function () {\n            that.showSystemBar();\n            that.barStatus = true;\n            that.Lock = false;\n        });\n    }, 50);\n};\n\n/**\r\n * 隐藏顶部工具栏\r\n * @return {[type]} [description]\r\n */\nBar.prototype.hideTopBar = function () {\n    var that = this;\n\n    if (!this.barStatus) {\n        this.Lock = false;\n        return;\n    }\n\n    this.controlBar.animate({\n        'opacity': 0\n    }, that.delay, 'linear', function () {\n        that.controlBar.hide();\n        that.hideSystemBar();\n        that.barStatus = false;\n        that.Lock = false;\n    });\n};\n\n/**\r\n * 创建目录菜单\r\n */\nBar.prototype.createDirMenu = function () {\n    var self = this;\n    var wrap = document.createElement('div');\n    var mask = document.createElement('div');\n    //添加遮层\n    mask.className = 'xut-book-menu-mask';\n    //获取内容\n    this.getDirContent();\n    wrap.className = 'xut-book-menu';\n    wrap.innerHTML = '<ul>' + this.contentText + '</ul>';\n    this.container.append(wrap);\n    //是否滚动\n    this.isScrolled = false;\n\n    //添加滚动条\n    //url : http://iscrolljs.com/\n    this.iscroll = new iScroll(wrap, {\n        scrollbars: true,\n        fadeScrollbars: true,\n        scrollX: false\n    });\n\n    this.menu = wrap;\n\n    this.setColor();\n\n    this.iscroll.on('scrollStart', function (e) {\n        self.isScrolled = true;\n    });\n\n    this.iscroll.on('scrollEnd', function (e) {\n        self.isScrolled = false;\n    });\n\n    wrap.appendChild(mask);\n};\n\n/**\r\n *  显示目录菜单\r\n */\nBar.prototype.showDirMenu = function () {\n    //获取当前页面\n    var page = Xut.Presentation.GetPageElement();\n\n    if (this.menu) {\n        this.menu.style.display = 'block';\n    } else {\n        this.createDirMenu();\n    }\n\n    //添加模糊效果\n    page.addClass('filter');\n    this.page = page;\n\n    //隐藏顶部工具栏\n    this.controlBar.hide();\n    var iscroll = this.iscroll;\n    //自动定位到上一位置\n    if (iscroll.y > iscroll.wrapperHeight) {\n        iscroll.scrollToElement(this.selectedChild);\n    }\n};\n\n/**\r\n *  隐藏目录菜单\r\n */\nBar.prototype.hideDirMenu = function () {\n    this.menu.style.display = 'none';\n    //恢复顶部工具栏\n    this.controlBar.show();\n    //移除模糊效果\n    this.page.removeClass('filter');\n};\n\n/**\r\n *  创建目录内容\r\n */\nBar.prototype.getDirContent = function () {\n\n    var Api = Xut.Presentation;\n    var data = Api.GetAppSectionData();\n    var sns = data[0];\n    var seaonId = sns._id;\n    var cids = Xut.data.Chapter;\n\n    ////////////////////////////\n    //针对book模式，合并了Season的参数 //\n    //1 SeasonTitle\n    //2 ChapterList列表的范围区间\n    ////////////////////////////\n    data = (0, _index.parseJSON)(sns.parameter);\n\n    if (!data) {\n        console.log('book模式parameter数据出错');\n        return;\n    }\n\n    //二级目录\n    function secondaryDirectory(startCid, endCid) {\n        var cid,\n            str = '';\n        for (startCid; startCid <= endCid; startCid++) {\n            cid = cids.item(startCid - 1);\n            if (cid && cid.chapterTitle) {\n                str += '<section><a class=\"xut-book-menu-item\" data-mark=' + seaonId + '-' + startCid + ' href=\"javascript:0\">' + cid.chapterTitle + '</a></section>';\n            }\n        }\n        return str;\n    }\n\n    var i = 0;\n    var len = data.length;\n    var li = '<li class=\"title\"><center class=\"select\">目录</center></li>';\n    var seasonInfo, mark, seasonTitle, seaonId, startCid, endCid;\n\n    for (i; i < len; i++) {\n        seasonInfo = data[i];\n        startCid = seasonInfo.ChapterList[0];\n        endCid = seasonInfo.ChapterList[1];\n        mark = seaonId + '-' + startCid;\n        if (seasonInfo.SeasonTitle.length <= 0) continue;\n        seasonTitle = seasonInfo.SeasonTitle || '第' + (i + 1) + '章';\n        //第一级目录\n        li += '<li>' + '<a class=\"xut-book-menu-item\" data-mark=\"' + mark + '\" href=\"javascript:0\">' + seasonTitle + '</a>' +\n        //第二级目录\n        secondaryDirectory(startCid, endCid) + '</li>';\n    }\n\n    this.contentText = li;\n};\n\n/**\r\n * 突出显示点击颜色\r\n */\nBar.prototype.setColor = function (element) {\n    if (this.selectedChild) {\n        this.selectedChild.className = 'xut-book-menu-item';\n    }\n\n    element = element || this.menu.querySelectorAll('li')[1].children[0];\n    element.className = 'select';\n    this.selectedChild = element;\n};\n\n/**\r\n * 跳转到指定书页\r\n */\nBar.prototype.turnToPage = function (target) {\n    //忽略滚动点击\n    if (this.isScrolled) return;\n    this.setColor(target);\n    this.hideDirMenu();\n    var data = target.dataset.mark || '';\n    if (data) {\n        data = data.split('-');\n        Xut.View.LoadScenario({\n            'scenarioId': data[0],\n            'chapterId': data[1]\n        });\n    }\n};\n\n/**\r\n * 显示书签\r\n */\nBar.prototype.showBookMark = function () {\n    if (this.bookMark) {\n        this.bookMark.restore();\n    } else {\n        var pageData = Xut.Presentation.GetPageData();\n        this.bookMark = new _bookmark.BookMark({\n            parent: this.container,\n            seasonId: pageData.seasonId,\n            pageId: pageData._id\n        });\n    }\n};\n\n/**\r\n * 返回首页\r\n */\nBar.prototype.goBack = function () {\n    var self = this;\n    Xut.Application.Suspend({\n        dispose: function dispose(promptMessage) {\n            //停止热点动作\n            //promptMessage('再按一次将跳至首页！')\n        },\n        processed: function processed() {\n            Xut.View.GotoSlide(1); //调整到首页\n            self.setColor();\n        }\n    });\n};\n\n/**\r\n * 事件处理\r\n */\nBar.prototype.handleEvent = function (e) {\n\n    var target = e.target || e.srcElement;\n\n    var name = target.className;\n\n    switch (name) {\n        case 'xut-book-bar-back':\n            this.goBack();\n            //返回\n            break;\n        case 'xut-book-bar-dir':\n            //目录\n            this.showDirMenu();\n            break;\n        case 'xut-book-bar-mark':\n            //书签\n            this.showBookMark();\n            break;\n        case 'xut-book-bar-star':\n            //评分\n            break;\n        case 'xut-book-menu-item':\n            //跳转\n            this.turnToPage(target);\n            break;\n        case 'xut-book-menu-mask':\n        case 'select':\n            this.hideDirMenu();\n            break;\n        default:\n            // console.log(name+':undefined')\n            break;\n    }\n};\n\n/**\r\n * 销毁\r\n */\nBar.prototype.destroy = function () {\n    this.iscroll && this.iscroll.destroy();\n    this.bookMark && this.bookMark.destroy();\n    var ele = this.container[0];\n    ele.removeEventListener('touchend', this, false);\n    ele.removeEventListener('mouseup', this, false);\n    this.iscroll = null;\n    this.menu = null;\n    this.page = null;\n};\n\nexports.Bar = Bar;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/lib/toolbar/bookbar.js\n ** module id = 147\n ** module chunks = 0\n **/"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;","sourceRoot":""}