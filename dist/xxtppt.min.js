/*!
 * build.js vundefined
 * (c) 2016 Aaron
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(this,function(){"use strict";function t(t,e,n,i,a){Yi(t,e,{value:n,enumerable:i,writable:a,configurable:!0})}function e(t,e,n){Yi(t,e,{get:n.get,set:n.set})}function n(){return Object.create(null)}function i(t){return Number(t)||null}function a(t){return Number(t)}function o(t,e){var n=function(){};n.prototype=e.prototype;var i=new n;for(var a in i)t.prototype[a]?console.log("\u5b50\u7c7b\u4e0e\u8d85\u7c7b\u7684\u65b9\u6cd5\u540d\u91cd\u53e0\u4e86\uff01"):t.prototype[a]=i[a];t.prototype.constructor=t,e=null}function r(){var t=16;switch(window.innerWidth+window.innerHeight){case 3e3:t=32;break;case 2e3:t=26;break;case 2048:t=Xut.plat.isIpad?16:26;break;case 1624:t=18;break;case 888:t=12;break;case 800:t=14;break;case 560:t=12}16!=t&&$("html").css("font-size",t+"px")}function s(t,e){for(var n in e)n&&(t[n]?console.log("\u63a5\u53e3\u65b9\u6cd5\u91cd\u590d","Key->"+n,"Value->"+t[n]):t[n]=e[n])}function c(t){if(t&&t.length){for(var e=t.length;--e;)t.lastIndexOf(t[e],e-1)>-1&&t.splice(e,1);return t}return t}function u(t,e){var n,i=t.sheet,a=+navigator.userAgent.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")<536;if(a)i&&(n=!0);else if(i)try{i.cssRules&&(n=!0)}catch(o){"NS_ERROR_DOM_SECURITY_ERR"===o.name&&(n=!0)}setTimeout(function(){n?e():u(t,e)},20)}function l(t,e,n,i){function a(){if(t.onload=t.onerror=t.onreadystatechange=null,!n){var i=document.getElementsByTagName("head")[0]||document.documentElement;i.removeChild(t)}t=null,e()}var o="onload"in t;+navigator.userAgent.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")<536;return n?void setTimeout(function(){u(t,e)},1):void(o?(t.onload=a,t.onerror=function(){a()}):t.onreadystatechange=function(){/loaded|complete/.test(t.readyState)&&a()})}function d(t,e,n){var i=/\.css(?:\?|$)/i,a=i.test(t),o=document.createElement(a?"link":"script");if(n){var r=isFunction(n)?n(t):n;r&&(o.charset=r)}l(o,e,a,t),a?(o.rel="stylesheet",o.href=t):(o.async=!0,o.src=t);var s=document.getElementsByTagName("head")[0]||document.documentElement,c=s.getElementsByTagName("base")[0];c?s.insertBefore(o,c):s.appendChild(o)}function h(t,e){function n(t,e){try{Zi.setItem(t,e)}catch(n){console.log("storage.setItem(setkey, key[i]);")}}var i;if("object"===("undefined"==typeof t?"undefined":qi["typeof"](t)))for(var a in t)t.hasOwnProperty(a)&&(i=na(a),n(i,t[a]));else t=na(t),n(t,e)}function p(t){return t=na(t),Zi.getItem(t)}function f(t){t=na(t),Zi.removeItem(t)}function v(t,e){set(t||ta,JSON.stringify(e))}function g(t){var e;try{e=JSON.parse(t)}catch(n){e=new Function("return "+t)()}return e}function m(t){var e=oa.proportion,n=Xut.plat.prefixStyle,i=.5*(e.width+e.height)+"em",a=t.content,o=(t.time||3e3,{"font-size":i,"background-image":"url(images/icons/nodeBig.png)","z-index":99999,bottom:"1%",left:"5%",padding:"0.2em 0.5em",color:"white",position:"absolute"});aa?aa.empty().show():(aa=$("#toolTip"),aa.css(o),aa.css(n("border-radius"),"5px")),Xut.nextTick({container:aa,content:a},x)}function b(t){oa=Xut.config;var e=oa.screenSize,n=.25*e.width,i=ia||$("#message"),a='<div class="messageBox" style="width:'+n+'px;"><div class="messageTex" style="line-height:2">'+t+'</div><div class="messageBtn" style="line-height:1.5">OK</div></div>';i.html(a).show().on("touchend mouseup",function(t){"messageBtn"===t.target.className&&(this.innerHTML="",this.style.display="none")})}function x(){setTimeout(function(){aa.hide(1e3)},1500)}function y(t,e){var n=function(t){return t.replace(/\r\n/gi,"").replace(/\r/gi,"").replace(/\n/gi,"")};try{new Function("(function(){"+n(t)+"})")()}catch(i){console.log("\u52a0\u8f7d\u811a\u672c\u9519\u8bef",e)}}function k(t){b(t)}function I(t,e,n,i){var a=Xut.config.proportion;return{width:t*a.width,height:e*a.height,left:n*a.left,top:i*a.top}}function w(t){var e=I(t.width,t.height,t.left,t.top),n=I(t.backwidth,t.backheight,t.backleft,t.backtop);return t.scaleWidth=Math.ceil(e.width),t.scaleHeight=Math.ceil(e.height),t.scaleLeft=Math.floor(e.left),t.scaleTop=Math.floor(e.top),t.scaleBackWidth=Math.ceil(n.width),t.scaleBackHeight=Math.ceil(n.height),t.scaleBackLeft=Math.floor(n.left),t.scaleBackTop=Math.floor(n.top),t}function C(t,e,n){var i,a,o,r=Xut.config;return Xut.IBooks.CONFIG?(i=r.svgPath().replace("svg","js")+t,a=t.replace(".svg",""),void d(i.replace(".svg",".js"),function(){o=Xut.IBooks.CONFIG[a],o?(e(o),delete Xut.IBooks.CONFIG[a]):e("\u811a\u672c\u52a0\u8f7d\u5931\u8d25,\u6587\u4ef6\u540d:"+t)})):"js"===n?(i=r.svgPath()+t,a=t.replace(".js",""),void d(i,function(){o=window.HTMLCONFIG[a],o?(e(o),delete window.HTMLCONFIG[a]):e("\u811a\u672c\u52a0\u8f7d\u5931\u8d25,\u6587\u4ef6\u540d:"+t)})):void(Xut.plat.isBrowser?$.ajax({type:"get",dataType:"html",url:r.svgPath().replace("www/","")+t,success:function(t){e(t)},error:function(n,i){e("ReadFile\u6570\u636e\u52a0\u8f7d\u5931\u8d25"),console.log("SVG"+t+"\u89e3\u6790\u51fa\u9519!")}}):Xut.Plugin.ReadAssetsFile.readAssetsFileAction(r.svgPath()+t,function(t){e(t)},function(t){e("\u6570\u636e\u52a0\u8f7d\u5931\u8d25")}))}function T(){function t(n,i){return e.push(n)>20&&delete t[e.shift()],t[n]=i}var e=[];return t}function P(t,e){var n;if("string"==typeof t)e(n,t);else for(n in t)e(n,t[n])}function S(t,e,n,i){if(window.SQLResult)if(window.SQLResult[i]){var a=window.SQLResult[i],o={};o={length:Object.keys(a).length,item:function(t){return a[t]}},e(o)}else n({tName:":table not exist!!"});else $.ajax({url:Xut.config.onlineModeUrl,dataType:"json",data:{xxtsql:t},success:function(t){var n=t,i={};i={length:t.length,item:function(t){return n[t]}},e(i)},error:n})}function M(t,e){function n(t,e){h--,l.push(r(t,e)),0===h&&i()}function i(){if(l.length){var t=l.shift();s=t.tableName,t.execute()}else e(u.results?u.results:u,d)}function a(){i()}function o(t){d.push(s),console.log("\u6570\u636e\u67e5\u8be2\u9519\u8bef "+t.message,"\u7c7b\u578b",s),i()}function r(t,e){return{tableName:t,execute:function(){c?c.transaction(function(n){n.executeSql(e,[],function(e,n){u[t]=n.rows})},o,a):S(e,function(e){u[t]=e,a()},o,t)}}}var s,c=Xut.config.db,u={},l=[],d=[],h=function(){return"string"==typeof t?1:Object.keys(t).length}();P(t,function(t,e){n(t||"results",e)})}function X(t){function e(t){a.style.backgroundImage="url("+Xut.conifg.pathAddress+t+")"}function n(t){t=t.split(","),Xut.Assist.Run(o,t)}function i(t){t=t.split(","),Xut.Assist.Stop(o,t)}var a=document.querySelector("#Audio_"+t.audioId),o=a.getAttribute("data-belong");return{play:function(){t.startImg&&e(t.startImg),t.startScript&&n(t.startScript)},pause:function(){t.stopImg&&e(t.stopImg),t.stopScript&&i(t.startScript)},destroy:function(){a=null}}}function B(t,e,n){var i;this.audio=t,this.options=e,this.parents=n.parents,this.ancestors=n.ancestors,this.timer=0,this.cacheCreateDivs={};var a=this.orgAncestorVisibility={};_.each(this.ancestors,function(t,e){i=ca(t,"visibility"),i&&(a[e]=i)}),this.recordRepart={},this.changeValue=0;var o={};_.each(e.subtitles,function(t){o[t.start+"-start"]=t,o[t.end+"-end"]=t}),this.createSubtitle(o)}function O(t){for(var e="",n=0;t>n;n++){var i=parseInt(256*Math.random(),10).toString(16);1==i.length&&(i="0"+i),e+=i}return e}function A(){function t(){h=n(),p=n()}function e(t,e){var n;switch(t){case v:n=Xut.data.query("Video",e,!0);break;case m:n=Xut.data.query("Video",e,!0);break;default:n=Xut.data.query("Video",e)}return n}function i(t,e,i){var a,o,r=n(),s=n(),c=e-1;if(t){a=Xut.Contents.contentsFragment[e];var u=e>9e3;u&&(c=Xut.Presentation.GetPageIndex()),_.each(t,function(t){if(!r[t.id]){o=a["Content_"+c+"_"+t.id],s[t.id]=o;var e=$(o);if(e.length){var n=e.find("div").last();n.length&&(r[t.id]=n[0])}}})}return{parents:r,ancestors:s}}function a(t,e,n){var i=h[n];return!!(i&&i[t]&&i[t][e])}function o(t,e,i,a,o){if(h[a]||(h[a]=n()),h[a][e]||(h[a][e]=n()),t.theTitle)var r=g(t.theTitle);return h[a][e][i]={trackId:t.track,url:t.md5,subtitles:r,audioId:i,data:t}}function r(t,n,i,r){if(a(t,n,i))return!1;var s=e(i,n);if(s&&s.md5){var c=o(s,t,n,i,r);r&&_.extend(c,r,{action:!0})}}function s(t,e,n,i){var a=p[t][e][n],o=i.trackId,r=a.trackId;return t==m&&a.url==i.url?!0:(0!=o&&0!=r&&o!=r||(a.end(),delete p[t][e][n]),!1)}function c(t,e,n){var i,a,o,r=h[n][t][e],c=null;for(i in p)for(a in p[i])for(o in p[i][a])s(i,a,o,r)&&(c=p[i][a][o]);return c}function u(t,e,a){var o=h[a][t][e],r=c(t,e,a);if(Xut.VideoManager.clearVideo(),p[a]||(p[a]=n()),p[a][t]||(p[a][t]=n()),o.subtitles)var s=i(o.subtitles,t,e);o.innerCallback=function(n){p[a]&&p[a][t]&&p[a][t][e]&&(n.end(),delete p[a][t][e])};var u=r||new la(o,s);u.play(),p[a][t][e]=u}function l(t,e,n){var i,a;switch(p[n]&&p[n][t]&&p[n][t][e]&&(i=p[n][t][e],a=i.audio?i.status:null),a){case"playing":i.pause();break;case"paused":i.play();break;default:u(t,e,n)}}function d(){var e,n,i,a=!1;for(e in p)for(n in p[e])for(i in p[e][n])p[e][n][i].end(),a=!0;return t(),a}var h,p,f="hot",v="content",m="season";t();var b={autoPlay:function(t,e,n){r(t,e,f,n),u(t,e,f)},trigger:function(t,e,n){r(t,e,f,n),l(t,e,f)},contentAudio:function(t,e){r(t,e,v),u(t,e,v)},seasonAudio:function(t,e){r(t,e,m),u(t,e,m)},hangUpAudio:function(){var t,e,n;for(t in p)for(e in p[t])for(n in p[t][e])p[t][e][n].pause()},clearContentAudio:function(t){if(!p[v]||!p[v][t])return!1;var e=p[v][t];if(e)for(var n in e)e[n].end(),delete p[v][t][n]},clearAudio:function(t){t?b.clearContentAudio(t):d()}};return b}function R(t,e){t.container=e,"video"==t.category?this.video=ga(t):"webpage"==t.category?this.video=N(t):console.log("options.category must be video or webPage ")}function N(t){function e(){o&&o.show()}function n(){o&&o.hide()}function i(){o&&(o.remove(),o=null)}var a=t.pageUrl;if(2==t.hyperlink)window.open(a),$.get("http://www.appcarrier.cn/index.php/adplugin/recordads?aid=16&esbId=ios");else{var o,r,s,c=t.padding||0,u=t.width,l=t.height,d=t.videoId,h=t.left,p=t.top;c?(r=u-2*c,s=l-2*c):(r=u,s=l),o=$('<div id="videoWrap_'+d+'" style="position:absolute;left:'+h+"px;top:"+p+"px;width:"+u+"px;height:"+l+"px;z-index:"+Xut.zIndexlevel()+'"><div style="position:absolute;left:'+c+"px;top:"+c+"px;width:"+r+"px;height:"+s+'px;"><iframe src="'+a+'" style="position:absolute;left:0;top:0;width:100%;height:100%;"></iframe></div></div>'),t.container.append(o)}return{play:e,stop:n,close:i}}function E(t){function e(){Xut.Plugin.VideoPlayer.play(function(){},function(){},Xut.config.videoPath()+i,1,s,r,o,a)}function n(){Xut.Plugin.VideoPlayer.close()}var i=MMXCONFIG?t.url:t.url.substring(0,t.url.lastIndexOf(".")),a=t.width,o=t.height,r=t.top||0,s=t.left||0;return e(),{play:e,stop:n,close:n}}function D(t){function e(){p.show(),v.play()}function n(){v.pause(),v.duration&&(v.currentTime=.01),p.hide(),t.startBoot&&(t.startBoot(),o())}function i(){t.startBoot&&(t.startBoot(),o())}function a(){p.css({width:c+"px",height:u+"px",zIndex:h})}function o(){v.removeEventListener("ended",n,!1),v.removeEventListener("error",i,!1),v.removeEventListener("loadeddata",a,!1),v.removeEventListener("webkitendfullscreen",n,!1),p.hide().remove()}var r=t.container||$("body"),s=Xut.config.videoPath()+t.url,c=t.width,u=t.height,l=t.top,d=t.left,h=t.zIndex,p=$("<div></div>"),f=$(document.createElement("video")),v=f[0];return v.play(),f.css({width:c,height:u}).attr({src:s,controls:"controls",autoplay:"autoplay"}),p.append(f).css({position:"absolute","z-index":-1,top:l,left:d,width:0,height:0}),r.append(p),v.addEventListener("ended",n,!1),v.addEventListener("error",i,!1),v.addEventListener("loadeddata",a,!1),v.addEventListener("webkitendfullscreen",n,!1),{play:e,stop:n,close:o}}function H(t){var e,n,i,a,o=t.container||$("body"),r=t.videoId,s=Xut.config.videoPath()+t.url,c=t.width,u=t.height,l=t.zIndex,d=t.top,h=t.left;e=document.createElement("video"),n=document.createElement("source"),n.setAttribute("src",s),n.setAttribute("type","video/mp4"),e.id="video_"+r,e.className="video-js vjs-sublime-skin",e.appendChild(n),o.append(e),videojs.options.flash.swf="lib/data/video-js.swf";var p=function(){Xut.VideoManager.removeVideo(t.pageId)};i=videojs(e,{techOrder:["html5","flash"],preload:"auto",controls:!0,autoplay:!0,width:c,height:u,children:{bigPlayButton:!1,errorDisplay:!1,posterImage:!1,textTrackDisplay:!1},controlBar:{captionsButton:!1,chaptersButton:!1,liveDisplay:!1,remainingTimeDisplay:!1,subtitlesButton:!1,playbackRateMenuButton:!1,timeDivider:!1,currentTimeDisplay:!1,durationDisplay:!1}},function(){this.on("canplay",function(){f.style.zIndex=l}),this.on("ended",function(){p()}),this.on("error",function(){p()}),this.on("touchend mouseup",function(t){var e=t.target.className.toLowerCase();-1!=e.indexOf("vjs-fullscreen-control")&&p()})});var f=i.el();f.children[0];return f.style.left=h+"px",f.style.top=d+"px",f.style.zIndex=-1,a={play:ma,stop:function(){i.stop()},close:function(){i&&i.dispose(),i=null}}}function L(){this.pageBox={},this.playBox={}}function G(){var t,e=window.innerWidth,n=window.innerHeight,i=Math.min(e,n)/4,a=Math.round((n-i)/2),o=[0,.9167,.833,.75,.667,.5833,.5,.41667,.333,.25,.1667,.0833],r=[0,30,60,90,120,150,180,210,240,270,300,330],s=12,c=Xut.plat.prefixStyle;for(t='<div style="width:'+i+"px;height:"+i+"px;margin:"+a+'px auto;">',t+='<div style="height:30%;"></div><div class="xut-busy-middle">';s--;)t+='<div class="xut-busy-spinner" style="'+c("transform")+":rotate("+r[s]+"deg) translate(0,-142%);"+c("animation-delay")+":-"+o[s]+'s;"></div>';t+='</div><div class="xut-busy-text"></div></div>',Xut.View.busyIcon=$("#busyIcon").html(t)}function j(t){_.extend(this,t),this.id=parseInt(this.id),this.actType=this.type,this.setup(Xut.data.query("Action",this.id,"activityId"))}function z(t){var e=this;return _.extend(this,t),this.$wapper=this.createWapper(),Xut.nextTick({container:e.rootNode,content:this.$wapper},function(){e.rootNode=null,e.bindPMS()}),this}function F(t){_.extend(this,t),this._widgetObj=null;this.widgetName+"Widget";"function"!=typeof window[this.widgetName+"Widget"]?this.loadfile(this.executive):this.executive()}function V(t,e,n){var i=Xut.Presentation.GetPageObj(e.pageType,e.pageIndex);if(!i||!i.canvasRelated.enable||"spirit"!==e.widgetName){var a=new n(e);"bones"!=e.widgetName&&Xut.Application.injectionComponent({pageType:e.pageType,pageIndex:e.pageIndex,widget:a})}}function W(t){return t=U(t),Ta.calculateElement(t)}function U(t){return t.widgetId?_.extend(t,Xut.data.query("Widget",t.widgetId)):_.extend(t,Xut.data.query("Widget",t.activityId,"activityId")),t}function q(t){var e;try{e=JSON.parse(t)}catch(n){e=new Function("return "+t)()}return e}function Q(t){var e,n;return(e=t.inputPara)&&(n=q(e)),n}function Y(t){config=Xut.config,Ta=config.proportion,Pa=config.screenSize,Sa=config.appId;var e=W(t);t=null,e.id=e.activityId,e.inputPara=Q(e),e.inputPara||(e.inputPara={}),"page"===e.widgetType&&(e.inputPara.container=e.rootNode),e.inputPara.uuid=Sa+"-"+e.activityId,e.inputPara.id=e.activityId,e.inputPara.screenSize=Pa,e.inputPara.contentPrefix=Xut.Presentation.MakeContentPrefix(e.pageIndex,e.pageType),e.scrollPaintingMode=config.scrollPaintingMode,e.calculate=config.proportion.calculateContainer(),Ma[(e.widgetType||"widget").toLowerCase()](e)}function J(t){var e;Xut.config.screenSize.width;this.iscroll=e=new iScroll(t,{scrollbars:!0,fadeScrollbars:!0})}function K(t){t.id=parseInt(t.id),t.actType=t.type,_.extend(this,t),this.setup()}function Z(t,e){var n=setTimeout(function(){clearTimeout(n);var i=function(){var n=t.length;return function(){1===n&&(e&&e(),i=null),n--}}();_.each(t,function(t,e){Xut.CreateFilter.has(t.pageId,t.id)?i():t.autoPlay(i)})},500)}function tt(t,e,n,i){var a=t.baseGetPageId(e);void 0===e&&(e=Xut.Presentation.GetPageIndex()),_.each(n,function(n,o){var r=Na[n.type];r&&r.autoPlay&&r.autoPlay({id:n.id,key:n.key,type:n.type,pageType:i,rootNode:t.element,chapterId:a,category:n.category,autoPlay:n.autoPlay,pageIndex:e})})}function et(t,e,n){Xut.IBooks.compileMode()||Xut.accessControl(t,function(t,i,a,o){if("master"===t.pageType){if(t.onceMaster)return;t.onceMaster=!0}n=n||function(){};var r;(r=t.baseAutoRun())&&tt(t,e,r,o),clearTimeout(Ba),i?Z(i,n):n(),Xut.log("debug",o+"\u5c42\uff0c\u7b2c"+(e+1)+"\u9875\u5f00\u59cb,\u672c\u9875\u9762Id\u4e3a"+t.chapterId)})}function nt(t,e,n,i){var a,o,r,s,c,u,l,d;if((a=t.id)&&(o=a.split("_"),r=o[0],s=o[1],c=Na[r],c&&c.eventDelegate)){if(l=function(){return n&&n.id?/page/.test(n.id)?"page":"master":"page"}(),u={id:s,activityId:s,key:a,type:r,rootNode:n,target:t,pageIndex:i,pageType:l},(d=Xut.Application.GetSpecifiedObject(l,u))&&d.dispatchProcess)return d.dispatchProcess();c.eventDelegate(u)}}function it(t,e){Xut.accessControl(t,function(t,n,i){void 0!==e&&(Xut.VideoManager.removeVideo(e),"master"===t.pageType&&Xut.AudioManager.hangUpAudio()),n&&_.each(n,function(t){t.flipOver&&t.flipOver()})})}function at(t){Xut.config.scrollPaintingMode||t&&t()}function ot(t){Xut.accessControl(t,function(t,e,n){if("master"!==t.pageType){var i;(i=t.element)&&(at(function(){i.hide()}),n&&(_.each(n,function(t){t&&t.destroy()}),t.baseRemoveComponent()),e&&_.each(e,function(t){Xut.CreateFilter.has(t.pageId,t.id)||t.resetAnimation&&t.resetAnimation()}),at(function(){setTimeout(function(){i.show(),i=null},0)}))}})}function rt(t){return Xut.accessControl(t,function(t,e,n){var i=!1;return _.each([e,n],function(t){t&&_.each(t,function(t){t.recovery&&t.recovery()&&(i=!0)})}),i})}function st(t,e,n){var i=function(){t.css(Ea("transition"),""),Xut.View.HideBusy(),$a=!1};"in"==n?(Da.refresh(),Da.scrollTo(),t.animate({"z-index":Xut.zIndexlevel(),opacity:1},"fast","linear",function(){e.attr("fly","out"),i()})):(e.attr("fly","in"),t.hide(),i())}function ct(t,e){e.css("opacity","in"===t?.5:1)}function ut(){return $a?!1:($a=!0,Xut.View.ShowBusy(),void lt())}function lt(){var t=$("#backDir"),e=t.attr("fly")||"in",n=$("#navBar");dt(n,e,function(){ct(e,t),st(n,t,e)})}function dt(t,e,n){Da.state=!1,"in"==e&&(Da.state=!0,t.css({"z-index":0,opacity:0,display:"block"})),n&&n()}function ht(t){Da&&Da.state&&(t&&t(),ut())}function pt(t){m({hindex:Xut.Presentation.GetPageIndex(),content:t||"\u518d\u6309\u4e00\u6b21\u5c06\u9000\u56de\u5230\u4e3b\u9875",time:3e3})}function ft(t){var e=!1;return Xut.AudioManager.clearAudio(t)&&(e=!0),Xut.VideoManager.clearVideo()&&(e=!0),e}function vt(t,e){return rt()}function gt(t,e,n){var i=!1;return ft(n)&&(i=!0),vt(t,e)&&(i=!0),ht(function(){i=!0}),i}function mt(t){Ha.pageIndex=t.pageIndex,Ha.novelId=t.novelId,h({pageIndex:t.pageIndex,novelId:t.novelId})}function bt(t){var e=t.pageFlip;return void 0!==e&&(Ha.pageFlip=a(e)),{novelId:a(t.novelId),pageIndex:a(t.pageIndex),history:t.history}}function xt(){var t,e=Xut.data.query("Novel");(t=e.preCode)&&y(t,"novelpre\u811a\u672c")}function yt(t){Ha=Xut.config;var e=bt(t||{});mt(e),xt();var n,i,a;for(a=0;a<Xut.data.Season.length;a++)if(i=Xut.data.Season.item(a),Xut.data.query("sectionRelated",i._id)){n=i._id;break}Xut.View.LoadScenario({main:!0,scenarioId:n,pageIndex:e.pageIndex,history:e.history})}function kt(){La=Xut.config,Ga=Math.round,ja=6,za=Xut.plat.isIOS,Fa=La.iconHeight,Va=La.proportion,Wa=Va.calculateContainer(),Ua=za?20:0,qa=Wa.width,Qa=Wa.height,Va="horizontal"==La.layoutMode?Va.width:Va.height,Fa=za?Fa:Ga(Va*Fa)}function It(){kt();var t="",e=void 0;return t=La.scrollPaintingMode?'<div id="sceneHome" style ="width:'+(La.virtualMode?qa/2:qa)+"px;height:"+Qa+"px;top:"+Wa.top+"px;left:"+Wa.left+"px;z-index:"+Xut.sceneController.createIndex()+'" class="xut-chapter">':'<div id="sceneHome" style ="width:'+(La.virtualMode?qa/2:qa)+"px;height:"+Qa+"px;top:"+Wa.top+"px;left:"+Wa.left+"px;overflow:hidden;z-index:"+Xut.sceneController.createIndex()+'" class="xut-chapter">',t+='<div id="controlBar" class="xut-controlBar hide"></div>',t+='<ul id="pageContainer" class="xut-flip"></ul>',t+='<ul id="masterContainer" class="xut-master xut-flip"></ul>',"horizontal"==La.layoutMode?(Ya=Ga(Qa/ja),e="overflow:hidden;width:100%;height:"+Ya+"px;background-color:white;bottom:4px;border-top:1px solid rgba(0,0,0,0.1)"):(Ja=Math.min(qa,Qa)/(za?8:3),Ya=Ga(.96*(Qa-Fa-Ua)),e="width:"+Ja+"px;height:"+Ya+"px;background-color:white;top:"+(Fa+Ua+2)+"px;left:"+Fa+"px;border-top:1px solid rgba(0,0,0,0.1)"),t+='<div id="navBar" class="xut-navBar" style="'+e+'"></div>',t+='<div id="toolTip"></div>',t+="</div>"}function wt(t){kt();var e="";return e=La.scrollPaintingMode?'<div id="{0}" class="xut-waitLoad" style="width:{1}px;height:{2}px;top:{3}px;left:{4}px;position:absolute;z-index:{5};"><ul id="{6}" class="xut-flip" style="z-index:{7}"></ul><ul id="{8}" class="xut-flip" style="z-index:{9}"></ul></div>':'<div id="{0}" class="xut-waitLoad" style="width:{1}px;height:{2}px;top:{3}px;left:{4}px;position:absolute;overflow:hidden;z-index:{5};"><ul id="{6}" class="xut-flip" style="z-index:{7}"></ul><ul id="{8}" class="xut-flip" style="z-index:{9}"></ul></div>',String.format(e,"scenario-"+t,La.virtualMode?qa/2:qa,Qa,Wa.top,Wa.left,Xut.sceneController.createIndex(),"scenarioPage-"+t,2,"scenarioMaster-"+t,1)}function Ct(t){return new RegExp("(^|\\s+)"+t+"(\\s+|$)")}function Tt(t,e){return"classList"in document.documentElement?t.classList.contains(e):Ct(e).test(t.className)}function Pt(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function St(t,e){if("mouseout"!=t.type&&"mouseover"!=t.type)return!1;for(var n=t.relatedTarget?t.relatedTarget:"mouseout"==t.type?t.toElement:t.fromElement;n&&n!=e;)n=n.parentNode;return n!=e}function Mt(t,e,n){if(this.el=t,this.options=Pt({},this.options),Pt(this.options,n),this.svg=Snap(this.options.size.w,this.options.size.h),this.svg.attr("viewBox","0 0 32 32"),this.el.appendChild(this.svg.node),this.toggled=!1,this.config=e[this.el.getAttribute("data-icon-name")],Tt(this.el,"si-icon-reverse")&&(this.reverse=!0),this.config){var i=this;Snap.load(this.config.url,function(t){var e=t.select("g");i.svg.append(e),i.options.onLoad(),i._initEvents(),i.reverse&&i.toggle(!0)})}}function Xt(t){this.parent=t.parent,this.pageId=t.pageId,this.seasonId=t.seasonId,this.screenSize=Xut.config.screenSize,this.sHeight=screenSize.height,this.sWidth=screenSize.width,this.isStored=!1,this.init()}function Bt(t,e){var n=0,i={};return t===n?(i.currIndex=t,i.rightIndex=t+1):t===e-1?(i.currIndex=t,i.leftIndex=t-1):(i.leftIndex=t-1,i.currIndex=t,i.rightIndex=t+1),i}function Ot(t,e){t.hindex=t.initIndex,this.screenWidth=e.screenSize.width,_.extend(this,t),this.element=t.container,this.speed=t.pageFlip?0:500,this.clickSpeed=600,this.speedRate=this.originalRate=this.speed/this.screenWidth,this.pagePointer=Bt(t.hindex,t.pagetotal),this.prveIndex||(this.prveIndex=this.hindex),this._bindEvt();var n=this.element.querySelectorAll("ul");this.bubbleNode={page:n[0],master:n[1]}}function At(t){var e;return e=t.touches&&t.touches[0]?t.touches[0]:t}function _t(t,e,n){var i,a,o,r,s,c=0,u=[],l=[];for(i=0===t?[t,t+1]:t===n-1?[t-1,t]:[t-1,t,t+1],a=0===e?[e,e+1]:e===n-1?[e-1,e]:[e-1,e,e+1];c<a.length;c++)o=a[c],-1===i.indexOf(o)?l.push(o):u.push(o);return _.each(u,function(t){i.splice(i.indexOf(t),1)}),r=i,s=[].concat(l).concat(u).sort(function(t,e){return t-e}),{create:l,ruleOut:u,destroy:r,viewFlip:s,targetIndex:e,currIndex:t}}function Rt(t){return function(e,n,i,a){if(void 0!==n&&-1===lo.indexOf(n)){var o=i;i=n,a=o,n="page"}return-1!==lo.indexOf(i)&&(n=i,i=null),n=n||"page",t[n]?e(t[n],n,i,a):void console.log("\u4f20\u9012\u5230access\u7684pageType\u9519\u8bef\uff01")}}function Nt(t){return function(e){return void 0==e&&(e=t.hindex),e}}function Et(t){function e(t){var e=Xut.data.query("Content",t);return e?w(_.extend({},e)):void 0}function n(t){return!t||"string"!=typeof t}var i=t.$globalEvent,a=t.options,o=t.$scheduler,r=Rt({page:o.pageMgr,master:o.masterMgr}),s=Nt(i),c=Xut.Presentation;c.GetPageIndex=function(){return i.hindex},_.each(["Section","Page"],function(t){c["GetApp"+t+"Data"]=function(e){var n=0,i=[],a=Xut.data.query("app"+t),o=a.length;for(n;o>n;n++)i.push(a.item(n));return i}}),c.GetFirstPageId=function(t){var e=Xut.data.query("sectionRelated",t),n=Xut.data.query("appPage");return n.item(e.start)},_.each(["GetPageId","GetPageNode","GetPageData","GetPageObj"],function(t){c[t]=function(e,n){return r(function(e,n,i){return i=s(i),e["abstract"+t](i,n)},e,n)}}),c.GetPageElement=function(){var t=c.GetPageObj();return t.element},c.GetPagePrefix=function(t,e){var n=c.GetPageObj(t,e);return n.pid};var u="Content_";c.MakeContentPrefix=function(t){return u+c.GetPagePrefix(t)+"_"},c.GetContentName=function(t){return t?u+c.GetPagePrefix()+"_"+t:u+c.GetPagePrefix()};var l=Xut.View;l.ShowToolbar=function(e){t.$emit("change:toggleToolbar","show",e)},l.HideToolbar=function(e){t.$emit("change:toggleToolbar","hide",e)},l.Toolbar=function(e){t.$emit("change:toggleToolbar",e)},l.GotoPrevSlide=function(t,e){return t&&e?void Xut.View.LoadScenario({scenarioId:t,chapterId:e}):Xut.IBooks.Enabled&&Xut.IBooks.runMode()?void(location.href=Xut.IBooks.pageIndex-1+".xhtml"):void(a.multiplePages&&i.prev())},l.GotoNextSlide=function(t,e){return t&&e?void Xut.View.LoadScenario({scenarioId:t,chapterId:e}):Xut.IBooks.Enabled&&Xut.IBooks.runMode()?void(location.href=Xut.IBooks.pageIndex+1+".xhtml"):void(a.multiplePages&&i.next())},l.GotoSlide=function(e,n){var o=function(t){return t=Number(t)-1,0>t&&(t=0),t};if(Xut.IBooks.Enabled&&Xut.IBooks.runMode()&&n)return void(location.href=n+".xhtml");if(e||n){if(1===arguments.length)return t.$emit("change:showNext"),i.scrollToPage(o(e));if(a.scenarioId==e){var r=Xut.data.query("sectionRelated",e),s=n-r.start;return t.$emit("change:showNext"),i.scrollToPage(o(s))}return l.LoadScenario({scenarioId:e,chapterId:n})}},l.MovePage=function(t,e,n,r){if(!(!a.multiplePages||i.isMove()||"flipMove"===r&&i.isBorder(t))){var s=i.pagePointer,c={distance:t,speed:e,direction:n,action:r,leftIndex:s.leftIndex,pageIndex:s.currIndex,rightIndex:s.rightIndex};o.move(c),s=null}};var d=Xut.Assist;_.each(["Run","Stop"],function(t){d[t]=function(e,n,a){r(function(e,n,a,o){if(_.isArray(a)){var r=function(){var t=a.length;return function(){1===t&&(o&&o(),r=null),t--}}();_.each(a,function(n){e.abstractAssistAppoint(n,i.hindex,r,t)})}else e.abstractAssistAppoint(a,i.hindex,o,t)},e,n,a)}});var h=Xut.Contents;h.Get=function(t,e,n){return r(function(t,e,n,i){function a(e,n){var i;return(i=t.abstractGetPageObj(e))?i.baseGetContentObject(n):void 0}var o,r,s=c.GetPageIndex();if(_.isArray(n))return r=[],_.each(n,function(t){o=a(s,t),i?i(t,o):o?r.push(o):Xut.log("error","\u627e\u4e0d\u5230\u5bf9\u5e94\u7684content\u6570\u636e"+t)}),r;if(/_/.test(n)){var u=n.split("_");if(u.length>1)return a(u[1],u[2])}return o=a(s,n),i?void i(o):o},t,e,n)},h.GetPageWidgetData=function(t,n){if(-1===lo.indexOf(t)&&(n=t,t="page"),n&&n.length){_.isString(n)&&(n=[n]);var i,a=[];return h.Get(t,n,function(t,n){if(n&&(i=n.contentDas))a.push({id:n.id,idName:n.actName,element:n.$contentProcess,theTitle:i.theTitle,scaleHeight:i.scaleHeight,scaleLeft:i.scaleLeft,scaleTop:i.scaleTop,scaleWidth:i.scaleWidth,contentData:i,source:"innerObjet"});else if(i=e(t)){var o,r=c.GetContentName(t);o=n&&n.$contentProcess?n.$contentProcess:$("#"+r),a.push({id:t,idName:r,element:o,theTitle:i.theTitle,scaleHeight:i.scaleHeight,scaleLeft:i.scaleLeft,scaleTop:i.scaleTop,scaleWidth:i.scaleWidth,contentData:i,source:"dataBase"})}else Xut.log("error","\u627e\u4e0d\u5230\u5bf9\u5e94\u7684GetPageWidgetData\u6570\u636e"+t)}),a}},_.each(["Show","Hide","StopAnim"],function(t){h[t]=function(e,a){r(function(e,a,o){if(!n(o)){var r;return(r=e.abstractAssistPocess(i.hindex))?void _.each(o.split(","),function(e){r.baseContentMutex(e,t)}):void console.log("\u6ce8\u5165\u4e92\u65a5\u63a5\u53e3\u6570\u636e\u9519\u8bef\uff01")}},e,a)}});var p=Xut.Application;p.GetSpecifiedObject=function(t,e){return r(function(t,n){var i;return(i=t.abstractGetPageObj(e.pageIndex))?"Content"===e.type?i.baseSpecifiedContent(e):i.baseSpecifiedComponent(e):void 0},t)},_.each(["closeSwipe","openSwipe"],function(t){p[t]=function(){i[t]()}})}function Dt(){}function $t(){this.reset()}function Ht(t){return t=Xut.config.virtualMode?t/2:t,ho("transform")+":translate3d("+t+"px,0px,0px)"}function Lt(){fo=Xut.config.proportion.calculateContainer(),vo=-1*fo.width,go=fo.width,mo=0,bo=po(vo),xo=po(mo),yo=po(go)}function Gt(t,e,n){if(t=Xut.config.virtualMode?t/2:t,n=n||this.element||this.$contentProcess)if(n.css(ho("transform"),"translate3d("+t+"px,0px,0px)"),Xut.config.pageFlip){if(0===t){var i=Xut.sceneController.containerObj("current");i.vm.$globalEvent.setAnimComplete(n)}}else n.css(ho("transition-duration"),e+"ms")}function jt(t,e){Lt();var n,i,a;return t>e?(n=bo,a=vo,i="before"):e>t?(n=yo,a=go,i="after"):t==e&&(n=xo,a=mo,i="original"),[n,i,a,Ht]}function zt(){var t;(t=this.element||this.$contentProcess)&&(t.css(ho("transition-duration"),""),t.css(ho("transform"),"translate3d(0px,0px,0px)"))}function Ft(t,e,n){Gt.apply(this,arguments)}function Vt(t,e){Gt.apply(this,arguments)}function Wt(t,e){"page"===this.pageType&&0===t&&this.element.attr("data-view",!0),Gt.apply(this,arguments)}function Ut(t){return-1===Co.indexOf(t)}function qt(t,e){t?e.attr("data-behavior","swipe"):(e.attr("data-behavior","disable"),this.defaultEvent=!1)}function Qt(t,e){e&&(e.prop("setCursor")||("drag"===t?e.css("cursor","Move"):e.css("cursor","Pointer"),e.prop("setCursor","true")))}function Yt(t){Xut.Contents.Canvas.Reset(),Xut.Contents.Canvas.SupportSwipe=t,Xut.Contents.Canvas.isTap=!0}function Jt(){Xut.Contents.Canvas.isSwipe=!0}function Kt(t){var e;return e=t.touches&&t.touches[0]?t.touches[0]:t}function Zt(t,e,n,i){function a(t){t.mousedown=t.touchstart=r,t.mousemove=t.touchmove=s,t.mouseup=t.touchend=c}function o(t){t.mousedown=t.touchstart=null,t.mousemove=t.touchmove=null,t.mouseup=t.touchend=null}t.isTap=!1;var r=function(e){var n=Kt(e);t.pageX=n.pageX,t.isTap=!0,Yt(i)},s=function(e){if(t.isTap){var n=Kt(e),a=n.pageX-t.pageX;Math.abs(a)&&(t.isTap=!1,Jt(i))}},c=function(e){t.isTap&&n()};return e?(t=t[0],Io?(t.isTap=!0,t.addEventListener("click",c,!1)):Xut.plat.execEvent("on",{context:t,callback:{start:r,move:s,end:c}})):(t.interactive=!0,a(t)),{off:function(){t&&(e?(Io?t.removeEventListener("click",c,!1):Xut.plat.execEvent("off",{context:t,callback:{start:r,move:s,end:c}}),t=null):(t.destroy?t.destroy():o(t),t=null))}}}function te(t){var e=[];switch(t){case"swipeleft":case"swiperight":case"swipeup":case"swipedown":var n=Hammer.DIRECTION_HORIZONTAL;"swipeup"!==t&&"swipedown"!==t||(n=Hammer.DIRECTION_VERTICAL),e.push([Hammer.Swipe,{direction:n,velocity:.01}]);break;case"doubletap":e.push([Hammer.Tap]),e.push([Hammer.Tap,{event:"doubletap",taps:2},["tap"]]);break;case"press":return void e.push([Hammer.Press])}return e}function ee(t,e,n,i){var a;if(n){var o=t[0],r=te(e);a=r&&r.length?Hammer(o,{recognizers:r}):Hammer(o)}else t.interactive=!0,a=Hammer(o,{recognizers:r,pixiContext:t,returnStart:function(t){Yt(i)},returnMove:function(){Jt(i)}});return a}function ne(t,e,n,i,a){var o=ee(t,e,n,a);return o.on(e,function(t){i()}),o}function ie(t,e){var n,i,a,o=e.eventContext,r=e.eventName,s=e.domMode;switch(r){case"drag":n=new DragDropClass(o,null,e.parameter,t.startRun,t.stopRun);break;case"dragTag":n=new DragDropClass(o,e.target,1,t.startRun,t.stopRun);break;default:i=function(){e.eventRun.call(o)},a="tap"===r?Zt(o,s,i,e.supportSwipe):ne(o,r,s,i,e.supportSwipe)}return[n,a,i]}function ae(t){Xut.plat.isBrowser&&t.domMode&&Qt(t.eventName,t.eventContext);var e=t.eventDrop,n=ie(e,t);n[0]&&e.init?e.init(n[0]):t.eventHandler(n[1],n[2])}function oe(t){var e=t.supportSwipe=Ut(t.eventName);t.domMode&&qt(e,t.eventContext),ae(t)}function re(t){return wo[Number(t)-1]||null}function se(t,e){t.eventReference&&(t.eventReference.off(e||t.eventName,t.eventHandler),t.eventReference=null,t.eventHandler=null)}function ce(t,e){var n,i,a;_.each(e,function(o){_.each(o,function(e){return(n=t.baseGetContentObject(e.eventContentId))?(i=n.$contentProcess,a=re(e.eventType),e.runEffects=Po.call(e,t),e.destroy=function(){se(e,a),e.registers=null,e.runEffects=null},void oe({eventRun:function(){e.runEffects();
},eventHandler:function(t,n){e.eventReference=t,e.eventHandler=n},eventContext:i,eventName:a,parameter:e.dragdropPara,target:null,domMode:!0})):void Xut.log("error","pagebase.js\u7b2c"+t.pageIndex+"\u9875\u591a\u4e8b\u4ef6\u5904\u7406\u51fa\u9519!!!!")}),t.listenerHooks.registerEvents=e})}function ue(t,e){ce(t,e)}function le(t){var e;(e=t.listenerHooks.registerEvents)&&_.each(e,function(t){_.each(t,function(t){t.destroy&&t.destroy()})}),t.listenerHooks.registerEvents=null}function de(t,e,n){switch(t){case"page":return pe(e,n);case"master":return ge(e,n);case"chapter":return ve(e);case"scenarioChapter":return he(e)}}function he(t){var e=Xut.data.chapterSection,n=e["seasonId->"+t];return n}function pe(t,e){var n=t.pageIndex,i=t.pageData;i?fe(i,e):ve(n,function(t){fe(t.length?t[0]:t,e)})}function fe(t,e){me(t,function(n,i){e(t,n,i)})}function ve(t){for(var e,n,i=[],a=Xut.data.Chapter,o=t.length;o--;)n=t[o],(e=a.item(n))&&i.unshift(e);return i}function ge(t,e){var n=t.pptMaster,i=Xut.data.query("Master",n);me(i,function(t,n){e(i,t,n)})}function me(t,e){t||e();var n=[],i=t._id;Xut.data.query("Activity",i,"chapterId",function(t){n.push(t)}),be(t,n);var a=xe(n);e(n,a)}function be(t,e){t.note&&e.push(t)}function xe(t){var e,n,i,n,a;if(t&&t.length)return e=[],t.forEach(function(t,o){t.autoPlay&&"Content"!==t.actType&&(i=t._id,n=t.actType?t.actType+"_"+i:"showNote_"+i,a={id:i,type:t.actType,animation:t.animation,key:n,category:t.category,autoPlay:t.autoPlay},e.push(a))}),e.length?e:void 0}function ye(t,e){function n(n){n=n?n:"";var i,o=0,r=e.pageType;return config.virtualMode?("right"===e.virtualOffset&&(o=-(config.screenSize.width-c.offsetLeft)),i=String.format('<li id="{0}" class="xut-flip" data-map="{1}" data-pageType="{2}" data-container="true" style="overflow:hidden;{3}:{4};{5}{6}"><div style="width:{7}px;left:{8}px;height:100%;position:relative"></div></li>',e.prefix,e.pid,r,So("transform"),t,a,n,l,o)):i=String.format('<li id="{0}" class="xut-flip" data-map="{1}" data-pageType="{2}" data-container="true" style="overflow:hidden;{3}:{4};{5}{6}"></li>',e.prefix,e.pid,r,So("transform"),t,a,n),i}var i="",a="",o=e.userStyle,r=e.baseData,s=r.md5;config=Xut.config;var c=config.proportion,u=c.calculateContainer(),l=u.width;u.height;if(/.svg$/i.test(s)||(a="background-image:url("+config.pathAddress+s+");"),void 0!==o){var d="";_.each(o,function(t,e){d+=e+":"+t+";"}),i=n(d)}else i=n();return $(i)}function ke(t,e){var n;if(Xut.IBooks.runMode())return n=$("#"+t.prefix),void e(n,i);var i,a=t.initTransformParameter[0],o=t.initTransformParameter[1],n=ye(a,t),o="before"===o?"first":"last";config.virtualMode&&(i=n.find("div")),Xut.nextTick({container:t.rootNode,content:n,position:o},function(){e(n,i)})}function Ie(t,e,n,i){function a(n){var a=Ce(n,e);a?(n=null,o.compileSuspend($(a),t)):i()}var o=this,r=e.md5,s=!!/.svg$/i.test(r);if(this.callback={suspendCallback:n,successCallback:i},Xut.IBooks.runMode()){t.find(".multilayer");return void i()}this.parseMaster(s,r,a)}function we(t){var e=Xut.config.proportion;t.path=Xut.config.pathAddress,t.imageWidth=t.imageWidth*e.width,t.imageHeight=t.imageHeight*e.height,t.imageLeft=t.imageLeft*e.left,t.imageTop=t.imageTop*e.top}function Ce(t,e){var n,i="",a=e.imageLayer,o=(e.imageMask,e.backImage),r=e.backMask,s=e.master,c=e.md5,u=e.pptMaster;if(c&&!s&&!u&&!a)return t?'<div class="multilayer" data-multilayer ="true" style="width:100%; height:100%;position:absolute;left:0;top:0;z-index:0;">'+t+"</div>":"";if(we(e),i='<div class="multilayer" data-multilayer ="true" style="width:100%; height:100%;position:absolute;left:0;top:0;z-index:0;">',s&&!u&&(i+='<div class="master" style="width:100%; height:100%;background-size:100% 100%;position:absolute;z-index:0;background-image:url({0});"></div>'),a&&(n=e.imageMask?Mo("mask-box-image")+":url("+e.path+e.imageMask+");":"",i+='<div class="imageLayer" style="width:{1}px;height:{2}px;top:{3}px;left:{4}px;position:absolute;z-index:2;background-size:100% 100%;background-image:url({5});{6};"></div>'),o){var l=function(){var t,n=e.pageSide;switch(Number(n)){case 1:t="background-position:0";break;case 2:t="background-position:"+Xut.config.screenSize.width+"px"}return t}();i+=r?void 0!=Mo("mask-box-image")?'<div class="backImage" style="width:{7};height:100%;position:absolute;z-index:1;background-size:100% 100%;background-image:url('+e.path+o+");"+Mo("mask-box-image")+":url("+e.path+r+');{8}"></div>':'<canvas class="backImage edges" height='+document.body.clientHeight+" width="+document.body.clientWidth+'  style="width:{7};opacity:0;height:100%;background-size:100% 100%;position:absolute;z-index:1;-webkit-mask-box-image:url('+e.path+r+');{8}" src='+e.path+o+" mask="+e.path+r+"></canvas>":'<div class="backImage" style="width:{7};height:100%;position:absolute;z-index:1;background-size:100% 100%;background-image:url('+e.path+o+');{8}"></div>'}return c&&(i+='<div class="words" style="width:100%;height:100%;top:0;left:0;position:absolute;z-index:3;">{9}</div>'),i+="</div>",String.format(i,e.path+s,e.imageWidth,e.imageHeight,e.imageTop,e.imageLeft,e.path+a,n,l?"200%":"100%",l?l:"",t)}function Te(t){return Xo[t.category]?"JsWidget":t.actType}function Pe(t,e){t.seasonRelated[e]||(t.seasonRelated[e]={})}function Se(t,e,n){var i,a,o=e.imageId;_.each(["seasonId","Inapp","SearchBar","BookMarks"],function(e){if(a=n[e],void 0!==a)switch(Pe(t,o),e){case"seasonId":i=n.chapterId||n.chapter,t.seasonRelated[o]={seasonId:a[0],chapterId:i?i[0]:""};break;case"Inapp":t.seasonRelated[o].Inapp=a[0];break;default:t.seasonRelated[o][e]=o}})}function Me(t,e){function n(t){return Xe(function(e){return t(e)},i,r,s)}for(var i,a,o,r=(t.length,e.pageType),s=e.pid,c=[],u=[],l={seasonRelated:{},containerRelated:[],eventRelated:{},partContentRelated:[]},d={Container:function(t){t.containerRelated.push(n(function(t){return{Container:t.Content}}))},Contents:function(t){var e;if(e=n(function(t){return{Contents:[t]}})[0]){var a=i.imageId,o={eventContentId:a,activityId:i._id,registers:e.activity,eventType:i.eventType,dragdropPara:i.para1},r=t.eventRelated["eventContentId->"+a];r?r.push(o):t.eventRelated["eventContentId->"+a]=[o]}},JsWidget:function(t){var e=g(i.itemArray);_.isArray(e)?_.each(e,function(e){t.partContentRelated.push(e.id)}):t.partContentRelated.push(e.id)}};i=t.shift();)a=Te(i),(!d[a]||d[a]&&d[a](l))&&(o=n(function(t){switch(Se(l,i,t),r){case"page":return Oe(["Animation"],t);case"master":return Oe(["Animation","Parallax"],t)}}),i.imageId?u.push(o):c.push(o));u.length&&(c=c.concat(u));var h,p,f="createRelevant-"+e.chapterId,v=ra[f];if(v||(v=ra(f,Be(c,l.partContentRelated,r))),h=v[0].slice(0),p=v[1].slice(0),Xut.CreateFilter.size()){var m=Xut.CreateFilter.each(e.chapterId);m&&(m(h,function(t){h.splice(t,1)}),m(p,function(t){p.splice(t,1)}),m=null)}return _.extend(e,l,{createImageIds:h,createContentIds:p,originalCreateContentIds:p.slice(0),activityRelated:c})}function Xe(t,e,n,i){function a(t){if(t&&d){var e=t.indexOf(d);-1!==e&&t.splice(e,1)}}var o,r,s,c,u,l="",d=e.imageId,h=_e(e.itemArray)||[],p=t(h),f=Object.keys(p)[0];switch(f){case"Container":o=p.Container,a(o);break;case"Contents":return p.Contents;default:_.keys(p).length&&(u=p.Animation,s=p.Parallax,"page"===n?u&&(o=u.ids,l=u.das):(u&&(o=u.ids,l=u.das),s&&(r=s.ids,c=s.das)),o&&r&&(o=o.concat(r)),!o&&r&&(o=r),a(o))}return{pageType:n,activity:e,imageIds:d,seed:{animation:l,parallax:c},ids:{content:o,parallax:r}}}function Be(t,e,n){function i(t,e,n){for(var i,a=e.length;a--;)i=Number(e[a]),t.push(i),n&&n(i)}for(var a,o,r,s,u,l,d=[],h=[],p=t.length;p--;)u=t[p],a=u.ids,o=a.content,l=a.parallax,s=u.imageIds,o&&o.length&&i(d,o),l&&l.length&&i(d,l),s&&h.push(Number(s));return e&&e.length&&_.each(e,function(t){t&&(d=d.concat(t))}),r=c(h.length?d.concat(h):d),r=r.sort(function(t,e){return t-e}),[h,r]}function Oe(t,e){var n,i={};return _.each(t,function(t){(n=e[t])&&(i[t]?console.log("\u672a\u5904\u7406\u89e3\u6790\u540c\u4e00\u4e2a\u8868"):i[t]=Ae(t,n))}),i}function Ae(t,e){var n,i,a,o,r={},s=[],c=[],u=Xut.data.query;_.each(e,function(e){(a=u(t,e))&&(o=a.contentId,-1===c.indexOf(o)&&c.push(o),i="contentId-"+o,r[i]?r[i].push(a):r[i]=[a])});for(n in r)s.push(r[n]);return{das:s,ids:c}}function _e(t){var e,n,i={};if(t)return e=g(t),e.length?_.each(e,function(t){n=t.actType,i[n]||(i[n]=[]),i[n].push(t.id)}):(n=e.actType,i[n]=[],i[n].push(e.id||e.value)),i}function Re(t){var e,n=Oo[t],i=0,a=!0,o=function(){clearTimeout(i),i=null},r=function s(){if(!a)return void o();if(Oo[t]){var r=n.fns;for(e in r)r[e]();i=Bo(function(){s()})}};return r(),this.stop=function(){a&&(a=!1,o())},this.activate=function(){a||(a=!0,r())},this}function Ne(t){var e=Xut.Presentation.GetPageIndex();if(e===t){var n=Oo[e];n.rAF?n.rAF.activate():n.rAF=new Re(e)}}function Ee(t){var e,n=+new Date,i=!0;+new Date-n>100&&(i=!1,clearTimeout(e),e=null)}function De(t,e,i,a){Oo[t]||(Oo[t]=n(),Oo[t].rAF=0,Oo[t].fns=n(),Oo[t].types=n(),Oo[t].length=0,Oo[t].pageIndex=t),Oo[t].fns[e]?console.log("rQueue"+e+"\u5df2\u5b58\u5728"):(Oo[t].fns[e]=i,Oo[t].types[e]=a,++Oo[t].length),Ne(t)}function $e(t,e){Oo[t]&&Oo[t].fns?(delete Oo[t].fns[e],delete Oo[t].types[e],--Oo[t].length,Object.keys(Oo[t].fns).length||Oo[t].rAF&&Oo[t].rAF.stop()):console.log("\u5220\u9664\u7684\u9875\u9762\u4e0d\u5b58\u5728")}function He(t){Oo[t]&&(Oo[t].rAF&&Oo[t].rAF.stop(),Object.keys(Oo[t].fns).length||delete Oo[t])}function Le(){return Xut.guid("rAF")}function Ge(t,e){var n=Xut.config.screenSize.width,i=Xut.config.screenSize.height,a=t.pageIndex,o=PIXI.autoDetectRenderer(n,i,{transparent:!0});o.view.style.position="absolute",o.view.style.zIndex=e,t.element.append(o.view);var r=new PIXI.Container,s={stageWidth:n,stageHeight:i,container:o.view,containerStage:r,sprites:{},addChild:function(t){r.addChild(t)},display:function(){Ee(a,function(){o.render(r)})},oneRender:function(){o.render(r)},play:function(t,e){var n=Le();return De(a,n,function(){e&&e(),o.render(r)},t),n},stop:function(t){$e(a,t)},destroy:function(){t.canvasRelated&&(He(a),t.canvasRelated.container=null,t.canvasRelated.containerStage&&t.canvasRelated.containerStage.removeChildren(),t.canvasRelated=null)}};_.extend(t.canvasRelated,s)}function je(t,e){var n,i=[];return t.forEach(function(t,a){n=Xut.data.query("Content",t),i.unshift(n),e&&e(n,t)}),i}function ze(t,e,n,i,a){var o="_"+i+"_"+t;return{pageType:n,contentId:t,isJs:/.js$/i.test(e.md5),isSvg:/.svg$/i.test(e.md5),data:e,pid:i,virtualOffset:a,containerName:"Content"+o,makeId:function(t){return t+o}}}function Fe(t,e){var n,i=e.md5,a=/.gif$/i.test(i),o=Xut.config.pathAddress+i;n=a?Xut.createRandomImg(o):o,t.imgContent=i,t.isGif=a,t.pathImg=n}function Ve(t,e){var n="";return n+=We(t,e),n+=qe(t,e),n+="</div></div>"}function We(t,e){var n,i,a,o,r,s,c=t.zIndex,u=(t._id,e.containerName),l=(e.pid,e.makeId),d=t.background?"background-image: url("+Xut.config.pathAddress+t.background+");":"";return t.scaleBackWidth&&t.scaleBackHeight?(a=t.scaleBackWidth,o=t.scaleBackHeight,r=t.scaleBackLeft,s=t.scaleBackTop,e.backMode=!0):(a=t.scaleWidth,o=t.scaleHeight,r=t.scaleLeft,s=t.scaleTop),i="visible",t.visible&&(i="hidden"),e.isJs?(n='<div id="{0}" data-behavior="click-swipe" style="overflow:hidden;width:{1}px;height:{2}px;top:{3}px;left:{4}px;position:absolute;z-index:{5};visibility:{6};background-size:100% 100%;{10}"> <div id="{7}" style="width:{8}px;position:absolute;">',String.format(n,u,a,o,s,r,c,i,l("contentWrapper"),a,o,d)):(n='<div id="{0}" data-behavior="click-swipe" style="overflow:hidden;width:{1}px;height:{2}px;top:{3}px;left:{4}px;position:absolute;z-index:{5};visibility:{6};"> <div id="{7}" style="width:{8}px;height:{9}px;{10}position:absolute;background-size:100% 100%;">',String.format(n,u,a,o,s,r,c,i,l("contentWrapper"),a,o,d))}function Ue(t,e){t.isSvg?C(t.data.md5,function(n){t.svgstr=n,e(t)}):t.isJs?C(t.data.md5,function(n){t.htmlstr=n,e(t)},"js"):e(t)}function qe(t,e){var n="";return n+=e.imgContent?e.isSvg?Ye(t,e):e.isJs?Qe(t,e):Je(t,e):Ke(t,e)}function Qe(t,e){return e.htmlstr}function Ye(t,e){var n="",i=e.svgstr,a=t.scaleWidth;if(void 0!=i){var o=i.search('viewBox="'),r=i.substring(o,o+64).replace('viewBox="',"").replace("0 0 ",""),s=r.search('"'),c=r.substring(0,s),u=c.split(" "),l=u[0],d=u[1],h=Math.floor(a*d/l);if(h>t.scaleHeight+1){var p=Math.floor(a),f=e.backMode?t.scaleLeft-t.scaleBackLeft:0,v=e.backMode?t.scaleTop-t.scaleBackTop:0;c='<div style="width:{0}; height:{1};margin-left:{2}px;margin-top:{3}px;">{4}</div>',n=t.isScroll?String.format(c,p+"px",h+"px",f,v,i):String.format(c,"100%","100%",f,v,i)}else n+=i}return n}function Je(t,e){var n="",i=t.mask?Ao("mask-box-image")+":url("+Xut.config.pathAddress+t.mask+");":"";if(t.mask||e.isGif)n+=void 0!=Ao("mask-box-image")?String.format('<img id="img_{1}" class="contentScrollerImg" src="{0}" style="width:{2}px;height:{3}px;position:absolute;background-size:100% 100%;{4}"/>',e.pathImg,t._id,t.scaleWidth,t.scaleHeight,i):String.format(' <canvas src="{0}" class="contentScrollerImg edges" mask="{5}" id = "img_{1}" width="{2}" height="{3}" style="width:{2}px; height:{3}px;opacity:0; background-size:100% 100%; {4}" />',e.pathImg,t._id,t.scaleWidth,t.scaleHeight,i,Xut.config.pathAddress.replace(/\//g,"/")+t.mask);else if("Sprite"==t.category){var a=100*t.thecount,o=100;if(t.parameter){var r=Utils.parseJSON(t.parameter);if(r&&r.matrix){var s=r.matrix.split("-");a=100*Number(s[0]),o=100*Number(s[1])}}n+=String.format('<div class="sprite" style="height:{0}px;background-image:url({1});background-size:{2}% {3}%;"></div>',t.scaleHeight,e.pathImg,a,o)}else n+=String.format('<img src="{0}" class="contentScrollerImg" id="img_{1}" style="width:{2}px;height:{3}px;position:absolute;background-size:100% 100%; {4}"/>',e.pathImg,t._id,t.scaleWidth,t.scaleHeight,i);return n}function Ke(t){return String.format('<div id = "{0}" style="background-size:100% 100%;height:auto">{1}</div>',t._id,t.content)}function Ze(t,e,n){var i=je([e]),a=w(i[0]),o='<div id="{0}" data-behavior="click-swipe" style="width:{1}px;height:{2}px;top:{3}px;left:{4}px;position:absolute;z-index:{5};">';return String.format(o,t,a.scaleWidth,a.scaleHeight,a.scaleTop,a.scaleLeft,a.zIndex)}function tn(t,e){var n,i,a,o={createUUID:[],containerName:[]};return t.forEach(function(t,r){i=t.imageIds,a="Container_"+e+"_"+i,n="aaron"+Math.random(),o[n]={start:[Ze(a,i,e)],end:"</div>"},o.createUUID.push(n),o.containerName.push(a),t.itemIds.forEach(function(t){o[t]=n})}),o}function en(t,e,n){function i(t,e,n){X[n]=e,r(n,t)}function a(t){e.createContentIds.splice(e.createContentIds.indexOf(t),1),s()}function o(t,e,n,o){"left"===e.virtualOffset&&(t.scaleLeft<Xut.config.screenSize.width?i(e,n,o):a(o)),"right"===e.virtualOffset&&(t.scaleLeft>Xut.config.screenSize.width?i(e,n,o):a(o))}function r(t,e){Ue(e,function(e){var n,i,a,o=e.data;Fe(e,o),o.canvasMode||(a=Ve(o,e)),d&&(n=d[t])?(i=d[n],i.start.push(a)):B.unshift(a),s()})}function s(){if(1===v)if(d){var e,i,a=[];d.createUUID.forEach(function(t){e=d[t].start.join(""),i=d[t].end,a.push(e.concat(i))}),a=a.join(""),containerName=d.containerName,d=null,t.call(n,X,B.join("").concat(a),containerName,S,P)}else t.call(n,X,B.join(""),"",S,P);v--}var c,u,l,d,h,p,f,v,m=(e.createImageIds,e.pid),b=e.pageType,x=e.containerRelated,y=e.seasonRelated,k="master"===b,I=e.virtualOffset,C=e.floatMaters,T=e.floatPages,P=[],S=[],M=1,X={},B=[],O=e.canvasRelated.enable;x&&x.length&&(d=tn(x,m));var A=function(t,e,n){var i;_.each(t,function(t){i=t.topmost,i&&0!=i&&(k?(C.ids.push(e),C.zIndex[e]=i):(T.ids.push(e),T.zIndex[e]=i))})},R=function(t,n,i){-1==e.canvasRelated[t].indexOf(n)&&(e.canvasRelated[t].push(n),i.actionTypes[t]=!0),-1==e.canvasRelated.cid.indexOf(n)&&e.canvasRelated.cid.push(n),i.canvasMode=!0,i.zIndex&&i.zIndex>M&&(M=i.zIndex)},N={Sprite:function(t,e){R("spiritId",t,e)},PPT:function(t,e){R("pptId",t,e)},SeniorSprite:function(t,e){R("widgetId",t,e)}},E=function(t,e){var n,i,a=t.category;if(k&&(n=y[e])&&n.BookMarks&&C.ids.push(e),t){if(O&&a){var o,r=a.split(","),s=r.length;if(t.actionTypes={},s)for(;s--;)o=r[s],N[o]&&N[o](e,t)}t.parameter&&(i=g(t.parameter))&&A(i.length?i:[i],e,t)}};for(p=je(e.createContentIds,E),f=v=p.length,O&&Ge(e,M);f--;)(c=p[f])?(u=c._id,l=ze(u,c,b,m,I),S.push(l.containerName),l.isJs&&P.push(u),h=w(l.data),Xut.config.virtualMode?o(h,l,c,u):i(l,c,u)):s()}function nn(t){for(var e;e=t.shift();)e()}function an(t,e,n){function i(t){conStructure({dydCreate:!0,createContentIds:f,pid:h,pageType:p},function(e,n,i){t(e,$(n),i)})}function a(t){_.each(t,function(t,e){d[t.id]=t})}function o(){_.each(l,function(e,n){var i;e.$contentProcess||(i=t.createHandlers(e,"waitCreate"),l.splice(n,1,i))})}function r(){var n,i,a=t.relatedData.collectEventRelated,o=[];return _.each(e,function(t){n=a[t],n&&!n.isBind&&(i=n.parent,i.createEvent.call(i),o.push(function(){i.bindEvent.call(i)}))}),o}function s(){t.waitCreateContent=null}function c(e){Xut.nextTick({container:t.rootNode,content:e},function(){s(),nn(t.relatedCallback.iScrollHooks),n()})}function u(t,e,i){e&&a(e),o(),nn(r()),self.initEffects(),e?c(e):(s(),n())}var l=t.abstractContents,d=t.relatedData.contentsFragment,h=t.pid,p=t.pageType,f=function(){var n,i=[];return _.each(e,function(e){n=t.makePrefix("Content",t.pid,e),d[n]||i.push(e)}),i};f&&f.length?i(u):u()}function on(t){function e(t){var e,n,i;if(Do){e=0;try{n=Do.sheet,i=n.cssRules,e=i.length,n.insertRule(t,e)}catch(a){console.log(a)}}else Do=_o.createElement("style"),Do.type="text/css",Do.innerHTML=t,Do.uuid="aaron",_o.head.appendChild(Do)}function n(t){if(Do){var e,n=Do.sheet,i=n.rules||n.cssRules,a=0,o=i.length;for(a;o>a;a++)if(e=i[a],e.name===t){n.deleteRule(a);break}0==i.length&&(_o.head.removeChild(Do),Do=null)}}function i(t,e,n,i){var a;return s?(a="{0} {1}s step-start {2}",String.format(a,t,e,i)):(a="{0} {1}s steps({2}, end) {3}",String.format(a,t,e,n,i))}function a(t,e){if(s){var n=[],i=100/h,a=Number(s[0]);n.push("0% { background-position:0% 0%}");for(var o=0;h>o;o++){var r=(Math.ceil((o+1)/a),Math.floor(o/a)),c=r*a,e=100*(o-c),u=100*r;e=0==e?e:"-"+e,u=0==u?u:"-"+u,n.push((o+1)*i+"% { background-position: "+e+"% "+u+"%}")}return t+"{"+n.join("")+"}"}var l="{0} {from { background-position:0 0; } to { background-position: -{1}px 0px}}";return String.format(l,t,Math.round(e))}function o(t,e){Ho&&t.css(Ho,e)}function r(t){No&&e(No+t)}var s,c=t.element,u=t.data,l=t.callback||function(){},d="sprite_"+t.id,h=u.thecount,p=u.fps,f=Math.round(1/p*h*10)/10,v=Math.ceil(u.scaleWidth*h),m=u.loop?"infinite":1;if(u.parameter){var b=g(u.parameter);b&&b.matrix&&(s=b.matrix.split("-"))}var x=i(d,f,h,m),y=a(d,v);return o(c,x),r(y),c.on(Eo,l),{runSprites:function(){c.show().css($o,"")},stopSprites:function(){n(d),c.off(Eo,l),c=null},pauseSprites:function(){c.css($o,"paused")},playSprites:function(){c.css($o,"")}}}function rn(t){function e(){g=setTimeout(function(){m.src=p+v+f,v++,n()},1e3/l)}function n(){"paused"!==o&&(v>c?u?(v%=c,e()):(g=null,callback()):e())}function i(t){var e=t.split("."),n="."+e[1],e=e[0].split("-"),i=e[0]+"-",a=e[1]-0;return{name:i,ext:n,num:a}}var a=t.element,o="",r=t.data,s=r.md5,c=r.thecount||0,u=r.loop,l=r.fps||1,d=Xut.config.pathAddress,h=i(s),p=d+h.name,f=h.ext,v=h.num||0,g=0,m=_o.createElement("img");return m.src=d+s,a.append(m),e(),{runSprites:function(){o="play",e()},stopSprites:function(){clearTimeout(g),o="paused",v=0,a=null,m=null},pauseSprites:function(){o="paused"},playSprites:function(){o="play",n()}}}function sn(t){function e(){l%15==0&&(f.position.x=-i[d],p.render(h),d++,d>i.length-1&&(d=0,l=0)),l++,requestAnimFrame(e)}var n=t.element.parent(),i=t.data,a=(t.callback||function(){},i.thecount),o=(i.fps,Math.ceil(i.scaleWidth)),r=Math.ceil(i.scaleHeight),s=(!!i.loop,Xut.config.proportion.width),c=Xut.config.proportion.height,u=Xut.config.pathAddress+i.md5,l=0,d=0,i=[],h=new PIXI.Stage(16777215),p=PIXI.autoDetectRenderer(o,r,null,!0);n.empty().append(p.view);var f=new PIXI.Sprite.fromImage(u);f.scale.x=s,f.scale.y=c;for(var l=0;a>l;l++)i.push(l*o);h.addChild(f),requestAnimFrame(e)}function cn(t){function e(){r%15==0&&(n.position.x=-i[s],s++,s>i.length-1&&(s=0,r=0)),r++}for(var n=t.element,i=t.data,a=i.thecount,o=Math.ceil(i.scaleWidth),r=(Math.ceil(i.scaleHeight),!!i.loop,0),s=0,i=[],r=0;a>r;r++)i.push(r*o);requestAnimFrame(e)}function un(t){var e=t.mode||"css";switch(e){case"css":return on(t);case"timer":return rn(t);case"canvas":return cn(t);default:return sn(t)}}function ln(t,e){var n=!1;t&&_.each(t,function(t,e){return t.videoId?(n=!0,"breaker"):void 0}),n&&Xut.AudioManager.clearContentAudio(e)}function dn(t,e,n){t?e.call(t,t):n&&n()}function hn(){this.id=Fo++,this.subs=[]}function pn(t,e,n){var i,a={},o="",r=0,s=0,c=0,u=Math.round,l=Xut.plat.prefixStyle,i=n;return void 0==e.translateX&&void 0==e.translateY&&void 0==e.translateZ||(r=u(e.translateX)||0,s=u(e.translateY)||0,c=u(e.translateZ)||0,i+=r,o+=String.format("translate3d({0}px,{1}px,{2}px) ",i,s,c)),void 0==e.rotateX&&void 0==e.rotateY&&void 0==e.rotateZ||(r=u(e.rotateX),s=u(e.rotateY),c=u(e.rotateZ),o+=r?"rotateX("+r+"deg) ":"",o+=s?"rotateY("+s+"deg) ":"",o+=c?"rotateZ("+c+"deg) ":""),void 0==e.scaleX&&void 0==e.scaleY&&void 0==e.scaleZ||(r=u(100*e.scaleX)/100||1,s=u(100*e.scaleY)/100||1,c=u(100*e.scaleZ)/100||1,o+=String.format("scale3d({0},{1},{2}) ",r,s,c)),void 0!=e.opacity&&(a.opacity=u(100*(e.opacityStart+e.opacity))/100,o+=";"),o&&(a[l("transform")]=o,t.css(a)),i}function fn(t){return t.opacityStart>-1&&(t.opacity=(t.opacityEnd||1)-t.opacityStart,delete t.opacityEnd),t}function vn(t,e,n){var i={},a=-n.width,o=-n.height;for(var r in t)switch(r){case"translateX":case"translateZ":i[r]=t[r]*e*a;break;case"translateY":i[r]=t[r]*e*o;break;case"opacityStart":i[r]=t[r];break;default:i[r]=t[r]*e}return i}function gn(t){Uo=Xut.config.screenSize;try{var e=JSON.parse(t.getParameter()[0].parameter)}catch(n){return!1}var i=t.pid,a=fn(e),o=this.relatedData.pageOffset&&this.relatedData.pageOffset.split("-"),r=o[0],s=o[1],c=(r-1)/(s-1),u=vn(a,c,Uo),l=1/(s-1),d=pn(t.$contentProcess,_.extend({},u),t.transformOffset);return t.parallax={calculateRangePage:function(){return{start:i-r+1,end:s-r+i}},translate:a,offsetTranslate:u,nodeProportion:l,rootNode:t.$contentProcess,parallaxOffset:d},t}function mn(t,e){var n,i=t.getParameter();return 1!==i.length||(n=i[0],"EffectAppear"!==n.animationName||"auto"!==e||n.videoId||n.delay||"Sprite"===t.contentDas.category||n.preCode||n.postCode||/"inapp"/i.test(n.parameter))?void 0:t.isRreRun=/"exit":"False"/i.test(n.parameter)===!0?"visible":"hidden"}function bn(t,e,n,i,a,o,r){var s,c={type:"dom",canvasMode:!1,domMode:!0},u=t.pageType;return t.canvasRelated.enable&&-1!==t.canvasRelated.cid.indexOf(e)&&(s={},c.type="canvas",c.canvasMode=!0,c.domMode=!1),s||(s=t.findContentElement(i))?(_.extend(c,{base:t,id:e,pid:n,actName:i,contentDas:a,$contentProcess:s,pageType:u,pageIndex:t.pageIndex,canvasRelated:t.canvasRelated,nextTask:t.nextTask}),r&&"master"===u?c.processType="parallax":c.processType="animation",c.getParameter=function(){var t="parameter-"+u+"-"+c.processType;return c[t]=o,function(){return c[t]}}(),"parallax"===c.processType?(c.transformOffset=t.relatedData.transformOffset(c.id),gn.call(t,c)):(mn(c,t.eventData.eventName),new Vo(c))):void 0}function xn(t,e,n){if(n)return bn.apply(t,e);var i=e[0],a=i.contentId,o=t.pid,r=t.makePrefix("Content",o,a),s=t.relatedData.contentDas[a];return bn(t,a,o,r,s,e,i.masterId)}function yn(t){return function(e,n){var i,a;if(e&&e.length)for(;i=e.shift();)(a=xn(t,i))&&n(a)}}function kn(t,e){for(property in e)void 0===t[property]&&(t[property]=e[property])}function In(t){var e=t.seed.animation,n=t.seed.parallax,i=[],a=yn(t);switch(t.pageType){case"page":a(e,function(t){i.push(t)});break;case"master":var o={},r={},s=[];a(n,function(t){o[t.id]=t}),a(e,function(t){r[t.id]=t});var c=_.keys(o).length,u=_.keys(r).length;c&&u&&(_.each(r,function(t){var e,n=t.id;(e=o[n])&&(kn(t,e),t.processType="both",delete o[n])}),_.keys(o).length&&_.extend(r,o),o=null),_.each(u?r:o,function(t){s.push(t)}),i=s}return a=null,i}function wn(t){this.parent=t.parent,this.tips=t.tips,this.init()}function Cn(t){this.parent=t.parent,this.pageId=t.pageId,this.seasonId=t.seasonId,this.isStored=!1,this.init()}function Tn(){var t=Xut.config.proportion.width,e=document.documentElement;try{Ko=parseInt(getComputedStyle(e).fontSize)}catch(n){Ko=16}Ko*=t,e.style.fontSize=Ko+"px",Zo=Math.floor(1.5*Ko),tr=Math.floor(2*Ko),er=Math.floor(2.5*Ko)}function Pn(){var t='  <div class="htmlbox_close_container">        <a class="htmlbox_close"></a> </div> <ul class="htmlbox_fontsizeUl">    <li>        <a class="htmlbox_small" style="width:{0}px;height:{1}px;margin-top:-{2}px"></a>     </li>     <li>        <a class="htmlbox_middle" style="width:{3}px;height:{4}px;margin-top:-{5}px"></a>     </li>    <li>        <a class="htmlbox_big" style="width:{6}px;height:{7}px;margin-top:-{8}px"></a>    </li> </ul>';return String.format(t,Zo,Zo,Zo/2,tr,tr,tr/2,er,er,er/2)}function Sn(t,e,n,i){var a=' <div id="{0}" class="htmlbox_container">    <div class="htmlbox-toolbar">{1}</div>    <div id="{2}" style="overflow:hidden;position:absolute;width:100%;height:92%;">        <ul>          {3}        </ul>     </div> </div>';return String.format(a,t,e,n,i)}function Mn(t,e){Tn(),this.contentId=t,this.element=e;var n=this,i=function(t,e){n.eventReference=t,n.eventHandler=e};oe({eventRun:function(){Xut.View.HideToolbar(),n.init(t,e)},eventHandler:i,eventContext:e,eventName:"tap",domMode:!0})}function Xn(t){t.eventContext.interactive=!0,nr[t.eventName](t)}function Bn(t){return{context:{wait:!1,statas:!1,_ids:[],check:function(){var e=this.length();return e.length||(this.statas=!0),this.wait?void(t&&t()):!this.wait&&this.statas?void(this.wait=!0):void 0},add:function(t){-1===this._ids.indexOf(t)&&this._ids.push(t)},remove:function(t){if(t){var e=this._ids.indexOf(t),n=this._ids.splice(e,1);return this.check(n),n}},length:function(){return this._ids.length}},event:[],pre:{}}}function On(t){return _.extend(this,t),this.nextTask=Bn(this.monitorComplete),this.createEventRelated(),this.waitCreateContent=[],this.abstractContents=In(this),this.htmlTextBox(),this.registerEvent(),this.createActions(),this._fixAudio=[],this.nextTask.context.wait?(this.monitorComplete(),this):this.nextTask.context.length()?(this.nextTask.context.wait=!0,this):void this.monitorComplete()}function An(t,e){t&&t.dragDrop&&e(t.dragDrop)}function _n(t){var e;t=_.extend(this,t),(e=zn(t))?(t=Me(e,t),t.createContentIds.length?this.dataAfterCheck(t):this.loadComplete()):this.loadComplete()}function Rn(t,e,n){var i=t[e];i||(i=t[e]={}),n.call(i)}function Nn(t){var e=[];return _.each(t,function(t){e.push(t)}),e}function En(t){var e={};return _.each($(t),function(t,n){e[t.id]=t}),e}function Dn(t){var e,n,i,a,o=t.feedbackBehavior={};_.each(t.activitys,function(t){t.parameter&&(e=g(t.parameter))&&(i=t.imageId,(a=e.isButton)&&0!=a&&Rn(o,i,function(){this.isButton=!0}),(n=e.behaviorSound)&&0!=n&&Rn(o,i,function(){this.behaviorSound=n}))})}function $n(t,e,n,i,a){var o=[],r="Content_"+i.pid+"_";n.ids=c(n.ids);var s,u,l,d=n.zIndex;i.count++,_.each(n.ids,function(t){s=r+t,(u=i.contentsFragment[s])&&(l=d[t],o.push(u),delete i.contentsFragment[s])}),l="floatPages"===e&&0===a.initTransformParameter[2]?2001:2e3;var h="overflow:hidden;";"floatMaters"===e&&(h="");var p=String.format('<div id="'+e+'-li-{0}" class="xut-float" style="'+Xut.plat.prefixStyle("transform")+":{1};z-index:"+l+';{2}"></div>',i.pid,a.initTransformParameter[0],h),f=$(p);$(i.rootNode).after(f),t(o,f)}function Hn(t,e,n){$n(function(i,a){e.floatMaters.container=a,Xut.nextTick({container:a,content:i},function(){t.pageBaseHooks.collector.floatMaters(e.floatMaters),n(e)})},"floatMaters",e.floatMaters,e,t)}function Ln(t,e,n){$n(function(i,a){e.floatPages.container=a,Xut.nextTick({container:a,content:i},function(){t.pageBaseHooks.collector.floatPages(e.floatPages),n(e)})},"floatPages",e.floatPages,e,t)}function Gn(){return"autoRun-"+Math.random().toString(36).substring(2,15)}function jn(t,e,n){for(var i,a=e.element,o=e.eventRelated,r=e.pid,s=e.activityRelated,c=e.feedbackBehavior,u=e.pageBaseHooks,l=e.chapterId,d=function(t,e){return function(n){return t.length&&t[n]?e:0}}(e.floatMaters.ids,e.initTransformParameter[2]),h={iscrollHooks:[],contentsHooks:u.collector.contents},p={floatMaters:e.floatMaters,seasonId:e.chpaterData.seasonId,pageId:l,contentDas:n,container:e.liRootNode,seasonRelated:e.seasonRelated,containerPrefix:e.containerPrefix,nodes:e.nodes,pageOffset:e.pageOffset,createContentIds:e.createContentIds,partContentRelated:e.partContentRelated,transformOffset:d,contentsFragment:e.contentsFragment,contentHtmlBoxIds:e.contentHtmlBoxIds},f={},v=function(){o&&u.eventBinding&&u.eventBinding(o),delete h.contentsHooks,t(h)},g={total:s.length,current:0,complete:function(){++g.current,g.current==g.total&&v()}};i=s.shift();){var m,b=i.imageIds,x=i.activity,y=x.eventType,k=x.para1,I=b;(m=o["eventContentId->"+b])&&_.each(m,function(t){t.eventType==x.eventType&&(y=k=void 0)});var w={eventContentId:I,eventType:y,dragdropPara:k,feedbackBehavior:c};I&&(f[I]=w,p.collectEventRelated=f),u.registerAbstractActivity(new On({monitorComplete:g.complete,pageIndex:e.pageIndex,canvasRelated:e.canvasRelated,id:b||Gn(),type:"Content",pageId:l,activityId:x._id,rootNode:a,pageType:i.pageType,seed:i.seed,pid:r,eventData:w,relatedData:p,relatedCallback:h}))}}function zn(t){var e,n=[];return _.each(t.activitys,function(t){if(e=t.actType||t.animation,!e&&t.note&&(t.actType=e="ShowNote"),t.itemArray||2!==t.autoPlay)switch(e){case"Container":case"Content":case"Parallax":case"Contents":n.push(t)}}),n.length?n:null}function Fn(t,e,n){if(Xut.IBooks.runMode())return void n();if(t.activitys.length){var i;this.rootNode=t.rootNode,this.callback={suspendCallback:e,successCallback:n},i=this.create(t),this.compileSuspend(i)}else n()}function Vn(t,e){function n(t,e){var n;if(a.dataCache[t])for(n in e)a.dataCache[t][n]=e[n];else a.dataCache[t]=e}function i(t,e,i){n(a.pageType,t),n("activitys",e),n("autoRunDas",i)}var a=this,o=a.pageType;de(o,{pageIndex:t,pageData:a.chapterDas,pptMaster:a.pptMaster},function(t,n,a){i.apply(i,arguments),e(t)})}function Wn(){}function Un(t){var e,n,i=document.getElementsByTagName("canvas"),a=new Array,o=0,r=0;for(o=0;o<i.length;o++){e=i[o],n=e.className.split(" ");for(var r=0;r<n.length;r++)if(n[r]==t){a.push(e);break}}return a}function qn(t){function e(){o.clearRect(0,0,t.width,t.height),o.globalCompositeOperation="source-over",o.drawImage(i,0,0,t.width,t.height),a.src=t.getAttribute("mask"),i.removeEventListener("load",e),i.src=null,i=null}function n(){o.globalCompositeOperation="destination-atop",o.drawImage(a,0,0,t.width,t.height),t.style.opacity=1,a.removeEventListener("load",n),a.src=null,a=null,o=null,classNames=null,t.className=t.className.replace("edges","")}var i=new Image,a=new Image;classNames=t.className.split(" ");var o=t.getContext("2d");i.addEventListener("load",e),a.addEventListener("load",n),i.src=t.getAttribute("src")}function Qn(){var t,e=Un("edges");for(t=0;t<e.length;t++)qn(e[t])}function Yn(t){this.pageType="page",this.rootNode=t.options.rootPage,this.abstractCreateCollection()}function Jn(t){var e=Xut.Presentation.GetPageId(t);Xut.VideoManager.removeVideo(e)}function Kn(t,e){var n;(n=t.chapterDas[e])&&y(n,e)}function Zn(t){var e=Xut.config;this.screenWidth=e.screenSize.width,this.screenHeight=e.screenSize.height,this.pageType="master",this.rootNode=t.options.rootMaster,this.recordMasterscope={},this.recordMasterId={},this.currMasterId=null,this.parallaxProcessedContetns={},this.abstractCreateCollection()}function ti(t){var e=[];if(!t.length){for(var n in t)e.push(t[n]);t=e}return t}function ei(t){Xut.data=vr=t}function ni(t){var e,n=vr[t];n.length&&n.item(0)&&(e=n.item(0)._id)&&(vr[t].start=e)}function ii(){var t,e={},n=vr.Video;return _.each(n,function(i,a){t=n.item(a),t&&t.activityId&&(e[t.activityId]=t._id)}),e}function ai(){var t,e,n,i,a,o,r,s={},c=vr.Chapter,u=c.length,l=function(t){
for(var e,n=vr.Season.length;n--;)if((e=vr.Season.item(n))&&e._id==t)return e};for(n=0;u>n;n++)r=c.item(n),r&&(i=r._id-1,t=r.seasonId,e="seasonId->"+t,s[e]?(s[e].end=i,s[e].length=s[e].length+1):((a=l(t))&&(o=a.parameter),s[e]={start:i,length:1,end:i,toolbar:o}));return s}function oi(){for(var t in vr)vr[t].item&&ni(t);vr.Video&&(mr=ii()),gr=ai(),vr.novelId=pr.novelId,vr.preventContent=function(){return!vr.Content.length}(),vr.query=function(t,e,n,i){function a(){var n=vr[t];if(e){var i=e-n.start;return n.item(i)}return n.length?n.item(0):null}switch(n){case"activityId":for(var o,r=e,s=vr[t],c=0,u=s.length;u>c;c++)if(o=s.item(c),o&&o[n]==r)return o;return;case"chapterId":case"seasonId":var l=e,s=vr[t];if(s)for(var o,c=0,u=s.length;u>c;c++)o=s.item(c),o&&o[n]==l&&i&&i(o);return}switch(t){case"appPage":return vr.Chapter;case"appSection":return vr.Season;case"sectionRelated":return gr["seasonId->"+e];case"Video":if(n)return a();var e=mr[e];return vr.query("Video",e,!0);default:return a()}},vr.oneQuery=function(t,e){pr.oneQuery(t,function(t){e&&e(t)})},vr.remove=function(t,e,n,i){var a=pr.remove(t,e);a.done(n,i)}}function ri(){return pr.collectError}function si(){return $.Deferred(function(t){pr.query().done(function(e){var n=e.Novel;pr.novelId=n.item(0)._id;ei(e),oi(),t.resolve(e.Setting,n.item(0))})}).promise()}function ci(t,e){var n=e.currIndex;t.pageMgr.abstractAssistPocess(n,function(t){t.element.css({"z-index":9997})}),t.callMasterMgr(function(){this.abstractAssistPocess(n,function(t){t.element.css({"z-index":1})})})}function ui(t,e,n){for(var i,a=0,o=[],r=e.create,s=e.targetIndex;a<r.length;a++)i=r[a],o.push(function(e,n){return function(i){t.create([n],e,"toPage",i,{opacity:0})}}(s,i));e.pageBaseCollect=[];var c,u,a=0,u=c=o.length;if(o&&c)for(;c>a;a++)o[a].call(t,function(t){1===u&&(o=null,setTimeout(function(){n(e)},100)),e.pageBaseCollect.push(t),u--})}function li(t,e){var n=e.currIndex,i=t.pageMgr;t.suspend({stopPointer:n}),_.each(e.destroy,function(t){t!==e.currIndex&&i.clearPage(t)}),_.each(e.ruleOut,function(t){t>e.targetIndex&&i.abstractAssistAppoint(t,function(t){Translation.fix.call(t,"nextEffect")}),t<e.targetIndex&&i.abstractAssistAppoint(t,function(t){Translation.fix.call(t,"prevEffect")})});var a;t.callMasterMgr(function(){a=this.makeJumpPocesss(e),a.pre()}),i.clearPage(n),a&&a.clean(e.currIndex,e.targetIndex),_.each(e.pageBaseCollect,function(t){_.each(t,function(t){t.element&&t.element.css({opacity:1})})}),e.pageBaseCollect=null,a=null}function di(t,e,n){ci(t,e),ui(t,e,function(e){li(t,e),n.call(t,e)})}function hi(t){return t%2==0?"left":"right"}function pi(t,e){var n;if(this.options.multiScenario){if(n=this.options.sectionRang,!e&&_.isArray(t))return t.forEach(function(e,i){t.splice(i,1,e-n.start)}),t;t-=n.start,e+=n.start}else if(_.isArray(t))return t;return{pageIndex:t,visiblePid:e}}function fi(t,e,n){var i,a,o,r=Xut.config.proportion.calculateContainer(),s=r.width;switch(n){case"prev":switch(t){case"flipMove":i=e-s,a=e,o=e+s;break;case"flipRebound":i=-s,a=e,o=s;break;case"flipOver":i=0,a=s,o=2*s}break;case"next":switch(t){case"flipMove":i=e-s,o=e+s,a=e;break;case"flipRebound":i=-s,o=s,a=e;break;case"flipOver":i=-2*s,o=e,a=-s}}return[i,a,o]}function vi(t,e,n){function i(t){void 0!==t.leftIndex&&(o.leftIndex=t.leftIndex,r.push(t.leftIndex)),void 0!==t.currIndex&&(o.currIndex=t.currIndex,r.push(t.currIndex)),void 0!==t.rightIndex&&(o.rightIndex=t.rightIndex,r.push(t.rightIndex))}var a=0,o={},r=[];return i(1!==e&&n?t===a?{currIndex:t,rightIndex:t+1}:t===e-1?{currIndex:t,leftIndex:t-1}:{currIndex:t,leftIndex:t-1,rightIndex:t+1}:{currIndex:t}),this.pagePointer=o,r}function gi(t,e){var n,i,a;return t[0]!==e&&(n=t.indexOf(e),a=t.splice(n,1),t=a.concat(t)),this.options.multiScenario&&(i=this.options.sectionRang.start,t.forEach(function(e,n){t.splice(n,1,e+i)})),t}function mi(t){return de("chapter",t)}function bi(){var t=ri();return!(-1!==t.indexOf("Master")||!Xut.data.Master||!Xut.data.Master.length)}function xi(t){this.vm=t,this.options=t.options,this.pageMgr=new Yn(t),bi()&&(this.masterMgr=new Zn(t))}function yi(t){function e(t,e){var n,i,a,o,r=t.target;if(r.nodeType){if(r===this)return{rootNode:this,elem:r,handlers:c["data-container"]};try{for(;r!==this;r=r.parentNode||this){if(r.nodeName&&"canvas"===r.nodeName.toLowerCase())return!!Xut.Contents.Canvas.getSupportState();a=r.attributes;for(n in c)if(i=a[n])return o=i.value,{rootNode:this,elem:r,attribute:o,pageType:e,handlers:c[n]}}}catch(s){}}}function n(t){var e="page";return t.dataset&&t.dataset.belong&&(e=t.dataset.belong),e}function i(t,e){!Xut.plat.isBrowser||Xut.IBooks.Enabled||MMXCONFIG||t.preventDefault&&t.preventDefault()}xr=Xut.config;var a=this,o={pageFlip:xr.pageFlip,pageMode:!1,multiScenario:!1,multiplePages:!1};o=a.options=_.extend(o,t),Xut.IBooks.Enabled?o.multiplePages=!1:o.multiplePages=o.pageFlip?o.pageFlip:!!o.pageMode;var r=a.$globalEvent=new Ot(o,xr),s=a.$scheduler=new xi(a),c={"data-xxtlink":function(t,e,n,i){try{var a=e.split("-");a.length>1?Xut.View.GotoSlide(a[0],a[1]):Xut.View.GotoSlide(a[0])}catch(o){console.log("\u8df3\u8f6c\u9519\u8bef")}},"data-delegate":function(t,e,n,i){nt.apply(null,arguments)},"data-canvas":function(t){}};o.multiplePages&&_.extend(c,{"data-container":function(){a.$emit("change:toggleToolbar")},"data-multilayer":function(){a.$emit("change:toggleToolbar")},"data-behavior":function(t,e,n,i){"click-swipe"==e&&a.$emit("change:toggleToolbar")}});var u=null;r.$watch("filter",function(t,a,o){var s,c,l;s=a.target,i(o,s),c=n(s),l=r.findRootElement(a,c),u=e.call(l,a,c),u&&"disable"!==u.attribute||t()}),r.$watch("onSwipeMove",function(){s.move.apply(s,arguments)}),r.$watch("onSwipeUp",function(t,e){u&&(u.handlers?u.handlers(u.elem,u.attribute,u.rootNode,t):Xut.Contents.Canvas.getIsTap()||a.$emit("change:toggleToolbar"),u=null,e())}),r.$watch("onSwipeUpSlider",function(t){s.suspend(t)}),r.$watch("onAnimComplete",function(t,e,n,i){s.complete.apply(s,arguments)}),r.$watch("onJumpPage",function(t){s.jumpPage(t)}),r.$watch("onDropApp",function(t){GLOBALIFRAME&&Xut.publish("magazine:dropApp")}),r.$watch("onMasterMove",function(t,e){/Content/i.test(e.id)&&e.getAttribute("data-parallaxProcessed")&&s.masterMgr&&s.masterMgr.reactivation(e)}),a.$overrideApi()}function ki(t,e,n){if(t=g(t)){var i=Number(t.pageMode);n=_.isFinite(i)?i:n,_.isString(t.tbType)&&(e=_.map(t.tbType.split(","),function(t){return Number(t)}))}return{tbType:e,pageMode:n}}function Ii(t){var e=Xut.data.query("sectionRelated",t),n=e.toolbar,i=e.length,a=[1],o=i>1?2:0;return ki(n,a,o)}function wi(t,e){var n=[0],i=e>1?1:0;return ki(t,n,i)}function Ci(t,e,n){return function(i,a){var o;return o=n?"#"+i:"#"+a+e,t.find(o)[0]}}function Ti(t){if(kr.deBugHistory)return Xut.View.LoadScenario(kr.deBugHistory),!0;if(t){var e=ya.seqReverse(t);return e?(e=e.split("-"),Xut.View.LoadScenario({scenarioId:e[0],chapterId:e[1],pageIndex:e[2]}),!0):!1}}function Pi(t){kr=Xut.config;var e=t.seasonId,n=t.chapterId,i=_.extend(this,t,{scenarioId:e,chapterId:n,container:$("#sceneContainer")}),a=function(){Xut.IBooks.Enabled||_.extend(this,this.initToolBar()),this.createViewModel(),ya.add(e,n,this)};this.createScenario(a,i)}function Si(t,e,n,i){if(Sr)return!1;try{var a=Xut.data.query("sectionRelated",t).toolbar,o=[];if(a=JSON.parse(a),!a.Inapp)return!1;if(Pr==a.Inapp||Pr==p(inAppId))return Xi(),!1;if(Tr==a.Inapp&&a.inappInfo){if(o=_.map(a.inappInfo.split("-"),function(t){return Number(t)}),o[0]==e&&o[1]==t)return!1;Xr.LoadScenario({scenarioId:o[1],chapterId:o[0],createMode:n,pageIndex:i,isInApp:"isInApp"})}}catch(r){console.log("Data error:",r)}return!0}function Mi(t){return parseInt(p(t))}function Xi(){Sr=!0}function Bi(){if(Xr.busyBarState){var t=wr.db,e="UPDATE Setting SET value=? WHERE name=?";t.transaction(function(t){t.executeSql(e,[null,"Inapp"])},function(t){h(inAppId,Pr)}),Xi(),Xr.CloseScenario(),Xr.HideBusy()}}function Oi(){Xr.busyBarState&&(k("\u8d2d\u4e70\u5931\u8d25"),Xr.HideBusy())}function Ai(t){function e(e){v(t,e)}function i(){var e=p(t);return g(e)}function a(e,n,i){return"transformFilter"===t&&void 0===i&&(i=n,n="transformFilter"),e(n,Number(i))}var o=function(){var t=i(),e=n();return t&&_.each(t,function(t,n){e[n]=t}),e}();return{add:function(t,n){a(function(t,n){o[t]||(o[t]=[]),-1===o[t].indexOf(n)&&(o[t].push(n),e(o))},t,n)},remove:function(t,n){a(function(t,n){var i=o[t]||[],a=i.indexOf(n);-1!==a&&(i.splice(a,1),e(o))},t,n)},has:function(t,e){return a(function(t,e){var n=o[t];return n?-1!==n.indexOf(e):!1},t,e)},each:function(t){return a(function(t,e){var n;return(n=o[t])?function(t,e){_.each(n,function(n){var i=t.indexOf(n);-1!==i&&e(i)})}:void 0},t)},size:function(){return _.keys(o).length},empty:function(){_remove(t),o={}}}}function _i(t){return parseInt(p(t))}function Ri(t){var e,n,i=_i("pageIndex"),a=_i("pageFlip")||0;return Xut.IBooks.Enabled?($("#removelayer").remove(),void LoadScene({pageIndex:Xut.IBooks.CONFIG.pageIndex})):((n=t.parameter)&&(n=g(n),a=n.pageflip,void 0!==a&&h({pageFlip:a})),_r.recordHistory&&void 0!==i&&(e=_i("novelId"))?yt({pageFlip:a,novelId:e,pageIndex:i,history:p("history")}):void yt({novelId:t._id,pageIndex:0,pageFlip:a}))}function Ni(){si().done(function(t,e){Ei(t),$i(e),Ri(e)})}function Ei(t){for(var e,n={},i={},a={ToolbarPos:0,NavbarPos:1,HomeBut:1,ContentBut:1,PageBut:1,NavLeft:1,NavRight:1,customButton:0,CloseBut:SUbDOCCONTEXT?1:0},o=0,r=t.length;r>o;o++)e=t.item(o),n[e.name]=e.value;_.defaults(n,a);for(o in a)i[o]=Number(n[o]);_r.settings=i,_r.appId=n.appId,_r.shortName=n.shortName,_r.Inapp=n.Inapp,_r.appUUID=n.adUpdateTime?n.appId+"-"+/\S*/.exec(n.adUpdateTime)[0]:n.adUpdateTime,Xut.Application.CheckOut(),_r.initResourcesPath(),h({appId:n.appId}),Di(n),Xut.Presentation.AdsId=n.adsId,n.scrollPaintingMode&&1==n.scrollPaintingMode&&(_r.scrollPaintingMode=!0),_r.scrollPaintingMode&&_r.screenSize.width<_r.screenSize.height&&(_r.virtualMode=!0),Xut.CreateFilter=Ai("createFilter"),Xut.TransformFilter=Ai("transformFilter")}function Di(t){var e=1;void 0!==t.recordHistory&&(e=Number(t.recordHistory)),!e&&_r.isBrowser&&_r.debugMode&&(e=1),_r.recordHistory=e}function $i(t){t&&(t.pptWidth||t.pptHeight)&&_r.setProportion(t.pptWidth,t.pptHeight)}function Hi(){var t=_r.db,e="SELECT * FROM Novel";t?t.transaction(function(t){t.executeSql(e,[],function(t,e){Ni()},function(){Xut.config.db=null,Ni()})}):Ni()}function Li(){if(_r=Xut.config,Xut.IBooks.Enabled||G(),window.openDatabase)try{_r.db=window.openDatabase(_r.dbName,"1.0","Xxtebook Database",_r.dbSize)}catch(t){console.log("window.openDatabase\u51fa\u9519")}Hi()}function Gi(){Rr.load()}function ji(t){return Xut.isRunSubDoc?void Xut.publish("subdoc:dropApp"):(Nr=!0,void Xut.Application.Suspend({dispose:function(){setTimeout(function(){Nr=!1},100)},processed:function(){"back"===t&&Xut.Application.DropApp()}}))}function zi(t){t._event={back:function(){Rr.state?Rr.closeVideo():ji("back")},pause:function(){ji("pause")}}}function Fi(){Xut.Application.delayAppRun();var t=Xut.Video5({url:"duku.mp4",startBoot:function(){Xut.Application.LaunchApp()}});t.play()}function Vi(){var t=Xut.config,e=t.isBrowser;zi(t),DUKUCONFIG||GLOBALIFRAME||!Xut.plat.isIOS||Fi(),GLOBALIFRAME?Wi(t):e?Ui(t):(window.openDatabase(t.dbName,"1.0","Xxtebook Database",t.dbSize),document.addEventListener("deviceready",Wi,!1))}function Wi(t){if(Xut.plat.isAndroid&&(MMXCONFIG||DUKUCONFIG||Gi(),SUbCONFIGT||(Xut.Application.AddEventListener=function(){GLOBALCONTEXT.document.addEventListener("backbutton",t._event.back,!1),GLOBALCONTEXT.document.addEventListener("pause",t._event.pause,!1)})),DUKUCONFIG){var e=e||require("PMS");e.bind("MagazineExit",function(){e.unbind(),Xut.Application.DropApp()},"*")}Xut.Plugin.XXTEbookInit.startup(t.dbName,Ui,function(){})}function Ui(t){Xut.config.revised();var e="./css/"+Xut.config.layoutMode+".css",n="./content/gallery/svgsheet.css",i=[e,n];Xut.IBooks.Enabled&&!Xut.IBooks.existSvg&&(i=[e]),Ji.load(i,function(){r(),Li()},null,!0)}var qi={};qi["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};var Qi,Yi=Object.defineProperty,Ji=function(){return{load:function(t,e,n,i){if(t.length&&i){var a=[];t.forEach(function(t,e){t&&a.push(t)}),t=a.reverse(),a=null}var n=n||this,o=document.getElementsByTagName("head")[0],r=document.createDocumentFragment(),s=t.length,c=0,u=function(e){o.appendChild(n.buildScriptTag(t[e],l))},l=function(){c++,s==c&&"function"==typeof e?e.call(n):i===!0&&u(c)};if(i===!0)u.call(this,0);else{for(var d=0,h=t.length;h>d;d++)r.appendChild(this.buildScriptTag(t[d],l));o.appendChild(r)}},buildScriptTag:function(t,e){var n=t.substr(t.lastIndexOf(".")+1);if("js"==n){var i=document.createElement("script");return i.type="text/javascript",i.src=t,i.onload=e,i}if("css"==n){var a=document.createElement("link");return a.rel="stylesheet",a.type="text/css",a.href=t,e(),a}}}}(),Ki=d,Zi=window.localStorage,ta="aaron",ea=function(){var t="aaron-"+(new Date).getDate();return Xut.config.db&&Xut.config.db.transaction(function(e){e.executeSql("UPDATE Setting SET 'value' = "+t+" WHERE [name] = 'appId'",function(){},function(){})},function(){},function(){}),t},na=function(t){return Qi?t+Qi:(Xut.config.appUUID||(Xut.config.appUUID=ea()),Qi=SUbCONFIGT&&SUbCONFIGT.dbId?"-"+Xut.config.appUUID+"-"+SUbCONFIGT.dbId:"-"+Xut.config.appUUID,t+Qi)},ia=void 0,aa=void 0,oa=void 0,ra=T(),sa=50,ca=function(t,e){var n=t.ownerDocument.defaultView.getComputedStyle(t,null);return n.getPropertyValue(e)};B.prototype={createSubtitle:function(t){function e(e){_.each(t,function(t,n){var a=n.split("-");i.action(a[0],e,a[1],t)}),i.createSubtitle(t)}function n(){var n;a.getCurrentPosition?a.getCurrentPosition(function(t){t=1e3*t,i.changeValue||(i.changeValue=t),t-=i.changeValue,t>-1&&(n=Math.round(t)),e(n)},function(e){console.log("error:"+e),i.createSubtitle(t)}):a.expansionCurrentPosition?(n=Math.round(1e3*a.expansionCurrentPosition()),e(n)):(n=Math.round(1e3*a.currentTime),e(n))}var i=this,a=this.audio;this.options;i.timer=setTimeout(function(){n()},sa)},action:function(t,e,n,i){if(e>t-sa&&t+sa>e)if(this.recordRepart[i.start]||"start"!==n){if(!this.recordRepart[i.end]&&"end"===n){this.recordRepart[i.end]=!0;var a=this.ancestors[i.id];a&&(a.style.visibility="hidden")}}else this.recordRepart[i.start]=!0,this.createDom(i)},createDom:function(t){function e(t,e,a){n(t,a),i(e,a)}function n(t,e){var n="position       :absolute; display        :table;vertical-align :center;top            :{0}px;left           :{1}px;height         :{2}px;width          :{3}px;";t.style.cssText=String.format(n,d,h,p,f)}function i(t,e){var n=" text-align     :center; display        :table-cell; vertical-align :middle; color          :{0}; font-family    :{1}; font-bold      :{2}; font-size      :{3}px; line-height    :{4}%";t.style.cssText=String.format(n,e.fontColor,e.fontName,e.fontBold,e.fontSize*o,v),t.innerHTML=e.title}var a=Xut.config.proportion,o=a.width,r=(a.height,Xut.config.screenSize.width,Xut.config.screenSize.height,t.id),s=this.parents[r],c=this.ancestors[r],u=this.cacheCreateDivs[r],l=u&&u.children[0],d=t.top*a.top,h=t.left*a.left,p=t.height*a.height,f=t.width*a.width,v=t.lineHeight?t.lineHeight:"100%";if(u)e(u,l,t);else{var g=document.createElement("div"),m=document.createElement("p");e(g,m,t),g.appendChild(m),s.appendChild(g),this.cacheCreateDivs[r]=g}if(c){var b=ca(c,"visibility");"visible"!=b&&(c.style.visibility="visible")}},destroy:function(){var t=this;_.each(this.cacheCreateDivs,function(t){t.parentNode.removeChild(t)}),_.each(this.ancestors,function(e,n){var i=t.orgAncestorVisibility[n],a=ca(e,"visibility");a!=i&&(e.style.visibility=i)}),this.ancestors=null,this.cacheCreateDivs=null,this.changeValue=0,this.parents=null,this.timer&&(clearTimeout(this.timer),this.timer=0)}};var ua=n(),la=void 0,da=Xut.CoreObject.extend({preRelated:function(t,e){this.innerCallback=e.innerCallback,this.outerCallback=9999==t?e.complete:null},afterRelated:function(t,e,n){e.data&&e.data.repeat&&(this.repeat=Number(e.data.repeat)),e.action&&(this.acitonObj=X(e)),e.subtitles&&e.subtitles.length>0&&(this.subtitleObject=new B(t,e,n)),this.outerCallback&&this.outerCallback.call(this)},callbackProcess:function(t){this.outerCallback?this.end():!Xut.plat.isAndroid&&this.repeat?this.repeatProcess():this.innerCallback(this)},repeatProcess:function(){--this.repeat,this.play()},play:function(){this.audio&&!this.isFlash&&(this.status="playing",this.audio.play()),this.acitonObj&&this.acitonObj.play()},pause:function(){this.status="paused",this.audio.pause(),this.acitonObj&&this.acitonObj.pause()},end:function(){this.status="ended",this.audio.end(),this.audio=null,this.acitonObj&&this.acitonObj.destroy()},destroyRelated:function(){this.subtitleObject&&(this.subtitleObject.destroy(),this.subtitleObject=null),this.acitonObj&&(this.acitonObj.destroy(),this.acitonObj=null)}}),ha=da.extend({init:function(t,e){var n,i=Xut.config.audioPath()+t.url,a=t.trackId,o=this;this.preRelated(a,t),n=new GLOBALCONTEXT.Media(i,function(){o.callbackProcess(!0)},function(){o.callbackProcess(!0)}),this.audio=n,this.trackId=a,this.options=t,this.afterRelated(n,t,e)},end:function(){this.audio&&(this.audio.release(),this.audio=null),this.status="ended",this.destroyRelated()}}),pa=(da.extend({init:function(t,e){var n,i=t.trackId,a=Xut.config.audioPath()+t.url,o=this;this.preRelated(i,t),n=new Audio5js({swf_path:"./lib/data/audio5js.swf",throw_errors:!0,format_time:!0,ready:function(t){this.load(a),this.play(),o.status="playing"}}),this.audio=n,this.trackId=i,this.status="playing",this.options=t,this.isFlash=!0,this.afterRelated(n,t,e)},end:function(){this.audio&&(this.audio.destroy(),this.audio=null),this.status="ended",this.destroyRelated()}}),da.extend({init:function(t,e){var n,i=t.trackId,a=Xut.config.audioPath()+t.url,o=this;this.preRelated(i,t),ua[i]?(n=Xut.fix.audio?Xut.fix.audio:ua[i],n.src=a):(Xut.fix.audio?(n=Xut.fix.audio,n.src=a):n=new Audio(a),Xut.fix.audio||(ua[i]=n),n.addEventListener("ended",function(){o.callbackProcess()},!1),n.addEventListener("error",function(){o.callbackProcess()},!1)),this.audio=n,this.trackId=i,this.status="playing",this.options=t,this.afterRelated(n,t,e)},end:function(){this.audio&&(this.audio.pause(),this.audio.removeEventListener("ended",this.callbackProcess,!1),this.audio.removeEventListener("error",this.callbackProcess,!1),this.audio=null),this.status="ended",this.destroyRelated()}})),fa=function(){return O(4)+"-"+O(2)+"-"+O(2)+"-"+O(2)+"-"+O(6)},va=da.extend({init:function(t,e){var n,i=Xut.config.audioPath()+t.url,a=t.trackId,o=this;this.id=fa(),this.preRelated(a,t);var n={startPlayingAudio:function(){audioHandler.startPlayingAudio(o.id,i)},pausePlayingAudio:function(){audioHandler.pausePlayingAudio(o.id)},release:function(){audioHandler.release(o.id)},expansionCurrentPosition:function(){return getCurrentPosition(o.id)}};this.audio=n,this.trackId=a,this.options=t,this.afterRelated(n,t,e)},play:function(){this.audio&&(this.status="playing",this.audio.startPlayingAudio()),this.acitonObj&&this.acitonObj.play()},pause:function(){this.status="paused",this.audio&&this.audio.pausePlayingAudio(),this.acitonObj&&this.acitonObj.pause()},end:function(){this.audio&&(this.audio.release(),this.audio=null),this.status="ended",this.destroyRelated()}});la=Xut.plat.isAndroid&&!Xut.plat.isBrowser?ha:MMXCONFIG&&audioHandler?va:pa,Xut.Audio=la,Xut.AudioManager=A();var ga=null,ma=function(){};(function(){var t=document.createElement("video"),e='video/mp4; codecs="avc1.42E01E, mp4a.40.2"';return!!t.canPlayType&&"probably"==t.canPlayType(e)})(),function(){var t=!1;if(navigator.plugins)for(var e=0;e<navigator.plugins.length;e++)-1!=navigator.plugins[e].name.toLowerCase().indexOf("shockwave flash")&&(t=!0);return t}();Xut.plat.isBrowser?ga=D:Xut.plat.isIOS||top.EduStoreClient?ga=Xut.IBooks.Enabled?H:D:Xut.plat.isAndroid&&(ga=E),R.prototype={play:function(){Xut.View.Toolbar("hide"),this.video.play()},stop:function(){Xut.View.Toolbar("show"),this.video.stop()},close:function(){this.video.close()}},Xut.Video5=D,Xut.Video=R,L.prototype={autoPlay:function(t,e,n){this.initVideo.apply(this,arguments)},trigger:function(t,e,n){this.initVideo.apply(this,arguments)},initVideo:function(t,e,n){this.parseVideo(t,e),this.loadVideo(t,e,n)},parseVideo:function(t,e){if(!this.checkRepeat(t,e)){var n=Xut.data.query("Video",e);this.deployVideo(n,t,e)}},checkRepeat:function(t,e){var n=this.pageBox[t];return!(!n||!n[e])},deployVideo:function(t,e,n){var i=Xut.config.proportion,a=Xut.config.screenSize,o={pageId:e,videoId:n,url:t.md5,pageUrl:t.url,left:t.left*i.left||0,top:t.top*i.top||0,width:t.width*i.width||a.width,height:t.height*i.height||a.height,padding:t.padding*i.left||0,zIndex:t.zIndex||2147483647,background:t.background,category:t.category,hyperlink:t.hyperlink};"object"!=qi["typeof"](this.pageBox[e])&&(this.pageBox[e]={}),this.pageBox[e][n]=o},loadVideo:function(t,e,n){var i=this.playBox,a=this.pageBox[t][e];i[t]&&i[t][e]?i[t][e].play():("object"!==qi["typeof"](i[t])&&(i[t]={}),i[t][e]=new R(a,n))},beforePlayVideo:function(t,e){},removeVideo:function(t){var e=this.playBox,n=this.pageBox;if(e&&e[t]){for(var i in e[t])e[t][i].close();delete this.playBox[t]}n&&n[t]&&delete this.pageBox[t]},clearVideo:function(){var t=this.playBox,e=!1;for(var n in t)for(var i in t[n])t[n][i].close(),e=!0;return this.playBox={},this.pageBox={},e},leavePage:function(t){var e=this.playBox;if(e&&e[t])for(var n in e[t])e[t][n].stop()},showIconFlag:function(t){},hideIconFlag:function(t){}},Xut.VideoManager=new L;var ba=999999,xa={scenarioStack:[],scenarioChain:[]},ya={createIndex:function(){return--ba},add:function(t,e,n){return xa.scenarioStack.push(t),xa["scenarioId->"+t]=n,xa.scenarioChain.push({scenarioId:t,chapterId:e}),n},takeOutPrevChainId:function(){xa.scenarioChain.pop();return xa.scenarioChain.length>1?xa.scenarioChain.pop():xa.scenarioChain[0]},checkToRepeat:function(t){var e,n=xa.scenarioChain.length;if(e=n>1?xa.scenarioChain[n-2]:xa.scenarioChain[n-1],e.scenarioId==t&&this.takeOutPrevChainId(),xa.scenarioStack[0]==t){var i=xa.scenarioChain.shift();xa.scenarioChain.length=0,xa.scenarioChain.push(i)}},containerObj:function(t){if("current"===t){var e=xa.scenarioStack;t=e[e.length-1]}return xa["scenarioId->"+t]},findIndexOfId:function(t){return xa.scenarioStack.lastIndexOf(t)},remove:function(t){var e=this.findIndexOfId(t);xa.scenarioStack.splice(e,1),delete xa["scenarioId->"+t]},destroyAllScene:function(){var t=_.clone(xa.scenarioStack);_.each(t,function(t){xa["scenarioId->"+t].destroy()}),xa.scenarioChain=[]},rewrite:function(t,e){_.each(xa.scenarioChain,function(n){n.scenarioId==t&&(n.chapterId=e)})},expose:function(){return xa},sequence:function(t,e){var n=xa.scenarioChain;if(n.length>1){var i=[];return _.each(n,function(n){n.scenarioId==t?i.push(n.scenarioId+"-"+n.chapterId+"-"+e):i.push(n.scenarioId+"-"+n.chapterId)}),i}},seqReverse:function(t){var t=t.split(","),e=t.length;return 1===e?!1:2===e?t[1]:(_.each(t,function(t,n){if(n>=1&&e-1>n){var t=t.split("-");xa.scenarioChain.push({scenarioId:t[0],chapterId:t[1],pageIndex:t[2]})}}),t[e-1])}};Xut.sceneController=ya,j.prototype={setup:function(t){var e=t.para1,n=(t.para2,t._id);switch(actionType=parseInt(t.actionType),actionType){case 0:this.toPage(e);break;case 1:if(Xut.plat.isBrowser)return;Xut.Plugin.OpenApp.openAppAction(e,function(t){},function(t){});break;case 2:this.loadSubdoc(e,n)}this.state=!0},open:function(){this.state=!0,Xut.Plugin.OpenApp.openAppAction(para1,function(t){},function(t){})},toPage:function(t){t=JSON.parse(t),t.seasonId?Xut.View.GotoSlide(t.seasonId,t.chapterId):Xut.View.GotoSlide(t)},loadSubdoc:function(t,e){var n,i=this;window.XXTSUbDOC={path:t,dbId:e},this.subPath=t,n=this.$wapper=this.createWapper(),Xut.nextTick({container:$(this.rootNode),content:n},function(){i.destroyCache()})},iframeComplete:function(){var t=this;Xut.one("subdoc:dropApp",function(){t.destroyCache("iframe",t.iframe[0].contentWindow)}),Xut.View.HideToolbar(),Xut.isRunSubDoc=!0,t.$wapper.css({opacity:"1"})},destroyCache:function(t){function e(){Xut.View.ShowToolbar(),i.$wapper.remove(),i.$wapper=null,i.iframe=null,i.rootNode=null,Xut.isRunSubDoc=!1}var n,i=this;t?n=!0:t=window;try{t.require("Dispatcher",function(t){n?t.stopHandles()?t.promptMessage("\u518d\u6309\u4e00\u6b21\u5c06\u9000\u51fa\u5b50\u76ee\u5f55\uff01"):e():t.stopHandles()})}catch(a){e()}},createWapper:function(){var t,e,n,i;return t=0===this.zIndex?this.zIndex:this.zIndex||Xut.zIndexlevel(),this.zIndex=t,e='<div id="Subdoc_{0}" style="z-index:{1};width:{2}px;height:{3}px;top:{4}px;left:{5}px;position:absolute;opacity:0" ></div>',n=String.format(e,this.id,t,this.screenSize.width,this.screenSize.height,0,0),i=this.iframe=this.createIframe(),$(n).append(i)},createIframe:function(){var t=this,e="content/subdoc/"+this.subPath+"/index.html?xxtParaIn="+this.key,n=document.createElement("iframe");return n.id="iframe_"+this.id,n.src=e,n.style.width="100%",n.style.height="100%",n.sandbox="allow-scripts allow-same-origin",n.frameborder=0,n.attachEvent?n.attachEvent("onload",function(){t.iframeComplete()}):n.onload=function(){t.iframeComplete()},$(n)}};var ka={createDom:function(t,e,n,i,a,o){var r,s="",c=t.scaleWidth,u=t.scaleHeight,l=t.scaleTop,d=t.scaleLeft;return(r=t.md5)&&(s="background-image: url("+Xut.onfig.pathAddress+r+");"),String.format('<div id="{0}" data-belong = "{1}" data-delegate="Action" style="cursor: pointer;width:{3}px;height:{4}px;left:{5}px;top:{6}px;background-size:100% 100%;position:absolute;z-index:{7};{8}"></div>',t.actType+"_"+t._id,o,t.autoPlay,c,u,d,l,a,s)},stopDelegate:!1,eventDelegate:function(t){new j(t)},recovery:function(t){return this.state?(this.state=!1,!0):!1}},Ia={createDom:function(t){var e=t.sqlRet;t.pageIndex;return function(n,i){return e.container=n||t.rootEle,e}},bindEvent:function(){},autoPlay:function(t){return this.autoPlay&&this.autoPlay(t)},flipOver:function(){return this.flipOver()},flipComplete:function(){return this.flipComplete()},destroy:function(){return this.destroy()},recovery:function(t){return this.recovery&&this.recovery()}},wa={},Ca={createDom:function(t,e,n,i,a,o){var r=t.scaleWidth,s=t.scaleHeight,c=t.scaleTop,u=t.scaleLeft,l=(t.actType,t._id);if(!r||!s)return"";var d,h,p,f,v,m,b,x=t.category,y="",k=Xut.config.screenSize;"webpage"==x&&r>200&&s>100&&r<=k.width&&s<=k.height&&(d="background-image:url(images/icons/web_hotspot.png)"),(b=t.itemArray)&&(b=g(b),v=b[0],m=b[1],wa[l]={},v&&(v.startImg&&(y=v.startImg,wa[l].startImg=y,y="background-image:url("+y+");"),v.script&&(wa[l].startScript=v.script)),m&&(m.stopImg&&(wa[l].stopImg=m.stopImg),m.script&&(wa[l].stopScript=m.script)));var I=x.replace(/(\w)/,function(t){return t.toUpperCase()}),w=String.format('<div id="{0}" data-belong="{1}" data-delegate="{2}" style="width:{3}px;height:{4}px;left:{5}px;top:{6}px;z-index:{7};{8}background-size:100% 100%;position:absolute;">',I+"_"+l,o,x,r,s,u,c,a,y);return d&&(h=74,p=(r-h)/2,f=(s-h)/2,w+=String.format('<div id="icon_{0}" type="icon" style="position:absolute;top:{1}px;left:{2}px;width:{3}px;height:{4}px;{5};"> </div>',l,f,p,h,h,d)),w+="</div>"},onlyCreateOnce:function(t){var e;return(e=wa[t])?(delete wa[t],e):void 0},eventDelegate:function(t){var e,n;(e=t.target.getAttribute("data-delegate"))&&(n=Xut.Presentation.GetPageId(t.pageIndex),"audio"==e?Xut.AudioManager.trigger(n,t.activityId,this.onlyCreateOnce(t.id)):Xut.VideoManager.trigger(n,t.activityId,$(t.rootNode)))},autoPlay:function(t){var e=t.category;if(e){var n=t.rootNode,i=(t.pageIndex,t.chapterId),a=t.id;e.replace(/(\w)/,function(t){return t.toUpperCase()});"audio"==e?Xut.AudioManager.autoPlay(i,a,this.onlyCreateOnce(t.id)):Xut.VideoManager.autoPlay(i,a,n)}}};z.prototype={createWapper:function(){var t,e,n,i;return t=0===this.zIndex?this.zIndex:this.zIndex||Xut.zIndexlevel(),this.zIndex=t,e='<div id="iframeWidget_{0}" style="z-index:{1};width:{2}px;height:{3}px;top:{4}px;left:{5}px;position:absolute;" ></div>',n=String.format(e,this.id,t,this.width,this.height,this.top,this.left),i=this.createIframe(),this._iframe=i,$(n).append(i)},createIframe:function(){var t=this,e="content/widget/"+this.widgetId+"/index.html?xxtParaIn="+this.key,n=document.createElement("iframe");return n.id="iframe_"+this.id,n.src=e,n.style.width="100%",n.style.height="100%",n.sandbox="allow-scripts allow-same-origin",n.frameborder=0,n.attachEvent?n.attachEvent("onload",function(){t.iframeComplete()}):n.onload=function(){t.iframeComplete()},n},iframeComplete:function(){function t(){}var e=this,n=this.loadData(),i=e._iframe.offsetWidth,a=e._iframe.offsetHeight;.98*n.screenSize.width<=i&&.98*n.screenSize.height<=a?Xut.View.Toolbar({show:"button",hide:"controlBar"}):.7*n.screenSize.width<=i&&.7*n.screenSize.height<=a&&Xut.View.Toolbar({show:"button"}),this.PMS.send({target:e._iframe.contentWindow,origin:"*",type:"loadData",data:n,success:t,error:function(){}}),e.state=!0},loadData:function(){var t,e,n=[],i=Xut.data.Image,a=null,o=this.inputPara,r=o.source;for(t in r)r.hasOwnProperty(t)&&(e={},a=i.item((parseInt(r[t])||1)-1),e.img="../gallery/"+a.md5,e.thumb="",e.title=a.imageTitle,n.push(e));return o.source=n,o},bindPMS:function(){var t=this,e=e||require("PMS"),n=this.id;this.PMS=e,e.bind("onHideWapper"+n,function(e){var n=t.$wapper;n.hide(),t.state=!1},"*"),e.bind("onFullscreen"+n,function(e){var n=t.$wapper,i=$(t._iframe);if(i.length){if(Xut.VideoManager.clearVideo(),n.css({width:"100%",height:"100%",zIndex:Xut.zIndexlevel(),top:0,left:0}),0==e.full){var a=document.body,o=parseInt(a.clientWidth),r=parseInt(a.clientHeight),s=t.width/t.height,c=function(t,e,n){var i=t,a=t/n;return a>e&&(a=e,i=a*n),{w:parseInt(i),h:parseInt(a)}},u=c(o,r,s),l=(o-u.w)/2,d=(r-u.h)/2;i.css({width:u.w,height:u.h,position:"absolute",top:d,left:l})}Xut.View.Toolbar("hide")}},"*"),e.bind("onReset"+n,function(e){var n=t.$wapper,i=$(t._iframe);i.length&&(n.css({zIndex:t.zIndex,width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px"}),i.css({width:"100%",height:"100%",position:"",top:"0",left:"0"}),Xut.View.Toolbar("show"))},"*"),e.bind("onShowToolbar"+n,function(t){},"*"),e.bind("onHideToolbar"+n,function(t){Xut.View.HideToolbar()},"*"),e.bind("scrollToPage"+n,function(t){Xut.View.GotoSlide(t.ppts,t.pageIndex)},"*")},dispatchProcess:function(){this.state?this.stop():this.start()},start:function(){var t=this;t.domWapper(),this.PMS.send({target:t._iframe.contentWindow,url:t._iframe.src,origin:"*",type:"onShow",success:function(){}}),setTimeout(function(){t.state=!0},0)},stop:function(){var t=this;t.domWapper(),this.PMS.send({target:t._iframe.contentWindow,url:t._iframe.src,origin:"*",type:"onHide",success:function(){}}),setTimeout(function(){t.state=!1},0)},domWapper:function(){this.state?this.$wapper.hide():this.$wapper.show()},recovery:function(){var t=this;return t.state?(t.PMS.send({target:t._iframe.contentWindow,url:t._iframe.src,origin:"*",type:"onHide",success:function(){}}),t.domWapper(),t.state=!1,!0):!1},destroy:function(){var t=this,e=this._iframe,n=this.PMS;n.send({target:e.contentWindow,url:e.src,origin:"*",type:"onDestory",success:function(){}}),n.unbind(),setTimeout(function(){t._iframe=null,t.$wapper.remove(),t.$wapper=null},0)}},F.prototype={path:function(t){return"content/widget/"+this.widgetId+"/"+t},loadfile:function(t){var e,n,i,a=this,o=this.widgetName+".min.js",r="page"==this.widgetType||"js"==this.widgetType?"style.min.css":0,i=function(){var e=0;return o&&e++,r&&e++,function(){return 1===e?t&&t.call(a):void e--}}();r&&(n=this.path(r),Ki(n,function(){i()})),o&&(e=this.path(o),Ki(e,function(){i()}))},createData:function(){var t,e,n=[],i=Xut.data.Image,a=null,o=this.inputPara,r=o.source;for(t in r)r.hasOwnProperty(t)&&(e={},a=i.item((parseInt(r[t])||1)-1),e.img=a.md5,e.thumb="",e.title=a.imageTitle,n.push(e));return o.source=n,o.scrollPaintingMode=this.scrollPaintingMode,
o.calculate=this.calculate,o},parseContentObjs:function(){var t=[],e=this.inputPara;return e.content&&_.each(e.content,function(e){t.push(e)}),Xut.Contents.GetPageWidgetData(this.pageType,t)},executive:function(){var t=this.createData(),e=this.parseContentObjs();if("canvas"==this.widgetType){var n=e?e[0].id:t.frame,i="pageWidget_"+n,a=$("#"+t.contentPrefix+n);$("#"+i).length<1&&a.append("<canvas style='position:absolute; z-index:10' id='"+i+"' width='"+a.width()+"' height='"+a.height()+"'></canvas>"),a.canvasId=i}"function"==typeof window[this.widgetName+"Widget"]?this._widgetObj=new window[this.widgetName+"Widget"](t,e):console.error("Function ["+this.widgetName+"Widget] does not exist.")},play:function(){return console.log("widget"),this._widgetObj.play()},getIdName:function(){return this._widgetObj.getIdName()},dispatchProcess:function(){this._widgetObj.toggle()},domWapper:function(){this.wapper&&(this.state?this.$wapper.hide():this.$wapper.show())},destroy:function(){this._widgetObj&&this._widgetObj.destroy&&this._widgetObj.destroy()}};var Ta=void 0,Pa=void 0,Sa=void 0,Ma={iframe:function(t){V("widget",t,z)},widget:function(t){V("widget",t,z)},js:function(t){V("js",t,F)},page:function(t){V("page",t,F)},svg:function(t){V("svg",t,F)},canvas:function(t){V("canvas",t,F)},webgL:function(t){V("webgL",t,F)}},Xa={createDom:function(t,e,n,i,a,o){var r,s,c="",u=t.autoPlay;if(u)return c;var l="",d=t.scaleWidth,h=t.scaleHeight,p=t.scaleTop,f=t.scaleLeft,v=t.actType,g=t.md5;return g&&(l="background-image: url("+Xut.config.pathAddress+g+");"),r=v+"_"+t._id,s="cursor: pointer;width:"+d+"px;height:"+h+"px;left:"+f+"px;top:"+p+"px;background-size:100% 100%;position:absolute;z-index:"+a+";"+l,String.format('<div id="{0}" data-belong ="{1}" data-delegate="{2}" style="{4}"> </div>',r,o,v,u,s)},eventDelegate:function(t){return Y(t)},autoPlay:function(t){Y({rootNode:t.rootNode,type:t.type,pageType:t.pageType,activityId:t.id,pageIndex:t.pageIndex,isAutoPlay:!0})},recovery:function(t){return this.recovery()}};K.prototype={setup:function(){var t=this,e=this.data.note,n=Xut.config.proportion,i=Math.round((n.width+n.height)/2*Xut.config.iconHeight),a=Math.round(i/2);return retStr='<div class="xut-shownote-box" style="z-index:'+Xut.zIndexlevel()+'"><div class="close" style="width:'+i+"px;height:"+i+"px;top:-"+a+"px;right:-"+a+'px"></div><div class="content">'+e+"</div></div>",this._dom=$(retStr),this._dom.find(".close").on("touchend mouseup",function(){t.dispatchProcess()}),$(this.rootNode).append(this._dom),this.show(),J(this._dom.find(".content")[0]),!0},dispatchProcess:function(){this.isAutoPlay||(this.state?this.hide():this.show())},recovery:function(){return this.state?(this.dispatchProcess(),!0):!1},hide:function(){this.state=!1,$("#ShowNote_"+this.id).css("background-image","url(images/icons/hideNote.png)"),this._dom.hide()},show:function(){this.state=!0,$("#ShowNote_"+this.id).css("background-image","url(images/icons/showNote.png)"),this._dom.show()},destroy:function(){this._dom&&(this._dom.find(".close").off(),this._dom&&this._dom.hide().remove())}};var Ba,Oa={createDom:function(t,e,n,i,a,o){var r,s="",c=t._id,u=t.scaleWidth,l=t.scaleHeight,r=(u+l)/2*Xut.config.iconHeight;return s+='<div id="ShowNote_'+c+'" class="xut-showNote" data-belong ='+o+' data-delegate="ShowNote" style="width:'+r+"px;height:"+r+'px"></div>'},eventDelegate:function(t){t.data=Xut.Presentation.GetPageData(t.pageIndex),new K(t)},autoPlay:function(t){},flipOver:function(t){},destroy:function(t){this&&this.destroy()},recovery:function(t){return this.state?(this.dispatchProcess(),!0):!1}},Aa=Ca,_a=Ca,Ra=Ca,Na={Video:_a,Audio:Ra,Action:ka,Content:Ia,Webpage:Aa,Widget:Xa,ShowNote:Oa};Xut.accessControl=function(t,e){var n,t=t||Xut.Presentation.GetPageObj();if(t){var i=t.baseGetContent(),a=t.baseGetComponent(),o=t.pageType||"page";n=e(t,i.length&&i,a.length&&a,o)}return n};var Ea=Xut.plat.prefixStyle,Da=null,$a=void 0,Ha=void 0,La=void 0,Ga=void 0,ja=void 0,za=void 0,Fa=void 0,Va=void 0,Wa=void 0,Ua=void 0,qa=void 0,Qa=void 0,Ya=void 0,Ja=void 0;Mt.prototype.options={speed:200,easing:mina.linear,evtoggle:"click",size:{w:44,h:44},onLoad:function(){return!1},onToggle:function(){return!1}},Mt.prototype._initEvents=function(){var t=this,e=function(e){return(("mouseover"===e.type.toLowerCase()||"mouseout"===e.type.toLowerCase())&&St(e,this)||"touchstart"===e.type.toLowerCase()||"mousedown"===e.type.toLowerCase())&&(t.toggle(!0),t.options.onToggle()),!1};"mouseover"===this.options.evtoggle?(this.el.addEventListener("mouseover",e),this.el.addEventListener("mouseout",e)):Xut.plat.execEvent("on",{context:this.el,callback:{start:function(t){e(t)}}})},Mt.prototype.toggle=function(t){if(this.config.animation){for(var e=this,n=0,i=this.config.animation.length;i>n;++n){var a=this.config.animation[n],o=this.svg.select(a.el),r=this.toggled?a.animProperties.from:a.animProperties.to,s=r.val,c=t&&r.delayFactor?r.delayFactor:0;r.before&&o.attr(JSON.parse(r.before)),t?setTimeout(function(t,n,i){return function(){t.animate(JSON.parse(n),e.options.speed,e.options.easing,function(){i.after&&this.attr(JSON.parse(i.after)),i.animAfter&&this.animate(JSON.parse(i.animAfter),e.options.speed,e.options.easing)})}}(o,s,r),c*e.options.speed):o.attr(JSON.parse(s))}this.toggled=!this.toggled}};var Ka={nextArrow:{url:"images/icons/pageback.svg",animation:[{el:"path:nth-child(1)",animProperties:{from:{val:'{"transform" : "r0 16 16", "fill-opacity" : "0.9"}',before:'{"fill-opacity" : "0.9", "stroke-opacity" : "0" , "transform" : "r90 16 16"}'},to:{val:'{"transform" : "r360 16 16", "fill-opacity": "0"}',before:'{"fill-opacity" : "0", "stroke-opacity" : "1" }'}}}]},prevArrow:{url:"images/icons/pageforward.svg",animation:[{el:"path:nth-child(1)",animProperties:{from:{val:'{"transform" : "r0 16 16", "fill-opacity" : "0.9"}',before:'{"fill-opacity" : "0.9", "stroke-opacity" : "0" , "transform" : "r90 16 16"}'},to:{val:'{"transform" : "r360 16 16", "fill-opacity": "0"}',before:'{"fill-opacity" : "0", "stroke-opacity" : "1" }'}}}]},close:{url:"images/icons/close.svg",animation:[{el:"path:nth-child(1)",animProperties:{from:{val:'{"transform" : "r0 16 16", "fill-opacity" : "0.9"}',before:'{"fill-opacity" : "0.9", "stroke-opacity" : "0" , "transform" : "r90 16 16"}'},to:{val:'{"transform" : "r360 16 16", "fill-opacity": "0"}',before:'{"fill-opacity" : "0", "stroke-opacity" : "1" }'}}}]},back:{url:"images/icons/back.svg",animation:[{el:"path:nth-child(1)",animProperties:{from:{val:'{"transform" : "r0 16 16", "fill-opacity" : "0.9"}',before:'{"fill-opacity" : "0.9", "stroke-opacity" : "0" , "transform" : "r90 16 16"}'},to:{val:'{"transform" : "r360 16 16", "fill-opacity": "0"}',before:'{"fill-opacity" : "0", "stroke-opacity" : "1" }'}}}]}},Za=Xut.plat.isIOS,to=function(){var t=Xut.config,e=t.iconHeight,n=t.settings,i="height:"+e+"px;width:"+e+"px";switch(n.NavbarPos){case 0:i+=";top:0";break;case 1:i+=";margin-top:"+-e/2+"px";break;case 2:i+=";top:auto;bottom:0"}return i},eo=Xut.CoreObject.extend({barHeight:Za?20:0,enableLeft:!0,enableRight:!0});eo.prototype.initConfig=function(t){var e;this.propHeight=e=function(){var e=t.layoutMode,n=t.proportion;return"horizontal"==e?n.width:n.height}(),this.iconHeight=function(){var n=t.iconHeight;return Za?n:Math.round(e*n)}(),this.appName=t.shortName,this.settings=t.settings},eo.prototype.createArrows=function(){var t=this.settings.customButton;this.enableLeft&&(t?this.createLeftIcon():this.createLeftArrow()),this.enableRight&&(t?this.createRightIcon():this.createRightArrow())},eo.prototype.createLeftArrow=function(){var t,e=to(),n=this.barStatus?"":"hide";t=$('<div class="si-icon xut-flip-control left '+n+'" data-icon-name="prevArrow" style="'+e+'"></div>'),this.createSVGIcon(t[0],function(){Xut.View.GotoPrevSlide()}),this.container.append(t),this.arrows.prev={el:t,able:!0}},eo.prototype.createRightArrow=function(){var t,e=to(),n=this.barStatus?"":"hide";t=$('<div class="si-icon xut-flip-control right '+n+'" data-icon-name="nextArrow" style="'+e+'"></div>'),this.createSVGIcon(t[0],function(){Xut.View.GotoNextSlide()}),this.container.append(t),this.arrows.next={el:t,able:!0}},eo.prototype.createLeftIcon=function(){var t,e=to(),n=this.config.appId,i=this.barStatus?"":"hide";e+=";background-image:url(images/icons/pageforward_"+n+".svg);background-size:cover",t=$('<div name="prevArrow" class="xut-flip-control left '+i+'" style="'+e+'"></div>'),t.on("touchend mouseup",function(){Xut.View.GotoPrevSlide()}),this.container.append(t),this.arrows.prev={el:t,able:!0}},eo.prototype.createRightIcon=function(){var t,e=to(),n=this.config.appId,i=this.barStatus?"":"hide";e+=";background-image:url(images/icons/pageback_"+n+".svg);background-size:cover",t=$('<div name="nextArrow" class="xut-flip-control right '+i+'" style="'+e+'"></div>'),t.on("touchend mouseup",function(){Xut.View.GotoNextSlide()}),this.container.append(t),this.arrows.next={el:t,able:!0}},eo.prototype.toggleArrow=function(t,e){var n=this.arrows[t];n&&(n.able=e,this.hasTopBar&&!this.barStatus&&e||n.el[e?"show":"hide"]())},eo.prototype.hideNext=function(){this.toggleArrow("next",!1)},eo.prototype.showNext=function(){this.toggleArrow("next",!0)},eo.prototype.hidePrev=function(){this.toggleArrow("prev",!1)},eo.prototype.showPrev=function(){this.toggleArrow("prev",!0)},eo.prototype.showPageBar=function(){var t=this.arrows;for(var e in t){var n=t[e];n.able&&n.el.show()}},eo.prototype.hidePageBar=function(){var t=this.arrows;for(var e in t)t[e].el.hide()},eo.prototype.toggle=function(t,e){if(!this.Lock)switch(this.Lock=!0,t){case"show":this.showToolbar(e);break;case"hide":this.hideToolbar(e);break;default:this.barStatus?this.hideToolbar(e):this.showToolbar(e)}},eo.prototype.showToolbar=function(t){switch(t){case"controlBar":this.showTopBar();break;case"button":this.showPageBar(),this.Lock=!1;break;default:this.showTopBar(),this.showPageBar()}},eo.prototype.hideToolbar=function(t){switch(t){case"controlBar":this.hideTopBar();break;case"button":this.hidePageBar(),this.Lock=!1;break;default:this.hideTopBar(),this.hidePageBar()}},eo.prototype.showSystemBar=function(){Za&&Xut.Plugin.statusbarPlugin.setStatus(null,null,0)},eo.prototype.hideSystemBar=function(){Za&&Xut.Plugin.statusbarPlugin.setStatus(null,null,1)},eo.prototype.createSVGIcon=function(t,e){var n={speed:6e3,size:{w:this.iconHeight,h:this.iconHeight},onToggle:e};return new Mt(t,Ka,n)},eo.prototype.reset=function(){this.barStatus?this.showPageBar():this.hidePageBar()};var no=eo.extend({init:function(t){this.arrows=Object.create(null),this.curTips=null,this.Lock=!1,this.delay=50,this.hasTopBar=!0,this.controlBar=t.controlBar,this.container=t.container,this.pageMode=t.pageMode,this.pageTotal=t.pageTotal,this.currentPage=t.currentPage,this.config=Xut.config,this.initConfig(this.config),this.initTool()}});no.prototype.initTool=function(){var t=this.controlBar,e=this.settings;this.barStatus="none"!==t.css("display"),this.toolbarPostion(t,e.ToolbarPos),e.HomeBut&&this.createHomeIcon(t),e.ContentBut&&this.createDirIcon(t),this.createTitle(t),e.CloseBut&&this.createCloseIcon(t),e.PageBut&&this.createPageNum(t),this.createHideToolbar(t),2==this.pageMode&&this.createArrows(),this.bindButtonsEvent(t)},no.prototype.toolbarPostion=function(t,e){var n=this.iconHeight,i=this.barHeight;1==e?t.css({bottom:0,height:n+"px"}):t.css({top:0,height:n+"px",paddingTop:i+"px"})},no.prototype.createHomeIcon=function(t){var e='<div id="backHome" style="float:left;text-indent:0.25em;height:{0}px;line-height:{1}px;color:#007aff">\u4e3b\u9875</div>',n=this.iconHeight,i=$(String.format(e,n,n));t.append(i)},no.prototype.createDirIcon=function(t){var e='<div id="backDir" class="xut-controlBar-backDir" style="float:left;margin-left:4px;width:{0}px;height:{1}px;background-size:cover"></div>',n=this.iconHeight,i=$(String.format(e,n,n));t.append(i)},no.prototype.createPageNum=function(t){var e,n,i=this.iconHeight,a=.25*i,o=.5*i;e='<div class="xut-controlBar-pageNum" style="float:right;margin:{0}px 4px;padding:0 0.25em;height:{1}px;line-height:{2}px;border-radius:0.5em"><span>{3}</span>/<span>{4}</span></div>',n=$(String.format(e,a,o,o,this.currentPage,this.pageTotal)),this.curTips=n.children().first(),t.append(n)},no.prototype.createHideToolbar=function(t){var e,n,i=this.iconHeight;n="float:right;width:"+i+"px;height:"+i+"px;background-size:cover",e='<div id="hideToolbar" class="xut-controlBar-hide" style="'+n+'"></div>',t.append(e)},no.prototype.createCloseIcon=function(t){var e,n,i=this.iconHeight;e="float:right;margin-right:4px;width:"+i+"px;height:"+i+"px",n='<div class="si-icon" data-icon-name="close" style="'+e+'"></div>',n=$(n),this.createSVGIcon(n[0],function(){SUbDOCCONTEXT?SUbDOCCONTEXT.Xut.publish("subdoc:dropApp"):Xut.publish("magazine:dropApp")}),t.append(n)},no.prototype.createTitle=function(t){var e,n,i=this.appName,a=this.iconHeight;e="width:100%;position:absolute;line-height:"+a+"px;pointer-events:none",n='<div class="xut-controlBar-title" style="z-index:-99;'+e+'">'+i+"</div>",t.append(n)},no.prototype.createBackIcon=function(t){var e,n,i=this.iconHeight;e="float:left;width:"+i+"px;height:"+i+"px",n='<div class="si-icon" data-icon-name="back" style="'+e+'"></div>',n=$(n),this.createSVGIcon(n[0],function(){Xut.Application.Suspend({dispose:function(){Xut.Application.DropApp()},processed:function(){Xut.Application.DropApp()}})}),t.append(n)},no.prototype.updatePointer=function(t){this.curTips&&this.curTips.html(t+1)},no.prototype.bindButtonsEvent=function(t){var e=this;t.on("touchend mouseup",function(t){var n=Xut.plat.evtTarget(t).id;switch(n){case"backHome":e.homeControl();break;case"backDir":e.navigationBar();break;case"hideToolbar":e.hideTopBar()}})},no.prototype.homeControl=function(){return DUKUCONFIG?void Xut.Application.Suspend({dispose:function(){Xut.Application.DropApp()},processed:function(){Xut.Application.DropApp()}}):void Xut.Application.Suspend({dispose:function(t){},processed:function(){Xut.View.GotoSlide(1)}})},no.prototype.navigationBar=function(){initNavBar(Xut.Presentation.GetPageIndex())},no.prototype.showTopBar=function(){var t=this;return this.barStatus?void(this.Lock=!1):(this.controlBar.css({display:"block",opacity:0}),void setTimeout(function(){t.controlBar.animate({opacity:1},t.delay,"linear",function(){Navbar.close(),t.showSystemBar(),t.barStatus=!0,t.Lock=!1})}))},no.prototype.hideTopBar=function(){var t=this;return this.barStatus?void this.controlBar.animate({opacity:0},t.delay,"linear",function(){Navbar.close(),t.controlBar.hide(),t.hideSystemBar(),t.barStatus=!1,t.Lock=!1}):void(this.Lock=!1)},no.prototype.destroy=function(){this.controlBar.off(),this.controlBar=null,this.arrows=null,this.curTips=null,this.barStatus=!1};var io=eo.extend({init:function(t){this.pageTips=null,this.currTip=null,this.tipsMode=0,this.top=0,this.Lock=!1,this.delay=50,this.hasTopBar=!1,this.barStatus=!0,this.arrows=Object.create(null),this.pageMode=t.pageMode,this.id=t.id,this.container=t.container,this.tbType=t.tbType,this.pageTotal=t.pageTotal,this.currentPage=t.currentPage,this.config=Xut.config,this.initConfig(this.config),this.initTool()}});io.prototype.initTool=function(){var t,e=this.container;for(e.hide(),this.controlBar=[];t=this.tbType.shift();)switch(t){case 1:this.createSystemBar();break;case 2:this.createCloseIcon();break;case 3:this.createBackIcon(e);break;case 4:this.createPageTips();break;default:this.barStatus=!1,this.hasTopBar=!1}2===this.pageMode&&this.createArrows(),e.show(),this.bindButtonsEvent()},io.prototype.createSystemBar=function(){var t=this.id,e=this.barHeight,n="",i="top:0;height:"+this.iconHeight+"px;padding-top:"+e+"px";n='<div id="controlBar'+t+'" class="xut-controlBar" style="'+i+'"></div>',n=$(n),this.top=e,this.showSystemBar(),this.createBackIcon(n),this.createTitle(n),this.createPageNum(n),this.controlBar=n,this.container.append(n),this.hasTopBar=!0},io.prototype.createPageTips=function(){var t=this.pageTotal,e=this.iconHeight,n=this.top,i=Xut.plat.isIOS,a="";if(2>t)return"";var o=this.config.proportion.calculateContainer(),r=i?7:Math.max(8,Math.round(8*this.propHeight)),s=2.5*r,c=t*s,u=(e-r)/2,l=(o.width-c)/2;a='<ul class="xut-scenario-tips"  style="top:'+n+"px;left:"+l+"px;width:"+c+'px;opacity:0.6">';for(var d=1;t>=d;d++)a+='<li class="xut-scenario-dark" style="float:left;width:'+s+"px;height:"+e+'px;" data-index="'+d+'">',a+='<div class="xut-scenario-radius" style="width:'+r+"px;height:"+r+"px;margin:"+u+'px auto"></div></li>';a+="</ul>",a=$(a),this.pageTips=a.children(),this.tipsMode=1,this.controlBar.push(a),this.container.append(a)},io.prototype.updatePointer=function(t){switch(this.tipsMode){case 1:this.prevTip&&(this.prevTip.className="xut-scenario-dark"),this.currTip=this.pageTips[t],this.currTip.className="xut-scenario-light",this.prevTip=this.currTip;break;case 2:this.currTip.html(t+1)}},io.prototype.createCloseIcon=function(){var t,e,n=this.top,i=this.iconHeight;t="top:"+n+"px;width:"+i+"px;height:"+i+"px",e='<div class="si-icon xut-scenario-close" data-icon-name="close" style="'+t+'"></div>',e=$(e),this.createSVGIcon($(e)[0],function(){Xut.View.CloseScenario()}),this.controlBar.push(e),this.container.append(e)},io.prototype.createBackIcon=function(t){var e,n,i=this.top,a=this.iconHeight;e="top:"+i+"px;width:"+a+"px;height:"+a+"px",n='<div class="si-icon xut-scenario-back" data-icon-name="back" style="'+e+'"></div>',n=$(n),this.createSVGIcon(n[0],function(){Xut.View.CloseScenario()}),this.controlBar.push(n),t.append(n)},io.prototype.createPageNum=function(t){var e,n,i=this.pageTotal,a=this.top,o=this.iconHeight,r=this.currentPage;e="position:absolute;right:4px;top:"+(.25*o+a)+"px;padding:0 0.25em;height:"+.5*o+"px;line-height:"+.5*o+"px;border-radius:0.5em",n='<div class="xut-controlBar-pageNum" style="'+e+'">',n+='<span class="currentPage">'+r+"</span>/<span>"+i+"</span>",n+="</div>",n=$(n),this.tipsMode=2,this.currTip=n.children().first(),t.append(n)},io.prototype.createHideToolbar=function(t){var e,n,i=this.top,a=this.iconHeight,o=2.5*iconHeight;n="position:absolute;right:"+o+"px;top:"+i+"px;width:"+a+"px;height:"+a+"px;background-size:cover",e='<div class="xut-controlBar-hide" style="'+n+'"></div>',t.append(e)},io.prototype.createTitle=function(t){var e,n,i=this.appName;e="line-height:"+this.iconHeight+"px",n='<div class="xut-controlBar-title" style="'+e+'">'+i+"</div>",t.append(n)},io.prototype.bindButtonsEvent=function(){var t=this,e=1;this.id;this.container.on("touchend touchend",function(n){var i=Xut.plat.evtTarget(n),a=i.className;switch(a){case"xut-controlBar-hide":t.hideTopBar();break;case"xut-scenario-dark":t.pageMode&&(e=i.getAttribute("data-index")||1,Xut.View.GotoSlide(Number(e)))}})},io.prototype.showTopBar=function(){var t=this,e=this.delay,n=this.controlBar;return this.barStatus?void(this.Lock=!1):void(this.hasTopBar?(n.css({display:"block",opacity:0}),setTimeout(function(){n.animate({opacity:1},e,"linear",function(){t.showSystemBar(),t.barStatus=!0,t.Lock=!1})})):n.forEach(function(e){e.show(),t.Lock=!1,t.barStatus=!0}))},io.prototype.hideTopBar=function(){var t=this,e=this.delay,n=this.controlBar;return this.barStatus?void(this.hasTopBar?n.animate({opacity:0},e,"linear",function(){t.controlBar.hide(),t.hideSystemBar(),t.barStatus=!1,t.Lock=!1}):n.forEach(function(n){n.hide(e,function(){t.Lock=!1,t.barStatus=!1})})):void(this.Lock=!1)},io.prototype.destroy=function(){this.container.off(),this.controlBar=null,this.arrows=null,this.pageTips=null,this.currTip=null,this.prevTip=null};var ao,oo={hide:"images/icons/arrowDown.svg"},ro=parseInt($("body").css("font-size"))||16;Xt.prototype.init=function(){var t=this.createBookMark(),e=this.parent[0],n=this;this.parent.append(t),this.bookMarkMenu=t.eq(0),setTimeout(function(){n.restore()},20),ao=this.getHistory(),Xut.plat.execEvent("on",{context:e,callback:{end:this}})},Xt.prototype.createBookMark=function(){var t=3*ro,e='<div class="xut-bookmark-menu" style="width:100%;height:{0}px;left:0;top:{1}px;"><div class="xut-bookmark-wrap"><div class="xut-bookmark-add">\u52a0\u5165\u4e66\u7b7e</div><div class="xut-bookmark-off" style="background-image:url({2})"></div><div class="xut-bookmark-view">\u4e66\u7b7e\u8bb0\u5f55</div></div></div><div class="xut-bookmark-list" style="display:none;width:100%;height:{3}px;"><ul class="xut-bookmark-head"><li class="xut-bookmark-back">\u8fd4\u56de</li><li>\u4e66\u7b7e</li></ul><ul class="xut-bookmark-body"></ul></div>';return e=String.format(e,t,this.sHeight,oo.hide,this.sHeight),this.markHeight=t,$(e)},Xt.prototype.createMarkList=function(){var t,e,n,i="",a=this;return _.each(ao,function(o){t=o.split("-"),e=t[0],n=t[1],o=a.getMarkId(e,n),i+='<li><a data-mark="'+o+'" class="xut-bookmark-id" href="javascript:0">\u7b2c'+n+'\u9875</a><a class="xut-bookmark-del" data-mark="'+o+'" href="javascript:0">X</a></li>'}),i},Xt.prototype.getMarkId=function(t,e){return t+"-"+e},Xt.prototype.getHistory=function(){var t=p("bookMark");return t?t.split(","):[]},Xt.prototype.addBookMark=function(){var t;this.updatePageInfo(),t=this.getMarkId(this.seasonId,this.pageId),ao.indexOf(t)>-1||(ao.push(t),h("bookMark",ao))},Xt.prototype.updatePageInfo=function(){var t=Xut.Presentation.GetPageData();this.pageId=t._id,this.seasonId=t.seasonId},Xt.prototype.delBookMark=function(t){if(t&&t.dataset){var e=t.dataset.mark,n=ao.indexOf(e);ao.splice(n,1),h("bookMark",ao),0==ao.length&&_remove("bookMark"),$(t).parent().remove()}},Xt.prototype.viewBookMark=function(t){var e,n=this.createMarkList();e=this.bookMarkList?this.bookMarkList:$(t).parent().parent().next(),e.find(".xut-bookmark-body").html(n),this.bookMarkList=e,e.fadeIn()},Xt.prototype.iconManager=function(t){var e=this.bookMarkIcon=$(t),n=this.iconRestore;e.css({transform:"scale(1.2)","transition-duration":"500ms"})[0].addEventListener(Xut.plat.TRANSITION_EV,n.bind(this),!1)},Xt.prototype.iconRestore=function(){this.bookMarkIcon.css("transform","")},Xt.prototype.goBookMark=function(t){if(t&&t.dataset){var e=t.dataset.mark.split("-"),n=Number(e[0]),i=Number(e[1]);this.updatePageInfo(),this.backBookMark(),this.pageId==i&&this.seasonId==n||Xut.View.LoadScenario({scenarioId:n,chapterId:i})}},Xt.prototype.backBookMark=function(){this.bookMarkList.fadeOut()},Xt.prototype.handleEvent=function(t){var e=t.target;switch(e.className){case"xut-bookmark-add":this.addBookMark(),this.iconManager(e);break;case"xut-bookmark-view":this.viewBookMark(e),this.iconManager(e);break;case"xut-bookmark-off":this.closeBookMark(e);break;case"xut-bookmark-back":this.backBookMark();break;case"xut-bookmark-del":this.delBookMark(e);break;case"xut-bookmark-id":this.goBookMark(e)}},Xt.prototype.closeBookMark=function(t){this.bookMarkMenu.css({transform:"translate3d(0,0,0)","transition-duration":"1s"})},Xt.prototype.restore=function(){this.bookMarkMenu.css({transform:"translate3d(0,-"+this.markHeight+"px,0)","transition-duration":"1s"})},Xt.prototype.destroy=function(){var t=this.parent[0],e=Xut.plat;t.removeEventListener("touchend",this,!1),t.removeEventListener("mouseup",this,!1),this.bookMarkMenu&&(this.bookMarkMenu.remove(),this.bookMarkMenu=null),this.bookMarkList&&(this.bookMarkList.remove(),this.bookMarkList=null),this.bookMarkIcon&&(this.bookMarkIcon[0].removeEventListener(e.TRANSITION_EV,this.iconRestore,!1),this.bookMarkIcon=null),this.parent=null};var so=eo.extend({init:function(t){this.arrows={},this.container=t.container,this.controlBar=t.controlBar,this.pageMode=t.pageMode,this.hasTopBar=!0,this.Lock=!1,this.delay=50,this.topBarHeight=1.25*this.iconHeight,this.config=Xut.config,this.initConfig(this.config),this.initTool()}});so.prototype.initTool=function(){var t=this.controlBar.css("display");this.barStatus="none"!=t,this.setToolbarStyle(),this.createBackIcon(),this.createDirIcon(),this.createMarkIcon(),2==this.pageMode&&this.createArrows();var e=this.container[0];Xut.plat.execEvent("on",{context:e,callback:{end:this}})},so.prototype.setToolbarStyle=function(){var t=this.topBarHeight,e=this.barHeight;this.controlBar.css({top:0,height:t+"px",paddingTop:e+"px",backgroundColor:"rgba(0, 0, 0, 0.2)",fontSize:"0.625em",color:"white"})},so.prototype.updatePointer=function(){},so.prototype.createDirIcon=function(t){var e=document.createElement("div");e.innerHTML="\u76ee\u5f55",e.style.width=this.iconHeight+"px",e.style.lineHeight=1.5*this.topBarHeight+"px",e.className="xut-book-bar-dir",this.controlBar.append(e)},so.prototype.createMarkIcon=function(t){var e=document.createElement("div");e.innerHTML="\u4e66\u7b7e",e.style.width=this.iconHeight+"px",e.style.lineHeight=1.5*this.topBarHeight+"px",e.className="xut-book-bar-mark",this.controlBar.append(e)},so.prototype.createStarIcon=function(t){var e=document.createElement("div");e.innerHTML="\u8bc4\u5206",e.style.width=this.iconHeight+"px",e.style.lineHeight=1.5*this.topBarHeight+"px",e.className="xut-book-bar-star",this.controlBar.append(e)},so.prototype.createBackIcon=function(){var t=document.createElement("div");t.style.width=this.topBarHeight+"px",t.className="xut-book-bar-back",this.controlBar.append(t)},so.prototype.showTopBar=function(){var t=this;return this.barStatus?void(this.Lock=!1):(this.controlBar.css({display:"block",opacity:0}),void setTimeout(function(){t.controlBar.animate({opacity:1},t.delay,"linear",function(){t.showSystemBar(),t.barStatus=!0,t.Lock=!1})},50))},so.prototype.hideTopBar=function(){var t=this;return this.barStatus?void this.controlBar.animate({opacity:0},t.delay,"linear",function(){t.controlBar.hide(),t.hideSystemBar(),t.barStatus=!1,t.Lock=!1}):void(this.Lock=!1)},so.prototype.createDirMenu=function(){var t=this,e=document.createElement("div"),n=document.createElement("div");n.className="xut-book-menu-mask",this.getDirContent(),e.className="xut-book-menu",e.innerHTML="<ul>"+this.contentText+"</ul>",this.container.append(e),this.isScrolled=!1,iscroll=new iScroll(e,{scrollbars:!0,fadeScrollbars:!0,scrollX:!1}),this.menu=e,this.setColor(),iscroll.on("scrollStart",function(e){t.isScrolled=!0}),iscroll.on("scrollEnd",function(e){t.isScrolled=!1}),e.appendChild(n),this.iscroll=iscroll},so.prototype.showDirMenu=function(){var t=Xut.Presentation.GetPageElement();this.menu?this.menu.style.display="block":this.createDirMenu(),t.addClass("filter"),this.page=t,this.controlBar.hide();var e=this.iscroll;e.y>e.wrapperHeight&&e.scrollToElement(this.selectedChild)},so.prototype.hideDirMenu=function(){this.menu.style.display="none",this.controlBar.show(),this.page.removeClass("filter")},so.prototype.getDirContent=function(){function t(t,e){var n,i="";for(t;e>=t;t++)n=o.item(t-1),n&&n.chapterTitle&&(i+='<section><a class="xut-book-menu-item" data-mark='+a+"-"+t+' href="javascript:0">'+n.chapterTitle+"</a></section>");return i}var e=Xut.Presentation,n=e.GetAppSectionData(),i=n[0],a=i._id,o=Xut.data.Chapter;if(n=g(i.parameter),!n)return void console.log("book\u6a21\u5f0fparameter\u6570\u636e\u51fa\u9519");var r,s,c,a,u,l,d=0,h=n.length,p='<li class="title"><center class="select">\u76ee\u5f55</center></li>';for(d;h>d;d++)r=n[d],u=r.ChapterList[0],l=r.ChapterList[1],s=a+"-"+u,r.SeasonTitle.length<=0||(c=r.SeasonTitle||"\u7b2c"+(d+1)+"\u7ae0",p+='<li><a class="xut-book-menu-item" data-mark="'+s+'" href="javascript:0">'+c+"</a>"+t(u,l));this.contentText=p},so.prototype.setColor=function(t){this.selectedChild&&(this.selectedChild.className="xut-book-menu-item"),t=t||this.menu.querySelectorAll("li")[1].children[0],t.className="select",this.selectedChild=t},so.prototype.turnToPage=function(t){if(!this.isScrolled){this.setColor(t),this.hideDirMenu();var e=t.dataset.mark||"";e&&(e=e.split("-"),Xut.View.LoadScenario({scenarioId:e[0],chapterId:e[1]}))}},so.prototype.showBookMark=function(){if(this.bookMark)this.bookMark.restore();else{var t=Xut.Presentation.GetPageData();this.bookMark=new Xt({parent:this.container,seasonId:t.seasonId,pageId:t._id})}},so.prototype.goBack=function(){var t=this;Xut.Application.Suspend({dispose:function(t){},processed:function(){Xut.View.GotoSlide(1),t.setColor()}})},so.prototype.handleEvent=function(t){var e=t.target||t.srcElement,n=e.className;switch(n){case"xut-book-bar-back":this.goBack();break;case"xut-book-bar-dir":this.showDirMenu();break;case"xut-book-bar-mark":this.showBookMark();break;case"xut-book-bar-star":break;case"xut-book-menu-item":this.turnToPage(e);break;case"xut-book-menu-mask":case"select":this.hideDirMenu()}},so.prototype.destroy=function(){this.iscroll&&this.iscroll.destroy(),this.bookMark&&this.bookMark.destroy();var t=this.container[0];t.removeEventListener("touchend",this,!1),t.removeEventListener("mouseup",this,!1),this.iscroll=null,this.menu=null,this.page=null};var co=function(t){function e(t,e){var n,i,a=this.events=this.events||{},r=t.split(/\s+/),s=r.length;for(n=0;s>n;n++)a[i=r[n]]=a[i]||[],-1===o(a[i],e)&&a[i].push(e);return this}function n(e,n){var i=function a(){this.unbind(e,a),n.apply(this,t.call(arguments))};return this.bind(e,i),this}function i(t,e){var n,i,a,r,s,c=this.events;if(!c)return this;if(arguments.length)for(s=t.split(/\s+/),i=0,r=s.length;r>i;i++)(n=s[i])in c!=!1&&(a=e?o(c[n],e):-1,-1!==a&&c[n].splice(a,1));else this.events=null;return this}function a(e){var n,i,a,o=this.events;if(!o||e in o==!1)return this;for(n=t.call(arguments,1),a=o[e],i=0;i<a.length;i++)a[i].apply(this,n);return this}function o(t,e){var n,i;if(s&&t.indexOf===s)return t.indexOf(e);for(n=0,i=t.length;i>n;n++)if(t[n]===e)return n;return-1}var r=Array.prototype,s=r.indexOf,t=r.slice;return function(){return this.$watch=this.bind=e,this.$off=this.unbind=i,this.$emit=a,this.$once=n,this}}([].slice),uo=Ot.prototype;uo.overstep=function(t){return 0===this.hindex&&t>0?!0:this.hindex===this.pagetotal-1&&0>t?!0:void 0},uo.prev=function(){this.overstep(1)||this.slideTo("prev")},uo.next=function(){this.overstep(-1)||this.slideTo("next")},uo.isMove=function(){return this.fliplock},uo.isBorder=function(t){return 0===this.hindex&&t>0?!0:this.hindex===this.pagetotal-1&&0>t?!0:void 0},uo.findRootElement=function(t,e){for(var n,i,a=this.hindex,o=this.sectionRang,r=this.bubbleNode[e].childNodes,s=r.length;s--;){if(n=r[s],i=n.getAttribute("data-map"),o&&(a+=o.start),i==a)return n;a=this.hindex}},uo.scopePointer=function(t){var e,n=this.pagePointer,i=Object.keys(n).length;switch(t){case"prev":e=0===n.currIndex&&2===i;break;case"next":e=n.currIndex===this.pagetotal-1&&2===i}return{pointer:n,overflow:e}},uo.shiftPointer=function(t){var e,n;switch(this.direction){case"prev":e=t.leftIndex-1,n=t.rightIndex;break;case"next":e=t.rightIndex+1,n=t.leftIndex}return t.createPointer=e,t.destroyPointer=n,t},uo.revisedFilpPointer=function(t){var e=t.currIndex;switch(this.direction){case"prev":-1<t.createPointer&&this.updataPointer(t.createPointer,t.leftIndex,t.currIndex),-1===t.createPointer&&(this.pagePointer.rightIndex=t.currIndex,this.pagePointer.currIndex=t.leftIndex,delete this.pagePointer.leftIndex);break;case"next":this.pagetotal>t.createPointer&&this.updataPointer(t.currIndex,t.rightIndex,t.createPointer),this.pagetotal===t.createPointer&&(this.pagePointer.leftIndex=t.currIndex,this.pagePointer.currIndex=t.rightIndex,delete this.pagePointer.rightIndex)}return this.pagePointer.createPointer=t.createPointer,this.pagePointer.destroyPointer=t.destroyPointer,this.pagePointer.stopPointer=e,this.pagePointer},uo.updataPointer=function(t,e,n){if(3===arguments.length)return void(this.pagePointer={leftIndex:t,currIndex:e,rightIndex:n});if(1===arguments.length){var i=t,a=i.viewFlip;return this.fixHindex(i.targetIndex),3===a.length&&this.updataPointer(a[0],a[1],a[2]),void(2===a.length&&(0===a[0]?(this.pagePointer.rightIndex=a[1],this.pagePointer.currIndex=a[0],delete this.pagePointer.leftIndex):(this.pagePointer.leftIndex=a[0],this.pagePointer.currIndex=a[1],delete this.pagePointer.rightIndex)))}},uo.fixHindex=function(t){this.hindex=t},uo.slideTo=function(t){var e;Xut.busyBarState||this.fliplock||(e=this.scopePointer(t),e.overflow||this.startAnimTo(e.pointer,t));
},uo.startAnimTo=function(t,e){this.fliplock=!0,this.prveHindex=this.hindex,this.direction=e,this.judgeQuickTurn(),"next"===e?this.nextRun(t):this.preRun(t)},uo.preRun=function(t){function e(){n=i.shiftPointer(t),n=i.revisedFilpPointer(n),i.sliderStop(n),i.fixHindex(n.currIndex)}var n,i=this;this.processorMove({pageIndex:this.hindex,speed:this.calculatespeed(),distance:0,direction:this.direction,action:"flipOver"}),setTimeout(e)},uo.nextRun=function(t){function e(){n=i.shiftPointer(t),n=i.revisedFilpPointer(n),i.sliderStop(n),i.fixHindex(n.currIndex)}var n,i=this;this.processorMove({pageIndex:this.hindex,speed:this.calculatespeed(),distance:0,direction:this.direction,action:"flipOver"}),setTimeout(e)},uo.judgeQuickTurn=function(){var t=+new Date;this.preClickTime&&t-this.preClickTime<this.clickSpeed&&this.setRate(),this.preClickTime=+new Date},uo.calculatespeed=function(){return(this.screenWidth-Math.abs(this.deltaX))*this.speedRate||this.speed},uo.processorMove=function(t){var e=this.pagePointer;t.leftIndex=e.leftIndex,t.rightIndex=e.rightIndex,this.$emit("onSwipeMove",t)},uo.sliderStop=function(t){this.$emit("onSwipeUpSlider",t)},uo.onTouchStart=function(t){var e,n=At(t);return n?(this.$emit("filter",function(){e=!0},n,t),void(e||(this.deltaX=0,this.deltaY=0,this.preventSwipe=!1,this.isoverstep=!1,this.isScrollX=!1,this.isScrollY=!1,this.isTouching=!0,this.start={pageX:n.pageX,pageY:n.pageY,time:+new Date}))):e=this.preventSwipe=!0},uo.onTouchMove=function(t){if(this.isTouching&&!this.isScrollY&&!this.preventSwipe){var e=At(t),n=e.pageX-this.start.pageX,i=e.pageY-this.start.pageY,a=Math.abs(n),o=Math.abs(i);if(!this.isScrollY&&o>a)return void(this.isScrollY=!0);if(!((this.isoverstep=this.overstep(n))||(t.preventDefault(),this.deltaX=n/(!this.hindex&&n>0||this.hindex==this.pagetotal-1&&0>n?a/this.screenWidth+1:1),!this.isScrollX&&this.deltaX&&(this.isScrollX=!0),25>=a))){var r=0;r=this.deltaX<0?20:-20,!this.fliplock&&this.processorMove({pageIndex:this.hindex,distance:this.deltaX+r,speed:0,direction:this.deltaX>0?"prev":"next",action:"flipMove"})}}},uo.onTouchEnd=function(t){if(this.isTouching=!1,!this.isoverstep&&!this.preventSwipe){if(!this.isScrollX&&!this.isScrollY){var e=!1;if(this.$emit("onSwipeUp",this.hindex,function(){e=!0}),e)return}if(this.isScrollX){var n=+new Date-this.start.time,i=Math.abs(this.deltaX),a=!this.hindex&&this.deltaX>0||this.hindex==this.pagetotal-1&&this.deltaX<0,o=Number(n)<200&&Math.abs(i)>30||Math.abs(i)>this.screenWidth/6;this.fliplock||!o||a?this.processorMove({pageIndex:this.hindex,direction:this.deltaX>0?"prev":"next",distance:0,speed:300,action:"flipRebound"}):this.deltaX<0?this.slideTo("next"):this.slideTo("prev")}}},uo.setAnimComplete=function(t){this.distributed(t[0])},uo.onAnimComplete=function(t){var e=t.target,n=e.getAttribute("data-pageType"),i=e.getAttribute("data-view");return i?void this.distributed(e):void(n||this.$emit("onMasterMove",this.hindex,e))},uo.distributed=function(t){this.preventSwipe=!0,this.isTouching=!1;var e=this.isQuickTurn;this.resetRate(),t.removeAttribute("data-view","false");var n=this;setTimeout(function(){n.$emit("onAnimComplete",n.direction,n.pagePointer,n.unlock.bind(n),e)},100)},uo.lock=function(){this.fliplock=!0},uo.unlock=function(){this.fliplock=!1},uo.setRate=function(){this.speedRate=50/this.screenWidth,this.isQuickTurn=!0},uo.resetRate=function(){this.speedRate=this.originalRate,this.isQuickTurn=!1},uo.openSwipe=function(){this._bindEvt()},uo.closeSwipe=function(){this.evtDestroy()},uo.scrollToPage=function(t,e,n){if(!this.fliplock){var i,a=this.hindex;switch(t){case a-1:if(this.multiplePages)return this.prev();break;case a:return void(0==a&&this.$emit("onDropApp"));case a+1:if(this.multiplePages)return this.next()}i=_t(a,t,this.pagetotal),this.updataPointer(i),i.pagePointer=this.pagePointer,this.$emit("onJumpPage",i)}},uo.handleEvent=function(t){Xut.plat.handleEvent({start:function(t){this.onTouchStart(t)},move:function(t){this.onTouchMove(t)},end:function(t){this.onTouchEnd(t)},transitionend:function(t){this.onAnimComplete(t)}},this,t)},uo._bindEvt=function(){this.pageFlip?Xut.plat.execEvent("on",{context:this.element,callback:{start:this,end:this,transitionend:this}}):this.multiplePages?Xut.plat.execEvent("on",{context:this.element,callback:{start:this,move:this,end:this,transitionend:this}}):Xut.plat.execEvent("on",{context:this.element,callback:{start:this,end:this}})},uo.evtDestroy=function(){Xut.plat.execEvent("off",{context:this.element,callback:{start:this,move:this,end:this,transitionend:this}})},uo.destroy=function(){this.evtDestroy(),this.$off(),this.bubbleNode.page=null,this.bubbleNode.master=null,this.element=null},co.call(Ot.prototype);var lo=["page","master"];Dt.prototype={abstractCreateCollection:function(){this.Collections={}},abstractAddCollection:function(t,e){this.Collections[t]=e},abstractGetCollection:function(){return this.Collections},abstractRemoveCollection:function(t){delete this.Collections[t]},abstractDestroyCollection:function(){var t,e=this.Collections;for(t in e)e[t].baseDestroy();this.Collections=null},abstractGetPageObj:function(t,e){return e=e||this.pageType,"master"===e&&(/-/.test(t)||(t=this.conversionMasterId(t))),this.Collections[t]},abstractAssistPocess:function(t,e){var n;if(n=this.abstractGetPageObj(t,this.pageType)){if(!e)return n;e(n)}},abstractGetPageId:function(t,e){var n="page"===e?"_id":"pptMaster";return this.abstractGetPageData(t,n,e)},abstractGetPageData:function(t,e,n){var i;return(!n&&"page"==e||"master"==e)&&(n=e,e=null),(i=this.abstractGetPageObj(t,n))?e?i.chapterDas[e]:i.chapterDas:void 0},abstractGetPageNode:function(t,e){return this.abstractGetPageData(t,"nodes",e)},abstractAssistAppoint:function(t,e,n,i){var a;return(a=this.abstractGetPageObj(e))?a.baseAssistRun(t,n,i):void 0}},$t.prototype={register:function(t){this._list?this._list.push(t):this._list=[t]},get:function(){return this._list},specified:function(t){for(var e,n=this._list.length;n;)if(n--,(e=this._list[n])&&e.type===t.type&&e.id===t.id)return e},remove:function(){this._list=[]},reset:function(){this._list=[]}};var ho=Xut.plat.prefixStyle,po=function(t){return t=Xut.config.virtualMode?t/2:t,"translate3d("+t+"px, 0, 0)"},fo=void 0,vo=void 0,go=void 0,mo=void 0,bo=void 0,xo=void 0,yo=void 0,ko={reset:zt,flipMove:Ft,flipRebound:Vt,flipOver:Wt},Io=10===document.documentMode,wo=["null","auto","tap","drag","dragTag","swipeleft","swiperight","swipeup","swipedown","doubletap","press","pinchout","pinchin","rotate","assist"],Co=["drag","dragTag","swipeleft","swiperight","swipeup","swipedown"],To=function(t,e){var n;(n=this.abActivitys)&&_.each(n.get(),function(n,i){return t==n.activityId?void e(n):void 0},this)},Po=function(t){var e,n=this.registers;return function(){var i=n[0];To.call(t,i,function(t){t.runEffects(function(){e=n.shift(),n.push(e)})})}},So=Xut.plat.prefixStyle,Mo=Xut.plat.prefixStyle;Ie.prototype={clearReference:function(){},compileSuspend:function(t,e){var n,i,a=this;n=function(){Xut.nextTick({container:e,content:t},function(){a.clearReference(),a.callback.successCallback()})},i=function(){a.suspendQueues=[],a.suspendQueues.push(function(){n()})},a.callback.suspendCallback(n,i)},runSuspendTasks:function(){if(this.suspendQueues){var t;(t=this.suspendQueues.pop())&&t(),this.suspendQueues=null}},parseMaster:function(t,e,n){t?C(e,function(t){n(t)}):n("")}};var Xo={};_.each("jsWidget content svgWidget canvasWidget path".split(" "),function(t,e){Xo[t]=!0});var Bo=function(t){return window.setTimeout(t,100)},Oo={},Ao=Xut.plat.prefixStyle,_o=document,Ro=Xut.plat.prefixStyle,No=Xut.plat.KEYFRAMES,Eo=Xut.plat.ANIMATION_EV,Do=null,$o=Ro("animation-play-state"),Ho=Ro("animation"),Lo=[],Go=Lo.slice,jo=(Lo.concat,Xut.CoreObject.extend({init:function(t){var e=this,n=[function(t){e.$emit("load")},function(t){console.log("failCallback")}];this.constructor.apply(this,n.concat(Go.call(arguments)))},playPixi:function(t){this.checkValidity(function(){this.play()})},stopPixi:function(){this.checkValidity(function(){this.stop()})},destroyPixi:function(){this.checkValidity(function(){this.destroy()})},checkValidity:function(t){var e=this.canvasRelated.failCid,n=this.contentId;e.length&&-1!==e.indexOf(n)||t&&t.call(this)},analysisPath:function(t){var e,n=t.md5,i=/.gif$/i.test(n),a=Xut.config.pathAddress+n;return e=i?Xut.createRandomImg(a):a}}));co.call(jo.prototype);var zo=jo.extend({constructor:function(t,e,n,i){function a(e,i){var a,s,c=[],u=[];a="object"==("undefined"==typeof i?"undefined":qi["typeof"](i))?i[Object.keys(i)[0]]:PIXI.loader.resources[i],c=Object.keys(a.textures).map(function(t){return a.textures[t]});var l=parseInt(a.url.split("fps=")[1]);b=new PIXI.extras.MovieClip(c),b.width=n.scaleWidth,b.height=n.scaleHeight,b.position.x=n.scaleLeft,b.position.y=n.scaleTop;var d=a.name.split(".").pop();if("jpg"==d){var s=i[Object.keys(i)[1]];u=Object.keys(s.textures).map(function(t){return s.textures[t]}),b.maskTextures=u,r.addChild(b.maskSprite)}b.animationSpeed=.15*l/10,b.play(),r.addChild(b),o.movie=b,t(y)}var o=this;this.data=n,this.canvasRelated=i,this.contentId=n._id;var r=new PIXI.Container;i.addChild(r);var s=this.analysisPath(n),c=s.replace(/^.*[\\\/]/,""),u="mask_"+c,l=s.split(".").pop(),d=s.replace(".jpg","_mask.png"),h=n.thecount,p=1;if(n.parameter){try{var f=JSON.parse(n.parameter)}catch(v){return void console.log("content parameter error")}var g=f.matrix,m=g.split("-");h=m[0],p=m[1]}var b,x="lib/data/spritesheet.json?imageurl="+s+"&cols="+h+"&rows="+p+"&total="+n.thecount+"&fps="+n.fps,y=this.contentId,k=new PIXI.loaders.Loader;if("png"==l)k.add(c,x).load(a);else{var I="lib/data/spritesheet.json?imageurl="+d+"&cols="+h+"&rows="+p+"&total="+n.thecount+"&fps="+n.fps;k.add(c,x).add(u,I).load(a)}k=null},play:function(){this.uuid=this.canvasRelated.play("sprite")},stop:function(){this.canvasRelated.stop(this.uuid)},destroy:function(){if(this.movie){this.stage&&this.stage.removeChild(this.movie);for(var t=0;t<this.movie.textures.length;t++)this.movie.textures[t].destroy(!0),this.movie.maskSprite&&this.movie.maskTextures[t].destroy(!0);this.movie.destroy(!0,!0)}this.canvasRelated.destroy()}}),Fo=0;hn.prototype.addSub=function(t){this.subs.push(t)},hn.prototype.removeSub=function(t){this.subs=[]},hn.prototype.notify=function(){this.subs.length&&console.log("\u4f9d\u8d56\u961f\u5217")};var Vo=function(t){_.extend(this,t)},Wo=Vo.prototype;Wo.init=function(t,e,n,i,a,o){var r,s=this.canvasRelated,c=this.pageIndex,u=this,l=function(t,r){return new t(c,o,i,r||e,a,n)};this.domMode&&(this.pptObj=l(PptAnimation),this.domSprites="Sprite"===this.contentDas.category),this.canvasMode&&(r=this.contentDas.actionTypes,r.spiritId&&(this.nextTask.context.add(t),this.pixiSpriteObj=new zo(this.contentDas,s),r.pptId&&this.pixiSpriteObj.$once("load",function(){u.pptObj=l(CanvasAnimation,this.movie),u.nextTask.context.remove(t)})),r.widgetId&&(this.linker=function(){return function(t){u.pptObj=l(CanvasAnimation,t.sprObjs[0].advSprite),u.linker.dep.notify(u.pptObj)}}(),this.linker.dep=new hn))},Wo.run=function(t){var e=this.$contentProcess,n=function(n){e.prop&&e.prop("mutex")&&e.css({display:"block"}),n.runAnimation(t)};if(dn(this.pptObj,n),dn(this.pixiSpriteObj,function(e){e.playPixi(t)}),this.domSprites&&e){if(this.spriteObj)return void this.spriteObj.playSprites();e=this.$contentProcess.find(".sprite").show(),this.spriteObj=un({element:e,data:this.contentDas,id:this.id,mode:"css"})}},Wo.stop=function(t){dn(this.pptObj,function(e){ln(e.options,t),e.stopAnimation()}),dn(this.pixiSpriteObj,function(t){t.stopPixi()}),dn(this.spriteObj,function(t){t.pauseSprites()})},Wo.reset=function(){dn(this.pptObj,function(t){t.resetAnimation()})},Wo.destroy=function(){dn(this.pixiSpriteObj,function(t){t.destroyPixi()}),dn(this.pptObj,function(t){t.destroyAnimation()}),dn(this.spriteObj,function(t){t.stopSprites()}),this.pptObj=null,this.spriteObj=null,this.getParameter=null,this.pixiSpriteObj=null};var Uo=void 0,qo={search:"images/icons/search.svg",clear:"images/icons/clear.svg",exit:"images/icons/exit.svg"};wn.prototype.init=function(){var t=this.searchForm(),e=this.parent[0];this.parent.append(t),this.searchBox=t,this.resultBox=t.find(".xut-search-result"),this.input=t.find(".xut-search-input"),this.searchBtn=t.find(".xut-search-btn"),Xut.plat.execEvent("on",{context:e,callback:{end:this}}),e.addEventListener("keyup",this,!1)},wn.prototype.searchForm=function(){var t=.3*window.innerWidth,e=window.innerHeight,n=this.tips||"\u8bf7\u5728\u641c\u7d22\u6846\u4e2d\u8f93\u5165\u8981\u641c\u7d22\u7684\u5173\u952e\u5b57",i='<div class="xut-form-search"><div class="xut-form-search-wrap"><div style="height:17%;"><div style="height:20%"></div><div class="xut-search-row"><input type="text" class="xut-search-input"><div class="xut-search-btn" style="background-image: url('+qo.search+')"></div></div><p class="xut-search-tips" style="line-height:'+Math.round(.06*e)+'px">'+n+'</p></div><div style="height:76%"><ul class="xut-search-result"></ul></div><div style="height:7%"><div class="xut-search-exit" style="background-image: url('+qo.exit+')"></div></div></div></div>',a=$(i);return a.css("width",200>t?200:t),a},wn.prototype.search=function(t){var e,n,i,a=Xut.data.Chapter,o=a.length,r="";if(!t)return void this.resultBox.html("");for(var s=0;o>s;s++)e=a.item(s),e.chapterTitle.indexOf(t)>-1&&(n=e._id,i=e.seasonId,r+='<li><a class="xut-search-link" data-mark="'+i+"-"+n+'" href="javascript:0">'+e.chapterTitle+"</a></li>");this.resultBox.html(r)},wn.prototype.iconManager=function(t){this.isChange&&this.searchBtn.css("background-image","url("+t+")")},wn.prototype.searchLink=function(t){if(t&&t.dataset){var e=t.dataset.mark.split("-"),n=e[0],i=e[1];Xut.View.LoadScenario({scenarioId:n,chapterId:i})}},wn.prototype.handleEvent=function(t){var e=t.target;switch(e.className){case"xut-search-btn":this.search(this.input.val()),this.isChange=!0,this.iconManager(qo.clear);break;case"xut-search-input":this.search(e.value),this.iconManager(qo.search),this.isChange=!1;break;case"xut-search-exit":this.exit();break;case"xut-search-link":this.searchLink(e)}},wn.prototype.exit=function(){this.input.val(""),this.resultBox.empty(),this.searchBox.hide()},wn.prototype.restore=function(){var t=this.searchBox;t&&t.show()},wn.prototype.destroy=function(){var t=this.parent[0];t.removeEventListener("keyup",this,!1),t.removeEventListener("touchend",this,!1),t.removeEventListener("mouseup",this,!1),this.searchBox.remove(),this.searchBox=null,this.resultBox=null,this.searchBtn=null,this.input=null,this.parent=null};var Qo,Yo={hide:"images/icons/arrowDown.svg"},Jo=parseInt($("body").css("font-size"))||16;Cn.prototype.init=function(){var t=this.createBookMark(),e=this.parent[0],n=this;this.parent.append(t),this.bookMarkMenu=t.eq(0),setTimeout(function(){n.restore()},20),Qo=this.getHistory(),Xut.plat.execEvent("on",{context:e,callback:{end:this}})},Cn.prototype.createBookMark=function(){var t=Xut.config.screenSize,e=t.height,n=3*Jo,i='<div class="xut-bookmark-menu" style="width:100%;height:{0}px;left:0;top:{1}px;"><div class="xut-bookmark-wrap"><div class="xut-bookmark-add">\u52a0\u5165\u4e66\u7b7e</div><div class="xut-bookmark-off" style="background-image:url({2})"></div><div class="xut-bookmark-view">\u4e66\u7b7e\u8bb0\u5f55</div></div></div><div class="xut-bookmark-list" style="display:none;width:100%;height:{3}px;"><ul class="xut-bookmark-head"><li class="xut-bookmark-back">\u8fd4\u56de</li><li>\u4e66\u7b7e</li></ul><ul class="xut-bookmark-body"></ul></div>';return i=String.format(i,n,e,Yo.hide,e),this.markHeight=n,$(i)},Cn.prototype.createMarkList=function(){var t,e,n,i="",a=this;return _.each(Qo,function(o){t=o.split("-"),e=t[0],n=t[1],o=a.getMarkId(e,n),i+='<li><a data-mark="'+o+'" class="xut-bookmark-id" href="javascript:0">\u7b2c'+n+'\u9875</a><a class="xut-bookmark-del" data-mark="'+o+'" href="javascript:0">X</a></li>'}),i},Cn.prototype.getMarkId=function(t,e){return t+"-"+e},Cn.prototype.getHistory=function(){var t=p("bookMark");return t?t.split(","):[]},Cn.prototype.addBookMark=function(){var t;this.updatePageInfo(),t=this.getMarkId(this.seasonId,this.pageId),Qo.indexOf(t)>-1||(Qo.push(t),h("bookMark",Qo))},Cn.prototype.updatePageInfo=function(){var t=Xut.Presentation.GetPageData();this.pageId=t._id,this.seasonId=t.seasonId},Cn.prototype.delBookMark=function(t){if(t&&t.dataset){var e=t.dataset.mark,n=Qo.indexOf(e);Qo.splice(n,1),h("bookMark",Qo),0==Qo.length&&f("bookMark"),$(t).parent().remove()}},Cn.prototype.viewBookMark=function(t){var e,n=this.createMarkList();e=this.bookMarkList?this.bookMarkList:$(t).parent().parent().next(),e.find(".xut-bookmark-body").html(n),this.bookMarkList=e,e.fadeIn()},Cn.prototype.iconManager=function(t){var e=this.bookMarkIcon=$(t),n=this.iconRestore;e.css({transform:"scale(1.2)","transition-duration":"500ms"})[0].addEventListener(Xut.plat.TRANSITION_EV,n.bind(this),!1)},Cn.prototype.iconRestore=function(){this.bookMarkIcon.css("transform","")},Cn.prototype.goBookMark=function(t){if(t&&t.dataset){var e=t.dataset.mark.split("-"),n=Number(e[0]),i=Number(e[1]);this.updatePageInfo(),this.backBookMark(),this.pageId==i&&this.seasonId==n||Xut.View.LoadScenario({scenarioId:n,chapterId:i})}},Cn.prototype.backBookMark=function(){this.bookMarkList.fadeOut()},Cn.prototype.handleEvent=function(t){var e=t.target;switch(e.className){case"xut-bookmark-add":this.addBookMark(),this.iconManager(e);break;case"xut-bookmark-view":this.viewBookMark(e),this.iconManager(e);break;case"xut-bookmark-off":this.closeBookMark(e);break;case"xut-bookmark-back":this.backBookMark();break;case"xut-bookmark-del":this.delBookMark(e);break;case"xut-bookmark-id":this.goBookMark(e)}},Cn.prototype.closeBookMark=function(t){this.bookMarkMenu.css({transform:"translate3d(0,0,0)","transition-duration":"1s"})},Cn.prototype.restore=function(){this.bookMarkMenu.css({transform:"translate3d(0,-"+this.markHeight+"px,0)","transition-duration":"1s"})},Cn.prototype.destroy=function(){var t=this.parent[0],e=Xut.plat;t.removeEventListener("touchend",this,!1),t.removeEventListener("mouseup",this,!1),this.bookMarkMenu&&(this.bookMarkMenu.remove(),this.bookMarkMenu=null),this.bookMarkList&&(this.bookMarkList.remove(),this.bookMarkList=null),this.bookMarkIcon&&(this.bookMarkIcon[0].removeEventListener(e.TRANSITION_EV,this.iconRestore,!1),this.bookMarkIcon=null),this.parent=null};var Ko=void 0,Zo=void 0,tr=void 0,er=void 0;Mn.prototype={adjustSize:function(t,e){t=parseInt(t),docEl.style.fontSize=t+"px",e&&h(this.storageName,t)},createIscroll:function(t){this.iscroll=new iScroll("#"+t,{scrollbars:!0,fadeScrollbars:!0})},init:function(t,e){var n=this,i=e.find(">").html();i=i.replace(/translate\(0px, -\d+px\)/g,"translate(0px,0px)");var a="htmlbox_"+t,o="htmlbox_iscroll_"+t;this.storageName=a+Xut.config.appId;var r=p(this.storageName);r&&this.adjustSize(r),this.$str=$(Sn(a,Pn(),o,i)),e.after(this.$str),this.createIscroll(o),this.eventContext=this.$str.find(".htmlbox-toolbar")[0];var s=["1","1.25","1.5"],c=function(t){n.adjustSize(t*Ko,!0),n.iscroll.refresh()},u={htmlbox_close_container:function(){n.adjustSize(Ko),n.removeBox()},htmlbox_close:function(){n.adjustSize(Ko),n.removeBox()},htmlbox_small:function(){c(s[0])},htmlbox_middle:function(){c(s[1])},htmlbox_big:function(){c(s[2])}};this.start=function(t){var e=t.target.className;u[e]&&u[e]()},Xut.plat.execEvent("on",{context:this.eventContext,callback:{start:this.start}})},removeBox:function(){Xut.plat.execEvent("off",{context:this.eventContext,callback:{start:this.start}}),this.$str&&this.$str.remove(),this.iscroll&&this.iscroll.destroy(),this.iscroll=null},destroy:function(){_.each(this.eventReference,function(t){t("tap")}),this.removeBox()}};var nr={tap:function(t){var e=t.eventContext;e.on("mousedown",t.eventRun),e.on("touchstart",t.eventRun)}},ir=On.prototype;ir.htmlTextBox=function(){var t,e,n,i=this,a=(this.eventData,this.relatedData),o=a.contentHtmlBoxIds;this.htmlBoxInstance=[],o.length&&a.contentDas&&_.each(a.contentDas,function(a){~o.indexOf(a._id)&&(t=a._id,e=i.makePrefix("Content",i.pid,t),n=i.findContentElement(e),n.attr("data-htmlbox")||(i.htmlBoxInstance.push(new Mn(t,n)),n.attr("data-htmlbox","true")))})},ir.makePrefix=function(t,e,n){return t+"_"+e+"_"+n},ir.findContentElement=function(t){var e,n,i=this.relatedData.contentsFragment;return(e=i[t])?e=$(e):(n=this.relatedData.containerPrefix)&&_.each(n,function(n,a){e=i[n],e=$(e).find("#"+t),e.length}),e},ir.eachAssistContents=function(t){_.each(this.abstractContents,function(e){t.call(this,e)},this)},ir.createActions=function(){var t=this.relatedData.pageId,e=this.rootNode,n=this.relatedCallback.contentsHooks,i=this.pageType;this.eachAssistContents(function(a){var o,r,s,c;if(o=a.$contentProcess){if("parallax"===a.processType)return void n(a.pid,a.id,a);r=a.id,s=a.isRreRun,c=a.getParameter(),void 0===s&&a.init(r,o,e,t,c,i),this.domRepeatBind(r,o,s,a,n,a.canvasMode)}})},ir.domRepeatBind=function(t,e,n,i,a,o){var r,s=this.relatedData;-1!==(r=s.createContentIds.indexOf(t))&&(s.createContentIds.splice(r,1),a(i.pid,t,i),o?n&&(this.nextTask.pre[t]=function(){this.nextTask.pre.push(function(t){console.log("\u9884\u6267\u884c",n)})}):(this.addIScroll(i,e),n&&e.css({visibility:n})))},ir.addIScroll=function(t,e){function n(e){var n=i.makePrefix("Content",t.pid,t.id),a=i.findContentElement(n);if(!Xut.plat.isAndroid)return function(){J(e)};var o=a.css("visibility"),r=function(){};if("hidden"==o){var s=a.css("opacity");0==s?(a.css({visibility:"visible"}),r=function(){a.css({visibility:o})}):(a.css({opacity:0}).css({visibility:"visible"}),r=function(){a.css({opacity:s}).css({visibility:o})})}return function(){J(e),r(),a=null,r=null}}var i=this,a=t.contentDas;a.isScroll&&(e.find(">").css("height",""),this.relatedCallback.iscrollHooks.push(n(e[0]))),a.mask&&a.isGif||e.find&&e.find("img").css({height:a.scaleHeight})},ir.checkCreate=function(t){var e=this.waitCreateContent;e&&e.length?an(this,e,t):t()},ir.runEffects=function(t,e){function n(t){r&&r.length&&-1!==r.indexOf(t.id)?s():(t.$contentProcess&&(t.canvasMode?(t.$contentProcess.visible="visible"===t.isRreRun,i.canvasRelated.oneRender()):t.$contentProcess.attr("isscroll")||t.$contentProcess.css({visibility:t.isRreRun})),s())}var i=this,a=this.relatedData.pageId;if(e&&(i.preventRepeat=!1),i.preventRepeat)return!1;if(i.preventRepeat=!0,!i.seed.animation)return i.preventRepeat=!1,void i.relevantOperation();var o,r=i.relatedData.partContentRelated,s=i.captureAnimComplete=function(e){return function(n){n&&n.$contentProcess&&n.$contentProcess.removeProp&&n.$contentProcess.removeProp("animOffset"),o=a!=Xut.Presentation.GetPageId(),o&&n&&(n.stop&&n.stop(a),n.reset&&n.reset()),1===e?(o&&i.resetAloneAnim(),i.preventRepeat=!1,i.relevantOperation(),t&&t(),i.captureAnimComplete=null):--e}}(this.abstractContents.length);i.checkCreate(function(){i.eachAssistContents(function(t){t.isRreRun?n(t):(t.$contentProcess&&t.$contentProcess.prop&&t.$contentProcess.prop({animOffset:t.$contentProcess.offset()}),t.run(function(){s(t)}))}),i.runState=!0})},ir.stopEffects=function(){var t=this.relatedData.pageId;this.runState=!1,this.eachAssistContents(function(e){!e.isRreRun&&e.stop&&e.stop(t)})},ir.resetAloneAnim=function(){An(this.eventData,function(t){t.reset()}),this.canvasRelated.stopRender&&setTimeout(function(){this.canvasRelated.stopRender()}.bind(this),0)},ir.resetAnimation=function(){this.eachAssistContents(function(t){!t.isRreRun&&t.reset&&t.reset()}),this.resetAloneAnim()},ir.destroyEffects=function(t){An(this.eventData,function(t){t.destroy()}),this.eachAssistContents(function(e){e.destroy&&e.destroy(),t&&t(e)})},ir.relevantOperation=function(){var t,e;if(this.eventData&&(e=this.eventData.eventContentId),e&&(t=this.relatedData.seasonRelated[e])){if(t.SearchBar)return void this.createSearchBar();if(t.BookMarks)return void this.createBookMark();if(void 0!==t.Inapp)return void(1==t.Inapp?Xut.Application.HasBuyGood():Xut.Application.BuyGood());if(t.seasonId||t.chapterId)return void setTimeout(function(){Xut.View.LoadScenario({scenarioId:t.seasonId,chapterId:t.chapterId})},Xut.fix.audio?1e3:0)}},ir.createSearchBar=function(){var t={parent:this.rootNode};this.searchBar?this.searchBar.restore():this.searchBar=new wn(t)},ir.createBookMark=function(){var t,e,n,i;"master"===this.pageType?(i=Xut.Presentation.GetPageData(),t=this.relatedData.floatMaters.container,n=i._id,e=i.seasonId):(t=this.rootNode,e=this.relatedData.seasonId,n=this.pageId);var a={parent:t,seasonId:e,pageId:n};this.bookMark?this.bookMark.restore():this.bookMark=new Cn(a)},ir.createEventRelated=function(){var t,e,n,i,a=this.eventData;if(t=a.eventContentId){var o=function(){e=this.pid,n=this.makePrefix("Content",e,this.id),i=this.findContentElement(n)},r=function(){i={},a.type="canvas",a.canvasMode=!0,a.domMode=!1};_.extend(a,{type:"dom",domMode:!0,canvasMode:!1}),-1!==this.canvasRelated.cid.indexOf(t)?r.call(this):o.call(this),a.eventContext=i,i?this.relatedCallback.contentsHooks(e,t,{$contentProcess:i,isBindEventHooks:!0,type:a.type}):a.parent=this}a.eventName=re(a.eventType)},ir.bindEventBehavior=function(t){function e(){var t,e=5;if(a.domMode&&(t=r.prop("animOffset"))){var n=t.left,o=t.top,s=r.offset(),c=s.left,u=s.top;(n>c-e&&c+e>n||o>u-e&&u+e>o)&&i.runEffects()}else i.runEffects()}function n(t){var n;if(n=t.behaviorSound){var o=function(){return new Xut.Audio({url:n,trackId:9999,complete:function(){this.play()}})};MMXCONFIG&&audioHandler?i._fixAudio.push(o()):o()}if(t.isButton)if(a.domMode)r.addClass("xut-behavior"),setTimeout(function(){r.removeClass("xut-behavior"),e()},500);else{var s=r.scale.x,c=r.position.x;r.scale.x+=.1,r.position.x-=Math.round(.05*c),i.canvasRelated.oneRender(),setTimeout(function(){r.scale.x=s,r.position.x=c,i.canvasRelated.oneRender()},200)}else e()}var i=this,a=this.eventData,o=a.eventName,r=a.eventContext,s={init:function(t){a.dragDrop=t},startRun:function(){},stopRun:function(t){t&&i.runEffects()}},c=function(){var t;(t=a.feedbackBehavior[a.eventContentId])?n(t):e()},u=function(t,e){a.eventReference=t,a.eventHandler=e};if(r&&o){var l,d,h=a.dragdropPara;"dragTag"===o&&(l=this.makePrefix("Content",this.pid,h),d=this.findContentElement(l)),a.isBind=!0,t.call(this,{eventDrop:s,eventRun:c,eventHandler:u,eventContext:r,eventName:o,parameter:h,target:d,domMode:a.domMode})}},ir.registerEvent=function(){var t=this.eventData;if("canvas"===t.type){var t=this.eventData,e=function(){t.eventContext={},this.bindEventBehavior(function(t){Xn(t)})};this.nextTask.event.push(e.bind(this))}else this.bindEventBehavior(function(t){oe(t)})},ir.autoPlay=function(t){var e=this.eventData;e&&"auto"===e.eventName?this.runEffects(t):t()},ir.flipOver=function(){this.runState&&this.stopEffects(),this.preventRepeat=!1,this.htmlBoxInstance.length&&_.each(this.htmlBoxInstance,function(t){t.removeBox()}),this._fixAudio.length&&(_.each(this._fixAudio,function(t){setTimeout(function(){t.end()},5e3)}),this._fixAudio=[])},ir.flipComplete=function(){this.resetAnimation()},ir.destroy=function(t){this.eventData.eventContext&&(se(this.eventData),this.eventData.eventContext=null),this.htmlBoxInstance.length&&(_.each(this.htmlBoxInstance,function(t){t.destroy()}),this.htmlBoxInstance=null),this.destroyEffects(t),this.iscroll&&(this.iscroll.destroy(),this.iscroll=null),this.searchBar&&(this.searchBar.destroy(),this.searchBar=null),this.bookMark&&(this.bookMark.destroy(),this.bookMark=null),this.rootNode=null},ir.recovery=function(){return this.runState?(this.stopEffects(),!0):!1};var ar=_n.prototype;ar.assert=function(t,e){var n=this,i=function(){n.suspendQueues=[],n.suspendQueues.push(function(){e.call(n)})},a=function(){e.call(n)};n.pageBaseHooks.suspend(t,a,i)},ar.runSuspendTasks=function(){if(this.suspendQueues){var t;(t=this.suspendQueues.pop())&&t(),this.suspendQueues=null}},ar.loadComplete=function(){this.pageBaseHooks.success()},ar.dataAfterCheck=function(t){this.assert("dataAfter",function(){t.floatMaters={ids:[],container:{},zIndex:{}},t.floatPages={ids:[],zIndex:{}},Dn(t);var e=function(e,n,i,a,o){t.contentHtmlBoxIds=o,t.contentsFragment={},Xut.IBooks.runMode()?_.each(a,function(e){t.contentsFragment[e]=t.element.find("#"+e)[0]}):t.contentsFragment=En(n),t.containerPrefix=i,Xut.Contents.contentsFragment[t.chapterId]||Xut.Contents.contentsFragment[t.chapterId],Xut.Contents.contentsFragment[t.chapterId]=t.contentsFragment,this.dataStrCheck(t,e)};en(e,t,this)})},ar.dataStrCheck=function(t,e){this.assert("strAfter",function(){Xut.sceneController.seasonRelated=t.seasonRelated,jn(function(e){this.eventAfterCheck(t,e)}.bind(this),t,e)})},ar.eventAfterCheck=function(t,e){var n=this;this.assert("eventAfter",function(){t.count=1;var i=function(){var t;_.each(e,function(e){for(;t=e.shift();)t()})},a=function(){i(),n.applyAfterCheck()},o=function(t){return function(){return 1===t.count?void(t.canvasRelated.enable&&t.canvasRelated.cid.length?(t.canvasRelated.display(),a()):a()):void t.count--}}(t);t.floatPages.ids&&t.floatPages.ids.length&&Ln(this,t,o),t.floatMaters.ids&&t.floatMaters.ids.length&&Hn(this,t,o),Xut.IBooks.runMode()?o():Xut.nextTick({container:t.element,content:Nn(t.contentsFragment)},o)})},ar.applyAfterCheck=function(){this.assert("applyAfter",function(){this.loadComplete(!0)})},ar.clearReference=function(){Xut.Contents.contentsFragment[this.chapterId]&&delete Xut.Contents.contentsFragment[this.chapterId],this.element=null,this.rootNode=null,this.contentsFragment=null},Fn.prototype={clearReference:function(){this.rootNode=null},create:function(t){function e(t,e){var i=e.scaleLeft;"left"===u&&i<Xut.config.screenSize.width&&n(t,e),"right"===u&&i>Xut.config.screenSize.width&&n(t,e)}function n(t,e){l.push(Na[t].createDom(e,r,s,c,Xut.zIndexlevel(),a))}var i,a=t.pageType,o=t.activitys,r=t.chpaterData,s=t.chapterId,c=t.pid,u=t.virtualOffset,l=[];return o.forEach(function(t,a){switch(i=t.actType||t.animation,!i&&t.note&&(t.actType=i="ShowNote"),i){case"ShowNote":case"Action":case"Widget":case"Audio":case"Video":t=w(t),Xut.config.virtualMode?e(i,t):n(i,t)}}),l.join("")},compileSuspend:function(t){var e,n,i=this;e=function(){Xut.nextTick({container:i.rootNode,content:$(t)},function(){i.clearReference(),i.callback.successCallback()})},n=function(){i.suspendQueues=[],i.suspendQueues.push(function(){e()})},i.callback.suspendCallback(e,n)},runSuspendTasks:function(){if(this.suspendQueues){var t;(t=this.suspendQueues.pop())&&t(),this.suspendQueues=null}}};var or={Container:function(t,e){Vn.call(e,[e.pid],function(){var n=e.baseData();if(n.parameter)try{var i=JSON.parse(n.parameter);i&&i.contentMode&&1==i.contentMode&&(e.canvasRelated.enable=!0)}catch(a){console.log("JSON\u9519\u8bef,chpterId\u4e3a",e.chapterId,n.parameter)}ke({rootNode:e.root,prefix:e.pageType+"-"+(e.pageIndex+1)+"-"+e.chapterId,pageType:e.pageType,pid:e.pid,baseData:n,virtualOffset:e.virtualOffset,initTransformParameter:e.createRelated.initTransformParameter,userStyle:e.userStyle},t)})},Background:function(t,e){if(!e.checkInstanceTasks("background")){var n=e.baseData(e.pid),i=function(t,n){e.nextTasks({taskName:"\u5185\u90e8background",outSuspendTasks:n,outNextTasks:t})},a=function(){t()};e.createRelated.cacheTasks.background=new Ie(e.getElement(),n,i,a)}},Components:function(t,e){if(!e.checkInstanceTasks("components")){var n=e.chapterDas,i=e.baseData(),a=function(t,n){e.nextTasks({taskName:"\u5185\u90e8widgets",outSuspendTasks:n,outNextTasks:t})},o=function(){t()};e.createRelated.cacheTasks.components=new Fn({rootNode:e.getElement(),nodes:n.nodes,pageOffset:n.pageOffset,activitys:e.baseActivits(),chpaterData:i,chapterId:i._id,pid:e.pid,pageType:e.pageType,virtualOffset:e.virtualOffset},a,o)}},Contetns:function(t,e){if(Xut.data.preventContent)return t();if(!e.checkInstanceTasks("contents")){var n=e.chapterDas,i=e.baseData(),a=i._id,o=e.baseActivits(),r=_.extend({},{suspend:function(t,n,i){var a;e.isAutoRun&&"strAfter"===t&&(a=!0),e.nextTasks({interrupt:a,
taskName:"\u5185\u90e8contents",outSuspendTasks:i,outNextTasks:n})},success:function(){t()}},e.listenerHooks);e.createRelated.cacheTasks.contents=new _n({canvasRelated:e.canvasRelated,rootNode:e.root,element:e.getElement(),pageType:e.pageType,nodes:n.nodes,pageOffset:n.pageOffset,activitys:o,chpaterData:i,chapterId:a,pageIndex:e.pageIndex,pid:e.pid,pageBaseHooks:r,virtualOffset:e.virtualOffset,initTransformParameter:e.createRelated.initTransformParameter})}}},rr=function(){this.enable=!1,this.failCid=[],this.cid=[],this.pptId=[],this.spiritId=[],this.widgetId=[],this.collections={}};co.call(rr.prototype);var sr=Wn.prototype;sr.initTasks=function(t){function e(t){a.nextRunTask=t}function n(t,e){return or[t](e,i)}var i=this;_.extend(i,t),this.dataCache={},this.scenarioId=this.chapterDas.seasonId,this.chapterId=this.chapterDas._id,this.isMultithread=!!this.multiplePages,"master"===i.pageType&&(this.isMaster=!0),this.canvasRelated=new rr;var a=this.createRelated={tasksHang:null,tasksTimer:0,isTaskSuspend:!1,preCreateTasks:!1,nextRunTask:"container",cacheTasks:function(){var t={};return _.each(["background","components","contents"],function(e){t[e]=!1}),t}(),initTransformParameter:jt(this.visiblePid,this.pid),preforkComplete:function(){},createTasksComplete:function(){}};this.abActivitys=new $t,this.components=new $t,this.contentsCollector={};var o=this.floatContents={PageContainer:null,Page:{},MasterContainer:null,Master:{}};this.listenerHooks={registerAbstractActivity:function(t){i.abActivitys.register(t)},collector:{contents:function(t,e,n){var a=i.baseGetContentObject[e];a&&a.isBindEventHooks&&(i.contentsCollector[e]=n),a||(i.contentsCollector[e]=n)},floatPages:function(t){var e;o.PageContainer=t.container,_.each(t.ids,function(t){(e=i.baseGetContentObject(t))?(e.parallax&&(e.parallaxOffset=e.parallax.parallaxOffset),o.Page[t]=e):console.log("\u9875\u9762\u6d6e\u52a8\u5bf9\u8c61\u627e\u4e0d\u5230")})},floatMaters:function(t){var e,n,a,r;o.MasterContainer=t.container,_.each(t.ids,function(t){(n=i.baseGetContentObject(t))?(n.parallax&&(n.parallaxOffset=n.parallax.parallaxOffset),o.Master[t]=n):(Xut.plat.isBrowser&&console.log("\u6d6e\u52a8\u6bcd\u7248\u5bf9\u8c61\u6570\u636e\u4e0d\u5b58\u5728\u539f\u59cb\u5bf9\u8c61,\u5236\u4f5c\u4f2a\u5bf9\u8c61\u6bcd\u7248\u79fb\u52a8",t),(r=i.createRelated.cacheTasks.contents.contentsFragment)&&(e="Content_"+i.pid+"_",_.each(r,function(n){makePrefix=e+t,n.id==makePrefix&&(a=n)})),o.Master[t]={id:t,pid:i.pid,$contentProcess:$(a),empty:!0})})}},eventBinding:function(t){ue(i,t)}},i.tasks={container:function(){n("Container",function(t,n){i.element=t,i.pseudoElement=n,i.getElement=function(){return n?n:t},e("background"),a.preforkComplete(),i.isMaster&&i.nextTasks({taskName:"\u5916\u90e8background",outNextTasks:function(){i.dispatchTasks()}})})},background:function(){var t=function(){a.preCreateTasks=!1,e("components"),a.tasksHang&&!i.isMaster||i.nextTasks({taskName:"\u5916\u90e8widgets",outNextTasks:function(){i.dispatchTasks()}}),a.tasksHang&&a.tasksHang()};n("Background",t)},components:function(){n("Components",function(){e("contents"),i.nextTasks({taskName:"\u5916\u90e8contents",outNextTasks:function(){i.dispatchTasks()}})})},contents:function(){n("Contetns",function(){e("complete"),a.createTasksComplete()})}}},sr.startThreadTask=function(t,e){this.createRelated.preforkComplete=function(n){return function(){t?e():n.checkTasksCreate(function(){e()})}}(this),this.dispatchTasks()},sr.checkThreadTask=function(t){var e=this;this.isAutoRun=!0,this.checkTasksCreate(function(){e.isAutoRun=!1,t()})},sr.createPreforkTasks=function(t,e){var n=this;return this.createRelated.preCreateTasks?void(this.createRelated.tasksHang=function(t){return function(){n.checkTasksCreate(t)}}(t)):(e&&(this.createRelated.preCreateTasks=!0),void this.checkTasksCreate(t))},sr.checkTasksCreate=function(t,e){if("complete"===this.createRelated.nextRunTask)return t.call(e);var n=this;this.cancelTaskSuspend(),this.createRelated.createTasksComplete=function(){t.call(e)},this.nextTasks({outNextTasks:function(){n.dispatchTasks()}})},sr.setTaskSuspend=function(){this.isAutoRun=!1,this.canvasRelated.isTaskSuspend=!0,this.createRelated.preCreateTasks=!1,this.createRelated.tasksHang=null},sr.cancelTaskSuspend=function(){this.canvasRelated.isTaskSuspend=!1},sr.checkTaskSuspend=function(){return this.canvasRelated.isTaskSuspend},sr.multithreadCheck=function(t,e){function n(){a.checkTaskSuspend()?(a.tasksTimeOutId&&clearTimeout(a.tasksTimeOutId),t.suspendCallback.call(a)):t.nextTaskCallback.call(a)}function i(){a.tasksTimeOutId=setTimeout(function(){n()},a.canvasRelated.tasksTimer)}var a=this;a.isAutoRun?e?i():n():i()},sr.asyTasks=function(t,e){return this.isMultithread?void this.multithreadCheck(t,e):t.nextTaskCallback.call(this)},sr.nextTasks=function(t){var e,n;this.asyTasks({suspendCallback:function(){(e=t.outSuspendTasks)&&e()},nextTaskCallback:function(){(n=t.outNextTasks)&&n()}},t.interrupt)},sr.dispatchTasks=function(){var t;(t=this.tasks[this.createRelated.nextRunTask])&&t()},sr.checkInstanceTasks=function(t){var e;return(e=this.createRelated.cacheTasks[t])?(e.runSuspendTasks(),!0):void 0},sr.baseData=function(){return this.dataCache[this.pageType]},sr.baseActivits=function(){return this.dataCache.activitys},sr.baseAutoRun=function(){var t=this.dataCache.autoRunDas;return t&&t},sr.baseGetPageId=function(t){return this.baseData(t)._id},sr.baseGetContentObject=function(t){var e;return(e=this.contentsCollector[t])?e:this.floatContents.Master[t]},sr.baseContentMutex=function(t,e){var n,i=this;if(n=i.baseGetContentObject(t)){var a=n.$contentProcess,o={Show:function(){"dom"===n.type?a.css({display:"blcok",visibility:"visible"}).prop("mutex",!1):(a.visible=!0,console.log("show"),i.canvasRelated.oneRender())},Hide:function(){"dom"===n.type?a.css({display:"none",visibility:"hidden"}).prop("mutex",!0):(console.log("hide"),a.visible=!1,i.canvasRelated.oneRender())},StopAnim:function(){n.stopAnims&&n.stopAnims()}};o[e]()}},_.each(["Get","Specified"],function(t){sr["base"+t+"Content"]=function(e){switch(t){case"Get":return this.abActivitys.get();case"Specified":return this.abActivitys.specified(e)}}}),_.each(["Get","Remove","Register","Specified"],function(t){sr["base"+t+"Component"]=function(e){switch(t){case"Register":return this.components.register(e);case"Get":return this.components.get();case"Specified":return this.components.specified(e);case"Remove":return this.components.remove()}}}),sr.baseAssistRun=function(t,e,n){var i;(i=this.abActivitys)&&_.each(i.get(),function(i,a){t==i.activityId&&("Run"==n&&i.runEffects(e,!0),"Stop"==n&&i.stopEffects(e))},this)},sr.baseDestroy=function(){try{this.element.hide().find("img").each(function(t,e){e.src="images/icons/clearmem.png"})}catch(t){}var e,n,i;if(e=this.createRelated.cacheTasks)for(n in e)(i=e[n])&&i.clearReference();var a,o=this.floatContents.Master,r=!_.isEmpty(o);(a=this.abActivitys.get())&&a.forEach(function(t){t.destroy(function(t){(!r||t&&!o[t.id])&&(t.$contentProcess=null)})}),r&&this.floatContents.MasterContainer&&this.floatContents.MasterContainer.remove(),this.floatContents.Page&&this.floatContents.PageContainer&&this.floatContents.PageContainer.remove();var s;(s=this.baseGetComponent())&&s.length&&s.forEach(function(t){t.destroy&&t.destroy()}),le(this),this.canvasRelated&&this.canvasRelated.destroy&&this.canvasRelated.destroy(),this.pseudoElement&&(this.pseudoElement=null),this.element.remove(),this.root=null,this.element=null};var cr=Xut.extend(Wn,{constructor:function(t){return this.initTasks(t),this}}),ur=Yn.prototype;ur.create=function(t,e){var n=new cr(_.extend(t,{pageType:this.pageType,root:this.rootNode}));return this.abstractAddCollection(e,n),n},ur.clearPage=function(t){var e;(e=this.abstractGetPageObj(t))&&(e.baseDestroy(),this.abstractRemoveCollection(t))},ur.destroy=function(){Jn(Xut.Presentation.GetPageIndex()),this.abstractDestroyCollection(),this.rootNode=null},ur.suspendInnerCreateTasks=function(t){var e,n=this;[t.leftIndex,t.currIndex,t.rightIndex].forEach(function(t){(e=n.abstractGetPageObj(t))&&e.setTaskSuspend()})},ur.checkTaskCompleted=function(t,e){var n,i=this;(n=i.abstractGetPageObj(t))&&n.checkThreadTask(function(){e(n)})},ur.checkPreforkTasks=function(t,e){var n,i;for(t.length||(t=[t]),i=t.length;i--;)(n=this.abstractGetPageObj(t[i]))&&n.createPreforkTasks(function(){},e)},ur.move=function(t,e,n,i,a,o,r){function s(){return[this.abstractGetPageObj(t),this.abstractGetPageObj(e),this.abstractGetPageObj(n)]}_.each(s.call(this),function(t,e){if(t){var n;(n=t.floatContents.PageContainer)&&ko[o].call(t,r[e],a,n),ko[o].call(t,r[e],a)}})},ur.suspend=function(t){var e=t.stopPointer,n=this.abstractGetPageObj(e),i=n.baseGetPageId(e);Kn(n,"postCode"),this.suspendInnerCreateTasks(t),it(n,i)},ur.resetOriginal=function(t){var e,n;(e=this.abstractGetPageObj(t))&&((n=e.floatContents.PageContainer)&&n.css({zIndex:2e3,overflow:"hidden"}),ot(e))},ur.autoRun=function(t){function e(e){var n;n=t.isQuickTurn||!t.direction?[t.prevIndex,t.nextIndex]:t.createPointer||t.nextIndex||t.prevIndex,i.checkPreforkTasks(n,e)}function n(t,n){function i(){n.processComplete(),e()}function a(){et(t,n.currIndex,i)}var o=t.element;return o?void(n.suspendCallback?n.suspendCallback(a):a()):i()}var i=this;this.checkTaskCompleted(t.currIndex,function(a){var o;(o=a.floatContents.PageContainer)&&o.css({zIndex:2001,overflow:""}),Xut.plat.noMaskBoxImage&&Qn(),t.buildComplete(a.scenarioId),Kn(a,"preCode"),i.resetOriginal(t.suspendIndex),e("background"),n(a,t)})},o(Yn,Dt);var lr=Xut.plat.prefixStyle,dr="-",hr=Zn.prototype;hr.create=function(t,e,n){var i,a,o,r=t.chapterDas.pptMaster,s=t.chapterDas.pageOffset;return a=s&&s.split(dr),o=a&&3===a.length?r+dr+a[2]:r,this._checkRepeat(o,s,e)?void 0:(n(),i=new cr(_.extend(t,{pageType:this.pageType,root:this.rootNode,pptMaster:r})),this.abstractAddCollection(o,i),i)},hr.destroy=function(){this.rootNode=null,this.abstractDestroyCollection()},hr.findMaster=function(t,e,n,i,a){var o,r,s,c,u,l=this.conversionMasterId(t),d=this.conversionMasterId(e),h=this.conversionMasterId(n);switch(i){case"prev":(o=d!==l)&&(c=this.abstractGetPageObj(d)),l&&o&&("flipOver"===a&&this.checkClear([d,l]),s=this.abstractGetPageObj(l));break;case"next":(r=d!==h)&&(c=this.abstractGetPageObj(d)),h&&r&&("flipOver"===a&&this.checkClear([d,h]),u=this.abstractGetPageObj(h))}return[s,c,u]},hr.move=function(t,e,n,i,a,o,r,s){function c(t){u.moveParallaxs(a,e,o,i,r,t)}var u=this,l=!1;if(_.each(this.findMaster(t,e,n,i,o),function(t,e){t&&(l=!0,t.onceMaster=!1,ko[o].call(t,a[e],r),t.floatContents.MasterContainer&&ko[o].call(t,a[e],r,t.floatContents.MasterContainer))}),this.isBoundary=l,!l)switch(i){case"prev":c();break;case"next":s&&c(s)}},hr.suspend=function(t){if(this.isBoundary){var e,n=t.stopPointer;if(e=this.abstractGetPageObj(n)){var i=e.baseGetPageId(n);it(e,i)}}},hr.resetOriginal=function(t){var e;(e=this.abstractGetPageObj(t))&&ot(e)},hr.autoRun=function(t){var e;(e=this.abstractGetPageObj(t.currIndex))&&(this.resetOriginal(t.suspendIndex),et(e,t.currIndex))},hr.moveParallaxs=function(t,e,n,i,a,o){function r(t,e,n,i,a,o,r,s){var c,u,l=e.translate,d=e.offsetTranslate;switch("prev"===n&&(c=e.nodeProportion,o=o==c?0:c),u=p._transformConversion(l,r,o),i){case"flipMove":u=p._flipMove(u,d);break;case"flipRebound":u=p._flipRebound(u,d);break;case"flipOver":"prev"===n&&(u=p._flipOver(u,d)),p._overMemory(u,d)}p._transformNodes(t,a,u,d.opacityStart||0)}var s,c,u,l,d,h,p=this;(l=this.abstractGetPageObj(this.conversionMasterId(e)))&&(u=l.baseGetContent())&&(p.baseContents=u,d=t[1],_.each(u,function(t){t.eachAssistContents(function(t){if(t.parallax){if(s=t.parallax.rootNode,c=l.baseGetContentObject(t.id),"flipMove"===n&&c.anminInstance&&!c.parallaxProcessed){var e=c.actName;c.stopAnimations(),c.parallaxProcessed=!0,s.attr("data-parallaxProcessed",e),p.parallaxProcessedContetns[e]=c}r(s,t.parallax,i,n,a,o,d,h)}})}))},hr.reactivation=function(t){if(this.parallaxProcessedContetns){var e=t.id,n=this.parallaxProcessedContetns[e];n&&(n.runAnimations(),n.parallaxProcessed=!1,t.removeAttribute("data-parallaxProcessed"),delete this.parallaxProcessedContetns[e])}},hr._transformNodes=function(t,e,n,i){var a={},o="",r=0,s=0,c=0,u=Math.round;void 0==n.translateX&&void 0==n.translateY&&void 0==n.translateZ||(r=u(n.translateX)||0,s=u(n.translateY)||0,c=u(n.translateZ)||0,o+=String.format("translate3d({0}px,{1}px,{2}px) ",r,s,c)),void 0==n.rotateX&&void 0==n.rotateY&&void 0==n.rotateZ||(r=u(n.rotateX),s=u(n.rotateY),c=u(n.rotateZ),o+=r?"rotateX("+r+"deg) ":"",o+=s?"rotateY("+s+"deg) ":"",o+=c?"rotateZ("+c+"deg) ":""),void 0==n.scaleX&&void 0==n.scaleY&&void 0==n.scaleZ||(r=u(100*n.scaleX)/100||1,s=u(100*n.scaleY)/100||1,c=u(100*n.scaleZ)/100||1,o+=String.format("scale3d({0},{1},{2}) ",r,s,c)),void 0!=n.opacity&&(a.opacity=u(100*n.opacity)/100+i,o+=";"),o&&(a[lr("transition-duration")]=e+"ms",a[lr("transform")]=o,t.css(a))},hr.makeJumpPocesss=function(t){var e,n=this;return{pre:function(){var i=t.targetIndex,a=n.conversionMasterId(i);e=n.scanBounds(i,a),n.checkClear(e,!0),n.currMasterId=a},clean:function(t,i){n._fixPosition(e),n._checkParallaxPox(t,i)}}},hr.scanBounds=function(t,e){for(var n,i,a=this.conversionMasterId(t),o={},r=t;r--;)if(n=this.conversionMasterId(r),n&&n!==e){o.prev=n;break}return i=this.conversionMasterId(t+1),i&&i!==e&&(o.next=i),a&&(o.curr=a),o},hr._fixPosition=function(t){function e(t,e){function i(e,n){var i=t.element;i&&(i.css(lr("transition-duration"),n+"ms"),i.css(lr("transform"),"translate3d("+e+"px,0px,0px)"))}"prev"===e?i(-n.screenWidth):"next"===e?i(n.screenWidth):"curr"===e&&i(0)}var n=this;for(var i in t)switch(i){case"prev":e(this.abstractGetPageObj(t[i]),"prev");break;case"curr":e(this.abstractGetPageObj(t[i]),"curr");break;case"next":e(this.abstractGetPageObj(t[i]),"next")}},hr._checkParallaxPox=function(t,e){var n,i,a=this.abstractGetCollection();for(n in a)i=a[n],this._fixParallaxPox(i,t,e)},hr._toRepeat=function(t,e){var n;return(n=this.recordMasterscope[t])?n:!1},hr._updataMasterscope=function(t,e){var n;(n=this.recordMasterscope[t])?-1===n.indexOf(e)&&n.push(e):this.recordMasterscope[t]=[e]},hr._updatadParallaxMaster=function(t,e){this.recordMasterId[e]=t,this.currMasterId=this.conversionMasterId(Xut.Presentation.GetPageIndex())},hr._checkRepeat=function(t,e,n){var i=this._toRepeat(t,n);return this._updataMasterscope(t,n),this._updatadParallaxMaster(t,n),i},hr._transformConversion=function(t,e,n){var i,a={};for(i in t)switch(i){case"translateX":case"translateZ":a[i]=e*n*t[i];break;case"translateY":a[i]=e*(this.screenHeight/this.screenWidth)*n*t[i];break;case"opacityStart":a[i]=t.opacityStart;break;default:a[i]=-1*e/this.screenWidth*t[i]*n}return a},hr._flipMove=function(t,e){var n={},i=t.opacityStart;for(var a in t)n[a]=t[a]+e[a];return i>-1&&(n.opacityStart=i),n},hr._flipRebound=function(t,e){var n={};for(var i in t)n[i]=e[i]||t[i];return n},hr._flipOver=function(t,e){return this._flipMove(t,e)},hr._overMemory=function(t,e){for(var n in t)e[n]=t[n]},hr._fixParallaxPox=function(t,e,n){function i(t,e,n){var i,a=t.calculateRangePage(),r=t.rootNode,s=t.translate,c=t.offsetTranslate,u=Xut.Presentation.GetPageNode(n-1);n>e?n>a.end&&(u=1):n<a.start&&(u=0),i=this._transformConversion(s,-o.screenWidth,u),this._transformNodes(r,300,i,c.opacityStart),this._overMemory(i,c)}var a,o=this;(a=t.baseGetContent())&&a.forEach(function(t){t.eachAssistContents(function(t){t.parallax&&i.call(o,t.parallax,e,n)})})},hr.checkClear=function(t,e){var n,i=_.keys(this.abstractGetCollection());(i.length>2||e)&&(t=ti(t),_.each(t,function(t){void 0!==t&&(n=i.indexOf(t.toString()),-1!==n&&i.splice(n,1))}),this.clearMemory(i))},hr.clearMemory=function(t){var e,n=this;_.each(t,function(t){(e=n.abstractGetPageObj(t))&&(e.baseDestroy(),n.abstractRemoveCollection(t),n.removeRecordMasterscope(t)),delete n.recordMasterscope[t]})},hr.register=function(t,e,n){var i;(i=this.abstractGetPageObj(this.conversionMasterId(t)))&&i.registerCotents.apply(pageObj,arguments)},hr.conversionMasterId=function(t){return this.recordMasterId?this.recordMasterId[t]:void 0},hr.removeRecordMasterscope=function(t){var e=this,n=e.recordMasterscope[t];n.forEach(function(t){delete e.recordMasterId[t]})},o(Zn,Dt);var pr={statement:{},novelId:null,count:0,collectError:[]},fr={};"Setting,Parallax,Master,Activity,Content,Video,Image,Action,Animation,Widget,Novel,Season,Chapter".replace(/[^, ]+/g,function(t){pr.statement[t]="select * FROM "+t+" order by _id ASC"}),pr.oneQuery=function(t,e){M("select * FROM "+t+" order by _id ASC",function(t,n){e(t)})},pr.query=function(){var t;return $.Deferred(function(e){return Object.keys(fr).length?void e.resolve(fr):void(Xut.IBooks.CONFIG?e.resolve(Xut.IBooks.CONFIG.data):M(pr.statement,function(n,i){for(t in n)fr[t]=n[t];e.resolve(fr)}))}).promise()},pr.remove=function(t,e){var n="delete from "+t+" where _id = "+e;return $.Deferred(function(t){M(n,function(e,n){e?t.resolve():n&&t.reject()})}).promise()};var vr=void 0,gr=void 0,mr=void 0,br=xi.prototype;br.initCreate=function(){var t=this.options;this.create(vi.call(this,t.initIndex,t.pagetotal,t.multiplePages),t.initIndex,"init")},br.create=function(t,e,n,i,a){if(void 0!==t[0]){var o,r,s,c,u,l,d,h=Xut.config.virtualMode,p=this,f=this.options.multiplePages,v=t.length,g="toPage"===n,m="flipOver"===n,b=gi.call(this,t,e),x=[],y=!1,k=function(){var t=0;return function(e){++t,t===v&&e()}}(),d={init:function(){k(function(){p.loadPage("init")})},flipOver:function(){k(function(){p.autoRun({createPointer:b,createMaster:y})})},toPage:function(){k(function(){i(x)})}},I=mi(b);if(h&&!I.length){var w=_.extend([],b);b.forEach(function(t,e){w.splice(e,1,--t)}),I=mi(w)}_.each(I,function(t,i){o=b[i],u=pi.call(p,o,e),s=u.visiblePid,c=u.pageIndex;var k=!1,I=!1;if(h){var w=function(t){var e=gi.call(p,[t]);return mi([e])[0]};I=hi(c),"left"===I&&(t=w(c/2)),"right"===I&&(t=w((c-1)/2))}1===v&&(p.options.chapterId=t._id),l=function(e){g&&s!==o&&(a=void 0);var i={pageIndex:c,multiplePages:f,pid:o,chapterDas:t,visiblePid:s,userStyle:a,virtualPid:k,virtualOffset:I};r=this.create(i,c,e),r&&(r.startThreadTask(m,function(){d[n]()}),a&&x.push(r))},t.pptMaster&&p.masterMgr&&l.call(p.masterMgr,function(){++v,y=!0}),l.call(p.pageMgr)})}},br.move=function(t){var e=t.action;if(!this.options.pageFlip||"flipMove"!=e){var n=t.speed,i=t.distance,a=t.leftIndex,o=t.pageIndex,r=t.rightIndex,s=t.direction,c=fi(e,i,s),u=this.pageMgr.abstractGetPageObj(o).chapterDas.nodes;this.pageMgr.move(a,o,r,s,n,e,c),this.callMasterMgr(function(){this.move(a,o,r,s,c,e,n,u)}),"flipOver"===e&&setTimeout(function(){this.vm.$emit("change:pageUpdate","next"===s?r:a)}.bind(this),0)}},br.suspend=function(t){this.pageMgr.suspend(t),this.callMasterMgr(function(){this.suspend(t)}),ht(),this.vm.$emit("change:resetToolbar")},br.complete=function(t,e,n,i){this.direction=t,this.isQuickTurn=i||!1,this.unfliplock=n,this._clearPage(e.destroyPointer),this._updatePointer(e),this._advanceCreate(t,e)},br._clearPage=function(t){this.pageMgr.clearPage(t)},br._updatePointer=function(t){this.pagePointer=t},br._advanceCreate=function(t,e){var n=this.options.pagetotal,i=this.vm,a=e.createPointer,o=(e.destroyPointer,function(){delete e.createPointer,delete e.destroyPointer}),r=function(t,e){this.create([t],e,"flipOver")};if("next"===t){if(e.currIndex===n-1)return this.autoRun(),2==n&&i.$emit("change:showPrev"),void i.$emit("change:hideNext");if(n>a)return r.call(this,a,e.currIndex),o(),void i.$emit("change:showPrev")}if("prev"===t){if(0===e.currIndex)return this.autoRun(),2==n&&i.$emit("change:showNext"),void i.$emit("change:hidePrev");if(e.currIndex>-1)return r.call(this,a,e.currIndex),o(),void i.$emit("change:showNext")}o()},br.autoRun=function(t){function e(){0==o?p.$emit("change:hidePrev"):o==n.pagetotal-1?(p.$emit("change:hideNext"),p.$emit("change:showPrev")):(p.$emit("change:showNext"),p.$emit("change:showPrev"))}var n=this.options,i=this.pagePointer,a=i.leftIndex,o=i.currIndex,r=i.rightIndex,s=t?t.action:"",c=t?t.createPointer:"",u=this.direction,l="init"===s?"":"next"===u?a:r;c&&(c=pi.call(this,c));var d={prevIndex:a,currIndex:o,nextIndex:r,suspendIndex:l,createPointer:c,direction:u,isQuickTurn:this.isQuickTurn,suspendCallback:n.suspendAutoCallback,buildComplete:function(t){if(Xut.config.recordHistory&&!n.isInApp&&n.multiScenario){var e;(e=Xut.sceneController.sequence(t,o))&&h("history",e)}},processComplete:function(){}};this.pageMgr.autoRun(d),this.callMasterMgr(function(){(s||this.isBoundary)&&this.autoRun(d)});var p=this.vm;switch(s){case"init":p.$emit("change:pageUpdate",o),e.call(this),setTimeout(function(){$("#startupPage").remove(),$("#removelayer").remove()},2e3);break;case"toPage":p.$emit("change:pageUpdate",o),e.call(this)}n.multiScenario||h("pageIndex",o),this.unfliplock&&(this.unfliplock(),this.unfliplock=null),this.isQuickTurn=!1},br.jumpPage=function(t){Xut.View.ShowBusy(),this.options.multiplePages||(t.create=[t.targetIndex],t.destroy=[t.currIndex],t.ruleOut=[t.targetIndex],t.pagePointer={currIndex:t.targetIndex}),di(this,t,function(t){this._updatePointer(t.pagePointer),this.autoRun({action:"toPage",createPointer:t.create}),Xut.View.HideBusy()})},br.loadPage=function(t){function e(){i.autoRun({action:"init"})}function n(){if($("#sceneHome").css({visibility:"visible"}),GLOBALIFRAME)return void e();if(Xut.Application.getAppState()){var t=Xut.Application.LaunchApp;Xut.Application.LaunchApp=function(){t(),e()}}else e()}var i=this;i.vm.$emit("change:createComplete",function(){i.options.multiScenario?e():n()})},br.callMasterMgr=function(t){this.masterMgr&&t.call(this.masterMgr)},br.destroy=function(){this.pageMgr.destroy(),this.callMasterMgr(function(){this.destroy()})};var xr=void 0,yr=yi.prototype;co.call(yr),e(yr,"$multiScenario",{get:function(){return this.options.multiScenario}}),e(yr,"$injectionComponent",{set:function(t){var e;(e=this.$scheduler[t.pageType+"Mgr"])?e.abstractAssistPocess(t.pageIndex,function(e){e.baseRegisterComponent.call(e,t.widget)}):console.log("\u6ce8\u518cinjection\u5931\u8d25,regData="+t)}}),e(yr,"$curVmPage",{get:function(){return this.$scheduler.pageMgr.abstractGetPageObj(this.$globalEvent.hindex)}}),t(yr,"$bind",function(t,e){var n=this;n.$watch("change:"+t,function(){e.apply(n,arguments)})}),t(yr,"$init",function(){this.$scheduler.initCreate()}),t(yr,"$run",function(){var t=this;t.$scheduler.pageMgr.activateAutoRuns(t.$globalEvent.hindex,Xut.Presentation.GetPageObj())}),t(yr,"$reset",function(){return this.$scheduler.pageMgr.resetOriginal(this.$globalEvent.hindex)}),t(yr,"$suspend",function(){Xut.Application.Suspend({skipMedia:!0})}),t(yr,"$destroy",function(){this.$off(),this.$globalEvent.destroy(),this.$scheduler.destroy(),this.$scheduler=null,this.$globalEvent=null}),t(yr,"$overrideApi",function(){Et(this)});var kr=void 0,Ir=Pi.prototype;Ir.createScenario=function(t,e){if(Xut.IBooks.runMode())return this.elements=$("#sceneHome"),void t.call(this);var n,i,a=this;i=e.isMain?It():wt(this.scenarioId),n=this.elements=$(i),Xut.nextTick({container:a.container,content:n},function(){t.call(a)})},Ir.initToolBar=function(){var t,e=this.scenarioId,n=this.pageTotal,i=this.pageIndex,a=this.elements,o=function(){return a.find("#controlBar")};return this.isMain?(t=Ii(e,n),kr.scrollPaintingMode?this.sToolbar=new so({container:a,controlBar:o(),pageMode:t.pageMode}):_.some(t.tbType)&&(this.sToolbar=new no({container:a,controlBar:o(),pageTotal:n,currentPage:i+1,pageMode:t.pageMode}))):(t=wi(this.barInfo,n),t&&(this.cToolbar=new io({id:e,container:a,tbType:t.tbType,pageTotal:n,currentPage:i,pageMode:t.pageMode}))),t},Ir.createViewModel=function(){var t=this,e=this.scenarioId,n=this.pageTotal,i=this.pageIndex,a=this.elements,o=this.pageMode,r=this.isMain,s=Ci(a,e,r),c=s("pageContainer","scenarioPage-"),u=s("masterContainer","scenarioMaster-"),l=this.vm=new yi({container:this.elements[0],pageMode:o,multiScenario:!r,rootPage:c,rootMaster:u,initIndex:i,pagetotal:n,sectionRang:this.sectionRang,scenarioId:e,chapterId:this.chapterId,isInApp:this.isInApp}),d=this.isToolbar=this.cToolbar?this.cToolbar:this.sToolbar;l.$bind("pageUpdate",function(t){d&&d.updatePointer(t)}),l.$bind("showNext",function(){d&&d.showNext()}),l.$bind("hideNext",function(){d&&d.hideNext()}),l.$bind("showPrev",function(){d&&d.showPrev()}),l.$bind("hidePrev",function(){d&&d.hidePrev()}),l.$bind("toggleToolbar",function(t,e){d&&d.toggle(t,e)}),l.$bind("resetToolbar",function(){t.sToolbar&&t.sToolbar.reset()}),l.$bind("createComplete",function(e){t.complete&&setTimeout(function(){r?t.complete(function(){Xut.View.HideBusy(),Ti(t.history)||e&&e(),Xut.Application.AddEventListener()}):t.complete(e)},200)}),DUKUCONFIG&&r&&DUKUCONFIG.success?(DUKUCONFIG.success(),l.$init()):CLIENTCONFIGT&&r&&CLIENTCONFIGT.success?(CLIENTCONFIGT.success(),l.$init()):l.$init(),kr.debugMode&&Xut.plat.isBrowser&&this.bindWatch()},Ir.bindWatch=function(){if(Xut.plat.isBrowser){var t=this.vm;this.testWatch=$(".xut-controlBar-pageNum").click(function(){console.log("\u4e3b\u573a\u666f",t),console.log("\u4e3b\u573a\u666f\u5bb9\u5668",t.$scheduler.pageMgr.Collections),console.log("\u4e3b\u573a\u666f\u89c6\u89c9\u5dee\u5bb9\u5668",t.$scheduler.parallaxMgr&&t.$scheduler.parallaxMgr.Collections),console.log("\u591a\u573a\u666f",ya.expose()),console.log("\u97f3\u9891",Xut.AudioManager),console.log("\u89c6\u9891",Xut.VideoManager),console.log("\u6570\u636e\u5e93",Xut.data)})}},Ir.destroy=function(){this.testWatch&&(this.testWatch.off(),this.testWatch=null),this.vm.$destroy(),this.isToolbar&&(this.isToolbar.destroy(),this.isToolbar=null),this.container=null,this.elements.off(),this.elements.remove(),this.elements=null,ya.remove(this.scenarioId)};var wr=Xut.config,Cr=Xut.plat,Tr=1,Pr=2,Sr=!1,Mr={};Cr.isBrowser&&$(document).keyup(function(t){switch(t.keyCode){case 37:Xut.View.GotoPrevSlide();break;case 39:Xut.View.GotoNextSlide()}}),Xut.Assist={};var Xr=(Xut.Presentation={},Xut.View={}),Br=Xut.Contents={},Or=Xut.Application={};s(Xr,{busyBarState:!1,busyIcon:null,ShowBusy:function(){Xut.IBooks.Enabled||(Xr.busyBarState=!0,Xr.busyIcon.show())},HideBusy:function(){if(!Xut.IBooks.Enabled){var t=Xr.busyIcon;Xr.ShowBusy.lock||(Xr.busyBarState=!1,t.hide(),Sr&&t.css("pointer-events","").find(".xut-busy-text").html(""))}},ShowTextBusy:function(t){Xut.IBooks.Enabled||(Xr.busyIcon.css("pointer-events","none").find(".xut-busy-text").html(t),Xr.ShowBusy())}});var Ar=!1;s(Xr,{CloseScenario:function(){if(!Ar){Ar=!0;var t=ya.takeOutPrevChainId();Xr.LoadScenario({scenarioId:t.scenarioId,chapterId:t.chapterId,createMode:"sysClose"},function(){Ar=!1})}},LoadScenario:function(t,e){var n=i(t.scenarioId),a=i(t.chapterId),o=i(t.pageIndex),r=t.createMode,s=t.isInApp;if(!t.main&&Xut.IBooks.Enabled&&Xut.IBooks.runMode())return void(location.href=a+".xhtml");if(l&&Si(n,a,r,o))return!1;var c=ya,u="sysClose"!==r,l=c.containerObj("current");if(l&&l.vm){var d;if((d=l.vm.$curVmPage)&&d.scenarioId==n&&d.chapterId==a)return void console.log("\u65e0\u6548\u7684\u91cd\u590d\u89e6\u53d1")}if(u&&l&&l.scenarioId===n)return void Xr.GotoSlide(n,a);l&&l.vm.$suspend(),l&&u&&c.checkToRepeat(n),DUKUCONFIG&&t.main?Xut.View.HideBusy():Xut.View.ShowBusy(),l&&!l.vm.$multiScenario&&Xr.HideToolbar();var h;l&&(h=Xut.Presentation.GetPageId())&&c.rewrite(l.scenarioId,h);var p=Xut.data.query("sectionRelated",n),v=p.toolbar,g=p.length,m=function(){return a?function(){return"GotoSlide"===r?a:a-p.start-1}():0};wr.virtualMode&&(g=2*g);var b={seasonId:n,chapterId:a,pageIndex:o||m(),isInApp:s,pageTotal:g,barInfo:v,history:t.history,sectionRang:p,complete:function(t){l&&l.destroy(),t&&t(),Xr.HideBusy(),e&&e()}};(t.main||c.mianId===n)&&(f("history"),c.mianId=n,b.isMain=!0),new Pi(b)}}),s(Xr,{Open:function(t,e,n,i,a){Xut.Plugin.WebView.open(t,i,a,n,e,1)},Close:function(){Xut.Plugin.WebView.close()}}),s(Br,{contentsFragment:{},Canvas:{SupportSwipe:!0,isSwipe:!1,isTap:!1,Reset:function(){Br.Canvas.SupportSwipe=!0,Br.Canvas.isSwipe=!1},getSupportState:function(){var t;return t=!!Br.Canvas.SupportSwipe,Br.Canvas.Reset(),t},getIsSwipe:function(){var t;return t=!!Br.Canvas.isSwipe,Br.Canvas.Reset(),t},getIsTap:function(){var t=Br.Canvas.isTap;return Br.Canvas.isTap=!1,t}},ResetDefaultControl:function(t,e,n){if(e){var i,a=function(t){n?t.attr("data-behavior",n):t.attr("data-behavior","disable")};(i=Br.Get(t,e))&&i.$contentProcess?a(i.$contentProcess):(i=$("#"+e),i.length&&a(i))}},DisableControl:function(t){return{behavior:"data-behavior",value:"disable"}},EnableControl:function(t){return{behavior:"data-behavior",value:t||"click-swipe"}}}),s(Or,{Platform:function(){var t=["duku","pc","ios","android"];return GLOBALIFRAME?t[0]:wr.isBrowser?t[1]:Xut.plat.isIOS?t[2]:Xut.plat.isAndroid?t[3]:void 0}(),Unlock:function(){return Sr},CheckOut:function(){var t=wr.Inapp;t&&p(t)!==Pr&&!Xut.plat.isAndroid||Xi()},BuyGood:function(){var t=wr.Inapp;if(!Xr.busyBarState)return Xr.ShowTextBusy("\u8bf7\u7a0d\u5019..."),Cr.isBrowser?void setTimeout(function(){Bi()},3e3):void Xut.Plugin.iapPlugin.selectInfo(function(){Bi()},function(){Xut.Plugin.iapPlugin.buyGood(function(){Bi()},function(t){Oi()},t)},t)},HasBuyGood:function(){var t=wr.Inapp;if(!Xr.busyBarState)return Xr.ShowTextBusy("\u8bf7\u7a0d\u5019..."),Cr.isBrowser?void setTimeout(function(){Bi()},3e3):void Xut.Plugin.iapPlugin.restore(function(){Bi()},function(){Oi()},t)},Resize:function(){ya.destroyAllScene(),$("#sceneContainer").empty();var t,e=Mi("pageIndex");void 0!==e&&(t=Mi("novelId"),t&&yt({novelId:t,pageIndex:e,history:p("history")}))},Original:function(){it(),ot()},Activate:function(){et()},Destroy:function(){Cr.isBrowser&&$(document).off(),ya.destroyAllScene()},DropApp:function(){function t(){Xut.plat.isAndroid&&(GLOBALCONTEXT.document.removeEventListener("backbutton",wr._event.back,!1),GLOBALCONTEXT.document.removeEventListener("pause",wr._event.pause,!1))}function e(){Or.Destroy(),GLOBALCONTEXT=null}if(DUKUCONFIG){if(DUKUCONFIG.iframeDrop){var n=p("appId");DUKUCONFIG.iframeDrop(["appId-"+n,"novelId-"+n,"pageIndex-"+n])}return DUKUCONFIG=null,t(),void e()}return CLIENTCONFIGT?(CLIENTCONFIGT.iframeDrop&&CLIENTCONFIGT.iframeDrop(),CLIENTCONFIGT=null,t(),void e()):MMXCONFIG?(MMXCONFIG.iframeDrop&&MMXCONFIG.iframeDrop(),MMXCONFIG=null,void e()):void(Cr.isBrowser||GLOBALCONTEXT.navigator.notification.confirm("\u60a8\u786e\u8ba4\u8981\u9000\u51fa\u5417\uff1f",function(t){1==t&&GLOBALCONTEXT.navigator.app.exitApp()},"\u9000\u51fa",["\u786e\u5b9a","\u53d6\u6d88"]))},Suspend:function(t){gt(t.skipMedia)?t.dispose&&t.dispose(pt):t.processed&&t.processed()},injectionComponent:function(t){var e=ya.containerObj("current");e.vm.$injectionComponent=t}}),s(Or,{appState:!1,setAppState:function(){Or.appState=!0},delAppState:function(){Or.appState=!1},getAppState:function(){return Or.appState},delayAppRun:function(){Or.setAppState()},LaunchApp:function(){Or.delAppState()},AddEventListener:function(){}}),Mr={ReadVar:function(t,e){var n;return(n=p(t))?n:(h(t,e),e)},SaveVar:function(t,e){h(t,e)},SetVar:function(t,e){h(t,e)}},Xut.U3d={View:function(t,e){Xr.LoadScenario({scenarioId:serial.scenarioId,chapterId:serial.chapterId})}},window.XXTAPI=Mr;var _r=void 0,Rr={state:!1,path:DUKUCONFIG?DUKUCONFIG.path+"duku.mp4":"android.resource://#packagename#/raw/duku",load:function(){this.play(),this.state=!0},play:function(){Xut.Application.delayAppRun(),Xut.Plugin.VideoPlayer.play(function(){Rr.launchApp()},function(){Rr.launchApp()},Rr.path,1,0,0,window.innerHeight,window.innerWidth)},closeVideo:function(){Xut.Plugin.VideoPlayer.close(function(){Rr.launchApp()})},launchApp:function(){this.state=!1,Xut.Application.LaunchApp()}},Nr=!1;Xut.App=function(){Xut.Version=779,window.HTMLCONFIG={};var t=window.IBOOKSCONFIG;if(t&&t.data&&(_.each(t.data,function(t,e){t.item=function(t){return this[t]}}),Xut.plat.isBrowser=!0,Xut.plat.isIOS=!1),Xut.IBooks={pageIndex:function(){return t?t.pageIndex+1:void 0}(),existSvg:t?t.existSvg:!1,
Enabled:function(){return!!t}(),CONFIG:t,runMode:function(){return!(!t||t.compiled)},compileMode:function(){return!(!t||!t.compiled)}},Xut.fix=Xut.fix||{},Xut.plat.isBrowser&&(Xut.plat.isIOS||Xut.plat.isAndroid)){var e=function n(){Xut.fix.audio||(Xut.fix.audio=new Audio,Xut.fix.video=document.createElement("Video"),document.removeEventListener("touchstart",n,!1))};document.addEventListener("touchstart",e,!1)}Vi()}});